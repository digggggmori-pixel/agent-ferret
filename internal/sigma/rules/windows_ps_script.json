{
  "metadata": {
    "logsource": "windows_ps_script",
    "rule_count": 161,
    "compiled_at": "2026-02-04T12:28:36.522144",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "4096a49c-7de4-4da0-a230-c66ccd56ea5a",
      "title": "Suspicious PowerShell Get Current User",
      "status": "test",
      "description": "Detects the use of PowerShell to identify the current logged user.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1033"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "[System.Environment]::UserName",
                  "$env:UserName",
                  "[System.Security.Principal.WindowsIdentity]::GetCurrent()"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1033"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-04-04",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md#atomic-test-4---user-discovery-with-env-vars-powershell-script",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md#atomic-test-5---getcurrent-user-with-powershell-script"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_get_current_user.yml"
      }
    },
    {
      "id": "6c6c6282-7671-4fe9-a0ce-a2dcebdc342b",
      "title": "Powershell XML Execute Command",
      "status": "test",
      "description": "Adversaries may abuse PowerShell commands and scripts for execution.\nPowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell)\nAdversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code\n",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_xml": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "System.Xml.XmlDocument",
                  ".Load"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_exec": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "IEX ",
                  "Invoke-Expression ",
                  "Invoke-Command ",
                  "ICM -"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-19",
        "modified": "2023-01-19",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1059.001/T1059.001.md#atomic-test-8---powershell-xml-requests"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_xml_iex.yml"
      }
    },
    {
      "id": "851fd622-b675-4d26-b803-14bc7baa517a",
      "title": "HackTool - WinPwn Execution - ScriptBlock",
      "status": "test",
      "description": "Detects scriptblock text keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.defense-evasion",
        "attack.discovery",
        "attack.execution",
        "attack.privilege-escalation",
        "attack.t1046",
        "attack.t1082",
        "attack.t1106",
        "attack.t1518",
        "attack.t1548.002",
        "attack.t1552.001",
        "attack.t1555",
        "attack.t1555.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Offline_Winpwn",
                  "WinPwn ",
                  "WinPwn.exe",
                  "WinPwn.ps1"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1046",
          "T1082",
          "T1106",
          "T1518",
          "T1548.002",
          "T1552.001",
          "T1555",
          "T1555.003"
        ],
        "tactics": [
          "credential_access",
          "defense_evasion",
          "discovery",
          "execution",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "Swachchhanda Shrawan Poudel",
        "date": "2023-12-04",
        "modified": "",
        "references": [
          "https://github.com/S3cur3Th1sSh1t/WinPwn",
          "https://www.publicnow.com/view/EB87DB49C654D9B63995FAD4C9DE3D3CC4F6C3ED?1671634841",
          "https://reconshell.com/winpwn-tool-for-internal-windows-pentesting-and-ad-security/",
          "https://github.com/redcanaryco/atomic-red-team/blob/4d6c4e8e23d465af7a2388620cfe3f8c76e16cf0/atomics/T1082/T1082.md",
          "https://grep.app/search?q=winpwn&filter[repo][0]=redcanaryco/atomic-red-team"
        ],
        "falsepositives": [
          "As the script block is a blob of text. False positive may occur with scripts that contain the keyword as a reference or simply use it for detection."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_hktl_winpwn.yml"
      }
    },
    {
      "id": "adf876b3-f1f8-4aa9-a4e4-a64106feec06",
      "title": "Testing Usage of Uncommonly Used Port",
      "status": "test",
      "description": "Adversaries may communicate using a protocol and port paring that are typically not associated.\nFor example, HTTPS over port 8088(Citation: Symantec Elfin Mar 2019) or port 587(Citation: Fortinet Agent Tesla April 2018) as opposed to the traditional port 443.\n",
      "level": "medium",
      "tags": [
        "attack.command-and-control",
        "attack.t1571"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Test-NetConnection",
                  "-ComputerName ",
                  "-port "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " 443 ",
                  " 80 "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not filter",
        "condition_parsed": {
          "op": "and_not",
          "include": "selection",
          "exclude": "filter"
        }
      },
      "mitre": {
        "techniques": [
          "T1571"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-23",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1571/T1571.md#atomic-test-1---testing-usage-of-uncommonly-used-port-with-powershell",
          "https://learn.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_test_netconnection.yml"
      }
    },
    {
      "id": "d4a11f63-2390-411c-9adf-d791fd152830",
      "title": "Windows Screen Capture with CopyFromScreen",
      "status": "test",
      "description": "Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation.\nScreen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations\n",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1113"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": ".CopyFromScreen",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1113"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "2022-07-07",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1113/T1113.md#atomic-test-6---windows-screen-capture-copyfromscreen"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_capture_screenshots.yml"
      }
    },
    {
      "id": "602f5669-6927-4688-84db-0d4b7afb2150",
      "title": "Disable Powershell Command History",
      "status": "test",
      "description": "Detects scripts or commands that disabled the Powershell command history by removing psreadline module",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Remove-Module",
                  "psreadline"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1070.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Ali Alwashali",
        "date": "2022-08-21",
        "modified": "",
        "references": [
          "https://twitter.com/DissectMalware/status/1062879286749773824"
        ],
        "falsepositives": [
          "Legitimate script that disables the command history"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_disable_psreadline_command_history.yml"
      }
    },
    {
      "id": "4a241dea-235b-4a7e-8d76-50d817b146c4",
      "title": "Suspicious PowerShell Mailbox Export to Share - PS",
      "status": "test",
      "description": "Detects usage of the powerShell New-MailboxExportRequest Cmdlet to exports a mailbox to a remote or local share, as used in ProxyShell exploitations",
      "level": "critical",
      "tags": [
        "attack.exfiltration"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-MailboxExportRequest",
                  " -Mailbox ",
                  " -FilePath \\\\\\\\"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-10-26",
        "modified": "",
        "references": [
          "https://youtu.be/5mqid-7zp8k?t=2481",
          "https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html",
          "https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1",
          "https://m365internals.com/2022/10/07/hunting-in-on-premises-exchange-server-logs/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_mailboxexport_share.yml"
      }
    },
    {
      "id": "42821614-9264-4761-acfc-5772c3286f76",
      "title": "Root Certificate Installed - PowerShell",
      "status": "test",
      "description": "Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1553.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection1": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Move-Item",
                  "Cert:\\LocalMachine\\Root"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Import-Certificate",
                  "Cert:\\LocalMachine\\Root"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1553.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "oscd.community, @redcanary, Zach Stanford @svch0st",
        "date": "2020-10-10",
        "modified": "2022-12-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.004/T1553.004.md"
        ],
        "falsepositives": [
          "Help Desk or IT may need to manually add a corporate Root CA on occasion. Need to test if GPO push doesn't trigger FP"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_root_certificate_installed.yml"
      }
    },
    {
      "id": "22d80745-6f2c-46da-826b-77adaededd74",
      "title": "Suspicious Service DACL Modification Via Set-Service Cmdlet - PS",
      "status": "test",
      "description": "Detects usage of the \"Set-Service\" powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as \"sc.exe\", \"Get-Service\"...etc. (Works only in powershell 7)",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.defense-evasion",
        "attack.privilege-escalation",
        "attack.t1574.011"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_sddl_flag": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-SecurityDescriptorSddl ",
                  "-sd "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_set_service": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Service ",
                  "D;;"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ";;;IU",
                  ";;;SU",
                  ";;;BA",
                  ";;;SY",
                  ";;;WD"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1574.011"
        ],
        "tactics": [
          "persistence",
          "defense_evasion",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-10-24",
        "modified": "",
        "references": [
          "https://twitter.com/Alh4zr3d/status/1580925761996828672",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/set-service?view=powershell-7.2"
        ],
        "falsepositives": [
          "Rare intended use of hidden services",
          "Rare FP could occur due to the non linearity of the ScriptBlockText log"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_service_dacl_modification_set_service.yml"
      }
    },
    {
      "id": "ca8b77a9-d499-4095-b793-5d5f330d450e",
      "title": "PowerShell Credential Prompt",
      "status": "test",
      "description": "Detects PowerShell calling a credential prompt",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "PromptForCredential",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "credential_access",
          "execution"
        ]
      },
      "meta": {
        "author": "John Lambert (idea), Florian Roth (Nextron Systems)",
        "date": "2017-04-09",
        "modified": "2022-12-25",
        "references": [
          "https://twitter.com/JohnLaTwC/status/850381440629981184",
          "https://t.co/ezOTGy1a1G"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_prompt_credentials.yml"
      }
    },
    {
      "id": "8c3a6607-b7dc-4f0d-a646-ef38c00b76ee",
      "title": "Active Directory Group Enumeration With Get-AdGroup",
      "status": "test",
      "description": "Detects usage of the \"Get-AdGroup\" cmdlet to enumerate Groups within Active Directory",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-AdGroup ",
                  "-Filter"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1069.002"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "2022-11-17",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1018/T1018.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_adgroup.yml"
      }
    },
    {
      "id": "403c2cc0-7f6b-4925-9423-bfa573bed7eb",
      "title": "Suspicious PowerShell Download - Powershell Script",
      "status": "test",
      "description": "Detects suspicious PowerShell download command",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "webclient": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "System.Net.WebClient",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "download": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".DownloadFile(",
                  ".DownloadFileAsync(",
                  ".DownloadString(",
                  ".DownloadStringAsync("
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "webclient and download",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "webclient"
            },
            {
              "type": "ref",
              "value": "download"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2017-03-05",
        "modified": "2022-12-02",
        "references": [
          "https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadstring?view=net-8.0",
          "https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadfile?view=net-8.0"
        ],
        "falsepositives": [
          "PowerShell scripts that download content from the Internet"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_download.yml"
      }
    },
    {
      "id": "846c7a87-8e14-4569-9d49-ecfd4276a01c",
      "title": "DSInternals Suspicious PowerShell Cmdlets - ScriptBlock",
      "status": "test",
      "description": "Detects execution and usage of the DSInternals PowerShell module. Which can be used to perform what might be considered as suspicious activity such as dumping DPAPI backup keys or manipulating NTDS.DIT files.\nThe DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory. These include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation.\n",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-ADDBSidHistory",
                  "Add-ADNgcKey",
                  "Add-ADReplNgcKey",
                  "ConvertFrom-ADManagedPasswordBlob",
                  "ConvertFrom-GPPrefPassword",
                  "ConvertFrom-ManagedPasswordBlob",
                  "ConvertFrom-UnattendXmlPassword",
                  "ConvertFrom-UnicodePassword",
                  "ConvertTo-AADHash",
                  "ConvertTo-GPPrefPassword",
                  "ConvertTo-KerberosKey",
                  "ConvertTo-LMHash",
                  "ConvertTo-MsoPasswordHash",
                  "ConvertTo-NTHash",
                  "ConvertTo-OrgIdHash",
                  "ConvertTo-UnicodePassword",
                  "Disable-ADDBAccount",
                  "Enable-ADDBAccount",
                  "Get-ADDBAccount",
                  "Get-ADDBBackupKey",
                  "Get-ADDBDomainController",
                  "Get-ADDBGroupManagedServiceAccount",
                  "Get-ADDBKdsRootKey",
                  "Get-ADDBSchemaAttribute",
                  "Get-ADDBServiceAccount",
                  "Get-ADDefaultPasswordPolicy",
                  "Get-ADKeyCredential",
                  "Get-ADPasswordPolicy",
                  "Get-ADReplAccount",
                  "Get-ADReplBackupKey",
                  "Get-ADReplicationAccount",
                  "Get-ADSIAccount",
                  "Get-AzureADUserEx",
                  "Get-BootKey",
                  "Get-KeyCredential",
                  "Get-LsaBackupKey",
                  "Get-LsaPolicy",
                  "Get-SamPasswordPolicy",
                  "Get-SysKey",
                  "Get-SystemKey",
                  "New-ADDBRestoreFromMediaScript",
                  "New-ADKeyCredential",
                  "New-ADNgcKey",
                  "New-NTHashSet",
                  "Remove-ADDBObject",
                  "Save-DPAPIBlob",
                  "Set-ADAccountPasswordHash",
                  "Set-ADDBAccountPassword",
                  "Set-ADDBBootKey",
                  "Set-ADDBDomainController",
                  "Set-ADDBPrimaryGroup",
                  "Set-ADDBSysKey",
                  "Set-AzureADUserEx",
                  "Set-LsaPolicy",
                  "Set-SamAccountPasswordHash",
                  "Set-WinUserPasswordHash",
                  "Test-ADDBPasswordQuality",
                  "Test-ADPasswordQuality",
                  "Test-ADReplPasswordQuality",
                  "Test-PasswordQuality",
                  "Unlock-ADDBAccount",
                  "Write-ADNgcKey",
                  "Write-ADReplNgcKey"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2024-06-26",
        "modified": "",
        "references": [
          "https://github.com/MichaelGrafnetter/DSInternals/blob/39ee8a69bbdc1cfd12c9afdd7513b4788c4895d4/Src/DSInternals.PowerShell/DSInternals.psd1"
        ],
        "falsepositives": [
          "Legitimate usage of DSInternals for administration or audit purpose."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_dsinternals_cmdlets.yml"
      }
    },
    {
      "id": "14c71865-6cd3-44ae-adaa-1db923fae5f2",
      "title": "Tamper Windows Defender - ScriptBlockLogging",
      "status": "test",
      "description": "Detects PowerShell scripts attempting to disable scheduled scanning and other parts of Windows Defender ATP or set default actions to allow.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_options_disabling_preference": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Set-MpPreference",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_options_disabling_function": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-dbaf $true",
                  "-dbaf 1",
                  "-dbm $true",
                  "-dbm 1",
                  "-dips $true",
                  "-dips 1",
                  "-DisableArchiveScanning $true",
                  "-DisableArchiveScanning 1",
                  "-DisableBehaviorMonitoring $true",
                  "-DisableBehaviorMonitoring 1",
                  "-DisableBlockAtFirstSeen $true",
                  "-DisableBlockAtFirstSeen 1",
                  "-DisableCatchupFullScan $true",
                  "-DisableCatchupFullScan 1",
                  "-DisableCatchupQuickScan $true",
                  "-DisableCatchupQuickScan 1",
                  "-DisableIntrusionPreventionSystem $true",
                  "-DisableIntrusionPreventionSystem 1",
                  "-DisableIOAVProtection $true",
                  "-DisableIOAVProtection 1",
                  "-DisableRealtimeMonitoring $true",
                  "-DisableRealtimeMonitoring 1",
                  "-DisableRemovableDriveScanning $true",
                  "-DisableRemovableDriveScanning 1",
                  "-DisableScanningMappedNetworkDrivesForFullScan $true",
                  "-DisableScanningMappedNetworkDrivesForFullScan 1",
                  "-DisableScanningNetworkFiles $true",
                  "-DisableScanningNetworkFiles 1",
                  "-DisableScriptScanning $true",
                  "-DisableScriptScanning 1",
                  "-MAPSReporting $false",
                  "-MAPSReporting 0",
                  "-drdsc $true",
                  "-drdsc 1",
                  "-drtm $true",
                  "-drtm 1",
                  "-dscrptsc $true",
                  "-dscrptsc 1",
                  "-dsmndf $true",
                  "-dsmndf 1",
                  "-dsnf $true",
                  "-dsnf 1",
                  "-dss $true",
                  "-dss 1"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_other_default_actions_allow": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Set-MpPreference",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_other_default_actions_func": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "HighThreatDefaultAction Allow",
                  "htdefac Allow",
                  "LowThreatDefaultAction Allow",
                  "ltdefac Allow",
                  "ModerateThreatDefaultAction Allow",
                  "mtdefac Allow",
                  "SevereThreatDefaultAction Allow",
                  "stdefac Allow"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_options_disabling_* or all of selection_other_default_actions_*",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "all of selection_options_disabling_*",
            "all of selection_other_default_actions_*"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, elhoim, Tim Shelton (fps, alias support), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-01-16",
        "modified": "2024-01-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md",
          "https://learn.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps",
          "https://bidouillesecurity.com/disable-windows-defender-in-powershell/"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts that disable Windows Defender for troubleshooting purposes. Must be investigated."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_tamper_windows_defender_set_mp.yml"
      }
    },
    {
      "id": "ed965133-513f-41d9-a441-e38076a0798f",
      "title": "Suspicious PowerShell Invocations - Generic",
      "status": "test",
      "description": "Detects suspicious PowerShell invocation command parameters",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_encoded": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " -enc ",
                  " -EncodedCommand ",
                  " -ec "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_hidden": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " -w hidden ",
                  " -window hidden ",
                  " -windowstyle hidden ",
                  " -w 1 "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_noninteractive": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " -noni ",
                  " -noninteractive "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2017-03-12",
        "modified": "2023-01-03",
        "references": [
          "Internal Research"
        ],
        "falsepositives": [
          "Very special / sneaky PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_invocation_generic.yml"
      }
    },
    {
      "id": "e4f93c99-396f-47c8-bb0f-201b1fa69034",
      "title": "Potential Data Exfiltration Via Audio File",
      "status": "test",
      "description": "Detects potential exfiltration attempt via audio file using PowerShell",
      "level": "medium",
      "tags": [
        "attack.exfiltration"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_main": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "[System.Math]::",
                  "[IO.FileMode]::",
                  "BinaryWriter"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_header_wav": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "0x52",
                  "0x49",
                  "0x46",
                  "0x57",
                  "0x41",
                  "0x56",
                  "0x45",
                  "0xAC"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_main and 1 of selection_header_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection_main"
            },
            {
              "type": "ref",
              "value": "1 of selection_header_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-16",
        "modified": "",
        "references": [
          "https://github.com/gtworek/PSBits/blob/e97cbbb173b31cbc4d37244d3412de0a114dacfb/NoDLP/bin2wav.ps1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_audio_exfiltration.yml"
      }
    },
    {
      "id": "1b9dc62e-6e9e-42a3-8990-94d7a10007f7",
      "title": "Invoke-Obfuscation Obfuscated IEX Invocation - PowerShell",
      "status": "test",
      "description": "Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \\u2014",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_iex": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\$PSHome\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$PSHome\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\$ShellId\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$ShellId\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\$env:Public\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$env:Public\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\$env:ComSpec\\[(\\s*\\d{1,3}\\s*,){2}",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\*mdr\\*\\W\\s*\\)\\.Name",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__re": {
                    "field": "ScriptBlockText",
                    "value": "\\$VerbosePreference\\.ToString\\(",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection_iex",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_iex"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Daniel Bohannon (@Mandiant/@FireEye), oscd.community",
        "date": "2019-11-08",
        "modified": "2022-12-31",
        "references": [
          "https://github.com/danielbohannon/Invoke-Obfuscation/blob/f20e7f843edd0a3a7716736e9eddfa423395dd26/Out-ObfuscatedStringCommand.ps1#L873-L888"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_obfuscated_iex.yml"
      }
    },
    {
      "id": "3bf1d859-3a7e-44cb-8809-a99e066d3478",
      "title": "PowerShell Set-Acl On Windows Folder - PsScript",
      "status": "test",
      "description": "Detects PowerShell scripts to set the ACL to a file in the Windows folder",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1222"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Acl ",
                  "-AclObject "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_paths": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-Path \"C:\\Windows",
                  "-Path \"C:/Windows",
                  "-Path 'C:\\Windows",
                  "-Path 'C:/Windows",
                  "-Path C:\\\\Windows",
                  "-Path C:/Windows",
                  "-Path $env:windir",
                  "-Path \"$env:windir",
                  "-Path '$env:windir"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_permissions": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "FullControl",
                  "Allow"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1222"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-07-18",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/74438b0237d141ee9c99747976447dc884cb1a39/atomics/T1505.005/T1505.005.md",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-acl?view=powershell-5.1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_set_acl_susp_location.yml"
      }
    },
    {
      "id": "c1dda054-d638-4c16-afc8-53e007f3fbc5",
      "title": "Automated Collection Command PowerShell",
      "status": "test",
      "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data.",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1119"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_ext": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".doc",
                  ".docx",
                  ".xls",
                  ".xlsx",
                  ".ppt",
                  ".pptx",
                  ".rtf",
                  ".pdf",
                  ".txt"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_cmd": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ChildItem",
                  " -Recurse ",
                  " -Include "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1119"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-07-28",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1119/T1119.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_automated_collection.yml"
      }
    },
    {
      "id": "b7216a7d-687e-4c8d-82b1-3080b2ad961f",
      "title": "Modify Group Policy Settings - ScriptBlockLogging",
      "status": "test",
      "description": "Detect malicious GPO modifications can be used to implement many other malicious behaviors.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.privilege-escalation",
        "attack.t1484.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_path": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "\\SOFTWARE\\Policies\\Microsoft\\Windows\\System",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_key": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "GroupPolicyRefreshTimeDC",
                  "GroupPolicyRefreshTimeOffsetDC",
                  "GroupPolicyRefreshTime",
                  "GroupPolicyRefreshTimeOffset",
                  "EnableSmartScreen",
                  "ShellSmartScreenLevel"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1484.001"
        ],
        "tactics": [
          "defense_evasion",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-08-19",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1484.001/T1484.001.md"
        ],
        "falsepositives": [
          "Legitimate use"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_modify_group_policy_settings.yml"
      }
    },
    {
      "id": "e2812b49-bae0-4b21-b366-7c142eafcde2",
      "title": "Potentially Suspicious Call To Win32_NTEventlogFile Class - PSScript",
      "status": "test",
      "description": "Detects usage of the WMI class \"Win32_NTEventlogFile\" in a potentially suspicious way (delete, backup, change permissions, etc.) from a PowerShell script",
      "level": "medium",
      "tags": [
        "attack.defense-evasion"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_class": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Win32_NTEventlogFile",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_function": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".BackupEventlog(",
                  ".ChangeSecurityPermissions(",
                  ".ChangeSecurityPermissionsEx(",
                  ".ClearEventLog(",
                  ".Delete(",
                  ".DeleteEx(",
                  ".Rename(",
                  ".TakeOwnerShip(",
                  ".TakeOwnerShipEx("
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-07-13",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa394225(v=vs.85)"
        ],
        "falsepositives": [
          "Legitimate administration and backup scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_win32_nteventlogfile_usage.yml"
      }
    },
    {
      "id": "851c506b-6b7c-4ce2-8802-c703009d03c0",
      "title": "Winlogon Helper DLL",
      "status": "test",
      "description": "Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\nRegistry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are\nused to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to\nload and execute malicious DLLs and/or executables.\n",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.persistence",
        "attack.t1547.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "CurrentVersion\\Winlogon",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-ItemProperty",
                  "New-Item"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1547.004"
        ],
        "tactics": [
          "privilege_escalation",
          "persistence"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2019-10-21",
        "modified": "2022-07-07",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.004/T1547.004.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_winlogon_helper_dll.yml"
      }
    },
    {
      "id": "fc028194-969d-4122-8abe-0470d5b8f12f",
      "title": "Access to Browser Login Data",
      "status": "test",
      "description": "Adversaries may acquire credentials from web browsers by reading files specific to the target browser.\nWeb browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.\nWeb browsers typically store the credentials in an encrypted format within a credential store.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1555.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmd": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Copy-Item",
                  "-Destination"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_path": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "\\Opera Software\\Opera Stable\\Login Data",
                  "\\Mozilla\\Firefox\\Profiles",
                  "\\Microsoft\\Edge\\User Data\\Default",
                  "\\Google\\Chrome\\User Data\\Default\\Login Data",
                  "\\Google\\Chrome\\User Data\\Default\\Login Data For Account"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1555.003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-30",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1555.003/T1555.003.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_access_to_browser_login_data.yml"
      }
    },
    {
      "id": "5f9c7f1a-7c21-4c39-b2f3-8d8006e0e51f",
      "title": "PowerShell Web Access Installation - PsScript",
      "status": "test",
      "description": "Detects the installation and configuration of PowerShell Web Access, which could be used for remote access and potential abuse",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_install": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Install-WindowsFeature WindowsPowerShellWebAccess",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_config": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Install-PswaWebApplication",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_auth": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-PswaAuthorizationRule",
                  "-UserName *",
                  "-ComputerName *"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "persistence",
          "execution"
        ]
      },
      "meta": {
        "author": "Michael Haag",
        "date": "2024-09-03",
        "modified": "",
        "references": [
          "https://docs.microsoft.com/en-us/powershell/module/powershellwebaccess/install-pswawebapplication",
          "https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-241a",
          "https://gist.github.com/MHaggis/7e67b659af9148fa593cf2402edebb41"
        ],
        "falsepositives": [
          "Legitimate PowerShell Web Access installations by administrators"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_powershell_web_access_installation.yml"
      }
    },
    {
      "id": "a9723fcc-881c-424c-8709-fd61442ab3c3",
      "title": "Recon Information for Export with PowerShell",
      "status": "test",
      "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1119"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_action": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-Service ",
                  "Get-ChildItem ",
                  "Get-Process "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_redirect": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "> $env:TEMP\\",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1119"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-07-30",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1119/T1119.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_recon_export.yml"
      }
    },
    {
      "id": "195626f3-5f1b-4403-93b7-e6cfd4d6a078",
      "title": "Suspicious SSL Connection",
      "status": "test",
      "description": "Adversaries may employ a known encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol.",
      "level": "low",
      "tags": [
        "attack.command-and-control",
        "attack.t1573"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "System.Net.Security.SslStream",
                  "Net.Security.RemoteCertificateValidationCallback",
                  ".AuthenticateAsClient"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1573"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-23",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1573/T1573.md#atomic-test-1---openssl-c2",
          "https://medium.com/walmartglobaltech/openssl-server-reverse-shell-from-windows-client-aee2dbfa0926"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_ssl_keyword.yml"
      }
    },
    {
      "id": "73e67340-0d25-11eb-adc1-0242ac120002",
      "title": "Invoke-Obfuscation CLIP+ Launcher - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated use of Clip.exe to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "cmd.{0,5}(?:/c|/r).+clip(?:\\.exe)?.{0,4}&&.+clipboard]::\\(\\s\\\\\"\\{\\d\\}.+-f.+\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-13",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_clip.yml"
      }
    },
    {
      "id": "953945c5-22fe-4a92-9f8a-a9edc1e522da",
      "title": "Abuse of Service Permissions to Hide Services Via Set-Service - PS",
      "status": "test",
      "description": "Detects usage of the \"Set-Service\" powershell cmdlet to configure a new SecurityDescriptor that allows a service to be hidden from other utilities such as \"sc.exe\", \"Get-Service\"...etc. (Works only in powershell 7)",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.defense-evasion",
        "attack.privilege-escalation",
        "attack.t1574.011"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Service ",
                  "DCLCWPDTSD"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-SecurityDescriptorSddl ",
                  "-sd "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1574.011"
        ],
        "tactics": [
          "persistence",
          "defense_evasion",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-10-17",
        "modified": "",
        "references": [
          "https://twitter.com/Alh4zr3d/status/1580925761996828672",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/set-service?view=powershell-7.2"
        ],
        "falsepositives": [
          "Rare intended use of hidden services",
          "Rare FP could occur due to the non linearity of the ScriptBlockText log"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_using_set_service_to_hide_services.yml"
      }
    },
    {
      "id": "1f49f2ab-26bc-48b3-96cc-dcffbc93eadf",
      "title": "Potential Suspicious PowerShell Keywords",
      "status": "test",
      "description": "Detects potentially suspicious keywords that could indicate the use of a PowerShell exploitation framework",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "System.Reflection.Assembly.Load($",
                  "[System.Reflection.Assembly]::Load($",
                  "[Reflection.Assembly]::Load($",
                  "System.Reflection.AssemblyName",
                  "Reflection.Emit.AssemblyBuilderAccess",
                  "Reflection.Emit.CustomAttributeBuilder",
                  "Runtime.InteropServices.UnmanagedType",
                  "Runtime.InteropServices.DllImportAttribute",
                  "SuspendThread",
                  "rundll32"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems), Perez Diego (@darkquassar), Tuan Le (NCSGroup)",
        "date": "2019-02-11",
        "modified": "2023-04-21",
        "references": [
          "https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462",
          "https://github.com/PowerShellMafia/PowerSploit/blob/d943001a7defb5e0d1657085a77a0e78609be58f/CodeExecution/Invoke-ReflectivePEInjection.ps1",
          "https://github.com/hlldz/Phant0m/blob/30c2935d8cf4aafda17ee2fab7cd0c4aa9a607c2/old/Invoke-Phant0m.ps1",
          "https://gist.github.com/MHaggis/0dbe00ad401daa7137c81c99c268cfb7"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_keywords.yml"
      }
    },
    {
      "id": "965e2db9-eddb-4cf6-a986-7a967df651e4",
      "title": "Potential Keylogger Activity",
      "status": "test",
      "description": "Detects PowerShell scripts that contains reference to keystroke capturing functions",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.credential-access",
        "attack.t1056.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "[Windows.Input.Keyboard]::IsKeyDown([System.Windows.Input.Key]::",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1056.001"
        ],
        "tactics": [
          "collection",
          "credential_access"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-04",
        "modified": "",
        "references": [
          "https://twitter.com/ScumBots/status/1610626724257046529",
          "https://www.virustotal.com/gui/file/d4486b63512755316625230e0c9c81655093be93876e0d80732e7eeaf7d83476/content",
          "https://www.virustotal.com/gui/file/720a7ee9f2178c70501d7e3f4bcc28a4f456e200486dbd401b25af6da3b4da62/content",
          "https://learn.microsoft.com/en-us/dotnet/api/system.windows.input.keyboard.iskeydown?view=windowsdesktop-7.0"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_keylogger_activity.yml"
      }
    },
    {
      "id": "8028c2c3-e25a-46e3-827f-bbb5abf181d7",
      "title": "WMImplant Hack Tool",
      "status": "test",
      "description": "Detects parameters used by WMImplant",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1047",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "WMImplant",
                  " change_user ",
                  " gen_cli ",
                  " command_exec ",
                  " disable_wdigest ",
                  " disable_winrm ",
                  " enable_wdigest ",
                  " enable_winrm ",
                  " registry_mod ",
                  " remote_posh ",
                  " sched_job ",
                  " service_mod ",
                  " process_kill ",
                  " active_users ",
                  " basic_info ",
                  " power_off ",
                  " vacant_system ",
                  " logon_events "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1047",
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "NVISO",
        "date": "2020-03-26",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/FortyNorthSecurity/WMImplant"
        ],
        "falsepositives": [
          "Administrative scripts that use the same keywords."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_wmimplant.yml"
      }
    },
    {
      "id": "e55a5195-4724-480e-a77e-3ebe64bd3759",
      "title": "Invoke-Obfuscation Via Use MSHTA - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use MSHTA in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "set",
                  "&&",
                  "mshta",
                  "vbscript:createobject",
                  ".run",
                  "(window.close)"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-08",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_mhsta.yml"
      }
    },
    {
      "id": "975b2262-9a49-439d-92a6-0709cccdf0b2",
      "title": "Unsigned AppX Installation Attempt Using Add-AppxPackage - PsScript",
      "status": "test",
      "description": "Detects usage of the \"Add-AppxPackage\" or it's alias \"Add-AppPackage\" to install unsigned AppX packages",
      "level": "medium",
      "tags": [
        "attack.persistence",
        "attack.defense-evasion"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-AppPackage ",
                  "Add-AppxPackage "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_flag": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": " -AllowUnsigned",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "persistence",
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-31",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/windows/msix/package/unsigned-package",
          "https://twitter.com/WindowsDocs/status/1620078135080325122"
        ],
        "falsepositives": [
          "Installation of unsigned packages for testing purposes"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_install_unsigned_appx_packages.yml"
      }
    },
    {
      "id": "96c982fe-3d08-4df4-bed2-eb14e02f21c8",
      "title": "Get-ADUser Enumeration Using UserAccountControl Flags",
      "status": "test",
      "description": "Detects AS-REP roasting is an attack that is often-overlooked. It is not very common as you have to explicitly set accounts that do not require pre-authentication.",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1033"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ADUser",
                  "-Filter",
                  "useraccountcontrol",
                  "-band",
                  "4194304"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1033"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md#atomic-test-11---get-aduser-enumeration-using-useraccountcontrol-flags-as-rep-roasting",
          "https://shellgeek.com/useraccountcontrol-flags-to-manipulate-properties/"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_as_rep_roasting.yml"
      }
    },
    {
      "id": "155c7fd5-47b4-49b2-bbeb-eb4fab335429",
      "title": "Add Windows Capability Via PowerShell Script",
      "status": "test",
      "description": "Detects usage of the \"Add-WindowsCapability\" cmdlet to add Windows capabilities. Notable capabilities could be \"OpenSSH\" and others.",
      "level": "medium",
      "tags": [
        "attack.execution"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Add-WindowsCapability ",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_capa": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "-Name OpenSSH.",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-22",
        "modified": "2023-05-09",
        "references": [
          "https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse?tabs=powershell",
          "https://www.virustotal.com/gui/file/af1c82237b6e5a3a7cdbad82cc498d298c67845d92971bada450023d1335e267/content"
        ],
        "falsepositives": [
          "Legitimate usage of the capabilities by administrators or users. Add additional filters accordingly."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_add_windows_capability.yml"
      }
    },
    {
      "id": "86b896ba-ffa1-4fea-83e3-ee28a4c915c7",
      "title": "Invoke-Obfuscation Via Stdin - Powershell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via Stdin in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "(?i)(set).*&&\\s?set.*(environment|invoke|\\$\\{?input).*&&.*\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-12",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_stdin.yml"
      }
    },
    {
      "id": "afd12fed-b0ec-45c9-a13d-aa86625dac81",
      "title": "Create Volume Shadow Copy with Powershell",
      "status": "test",
      "description": "Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1003.003",
        "attack.ds0005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Win32_ShadowCopy",
                  ").Create(",
                  "ClientAccessible"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003.003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-12",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1&viewFallbackFrom=powershell-7"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_create_volume_shadow_copy.yml"
      }
    },
    {
      "id": "3245cd30-e015-40ff-a31d-5cadd5f377ec",
      "title": "HackTool - Rubeus Execution - ScriptBlock",
      "status": "test",
      "description": "Detects the execution of the hacktool Rubeus using specific command line flags",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.credential-access",
        "attack.t1003",
        "attack.t1558.003",
        "attack.lateral-movement",
        "attack.t1550.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "asreproast ",
                  "dump /service:krbtgt ",
                  "dump /luid:0x",
                  "kerberoast ",
                  "createnetonly /program:",
                  "ptt /ticket:",
                  "/impersonateuser:",
                  "renew /ticket:",
                  "asktgt /user:",
                  "harvest /interval:",
                  "s4u /user:",
                  "s4u /ticket:",
                  "hash /password:",
                  "golden /aes256:",
                  "silver /user:"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003",
          "T1558.003",
          "T1550.003"
        ],
        "tactics": [
          "defense_evasion",
          "credential_access",
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "Christian Burkard (Nextron Systems), Florian Roth (Nextron Systems)",
        "date": "2023-04-27",
        "modified": "",
        "references": [
          "https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus",
          "https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html",
          "https://github.com/GhostPack/Rubeus"
        ],
        "falsepositives": [
          "Unlikely"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_hktl_rubeus.yml"
      }
    },
    {
      "id": "fa2559c8-1197-471d-9cdd-05a0273d4522",
      "title": "Potential AMSI Bypass Script Using NULL Bits",
      "status": "test",
      "description": "Detects usage of special strings/null bits in order to potentially bypass AMSI functionalities",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "if(0){{{0}}}' -f $(0 -as [char]) +",
                  "#<NULL>"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-04",
        "modified": "2023-05-09",
        "references": [
          "https://github.com/r00t-3xp10it/hacking-material-books/blob/43cb1e1932c16ff1f58b755bc9ab6b096046853f/obfuscation/simple_obfuscation.md#amsi-bypass-using-null-bits-satoshi"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_amsi_null_bits_bypass.yml"
      }
    },
    {
      "id": "70ad982f-67c8-40e0-a955-b920c2fa05cb",
      "title": "Suspicious IO.FileStream",
      "status": "test",
      "description": "Open a handle on the drive volume via the \\\\.\\ DOS device path specifier and perform direct access read of the first few bytes of the volume.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "IO.FileStream",
                  "\\\\\\\\.\\\\"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1070.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-09",
        "modified": "2022-03-05",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1006/T1006.md"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_iofilestream.yml"
      }
    },
    {
      "id": "f772cee9-b7c2-4cb2-8f07-49870adc02e0",
      "title": "Malicious Nishang PowerShell Commandlets",
      "status": "test",
      "description": "Detects Commandlet names and arguments from the Nishang exploitation framework",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-ConstrainedDelegationBackdoor",
                  "Copy-VSS",
                  "Create-MultipleSessions",
                  "DataToEncode",
                  "DNS_TXT_Pwnage",
                  "Do-Exfiltration-Dns",
                  "Download_Execute",
                  "Download-Execute-PS",
                  "DownloadAndExtractFromRemoteRegistry",
                  "DumpCerts",
                  "DumpCreds",
                  "DumpHashes",
                  "Enable-DuplicateToken",
                  "Enable-Duplication",
                  "Execute-Command-MSSQL",
                  "Execute-DNSTXT-Code",
                  "Execute-OnTime",
                  "ExetoText",
                  "exfill",
                  "ExfilOption",
                  "FakeDC",
                  "FireBuster",
                  "FireListener",
                  "Get-Information ",
                  "Get-PassHints",
                  "Get-Web-Credentials",
                  "Get-WebCredentials",
                  "Get-WLAN-Keys",
                  "HTTP-Backdoor",
                  "Invoke-AmsiBypass",
                  "Invoke-BruteForce",
                  "Invoke-CredentialsPhish",
                  "Invoke-Decode",
                  "Invoke-Encode",
                  "Invoke-Interceptor",
                  "Invoke-JSRatRegsvr",
                  "Invoke-JSRatRundll",
                  "Invoke-MimikatzWDigestDowngrade",
                  "Invoke-NetworkRelay",
                  "Invoke-PowerShellIcmp",
                  "Invoke-PowerShellUdp",
                  "Invoke-Prasadhak",
                  "Invoke-PSGcat",
                  "Invoke-PsGcatAgent",
                  "Invoke-SessionGopher",
                  "Invoke-SSIDExfil",
                  "LoggedKeys",
                  "Nishang",
                  "NotAllNameSpaces",
                  "Out-CHM",
                  "OUT-DNSTXT",
                  "Out-HTA",
                  "Out-RundllCommand",
                  "Out-SCF",
                  "Out-SCT",
                  "Out-Shortcut",
                  "Out-WebQuery",
                  "Out-Word",
                  "Parse_Keys",
                  "Password-List",
                  "Powerpreter",
                  "Remove-Persistence",
                  "Remove-PoshRat",
                  "Remove-Update",
                  "Run-EXEonRemote",
                  "Set-DCShadowPermissions",
                  "Set-RemotePSRemoting",
                  "Set-RemoteWMI",
                  "Shellcode32",
                  "Shellcode64",
                  "StringtoBase64",
                  "TexttoExe"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Alec Costello",
        "date": "2019-05-16",
        "modified": "2023-01-16",
        "references": [
          "https://github.com/samratashok/nishang"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_nishang_malicious_commandlets.yml"
      }
    },
    {
      "id": "363eccc0-279a-4ccf-a3ab-24c2e63b11fb",
      "title": "Powershell Create Scheduled Task",
      "status": "test",
      "description": "Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.execution",
        "attack.persistence",
        "attack.t1053.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "New-ScheduledTaskAction",
                  "New-ScheduledTaskTrigger",
                  "New-ScheduledTaskPrincipal",
                  "New-ScheduledTaskSettingsSet",
                  "New-ScheduledTask",
                  "Register-ScheduledTask"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_cimmethod": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-CimMethod",
                  "-ClassName",
                  "PS_ScheduledTask",
                  "-NameSpace",
                  "Root\\Microsoft\\Windows\\TaskScheduler"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_legitimate_scripts": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Microsoft.PowerShell.Core\\Export-ModuleMember",
                  "Microsoft.Management.Infrastructure.CimInstance",
                  "__cmdletization_methodParameter"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "1 of selection_* and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "1 of selection_*"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1053.005"
        ],
        "tactics": [
          "privilege_escalation",
          "execution",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "2025-10-07",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1053.005/T1053.005.md#atomic-test-4---powershell-cmdlet-scheduled-task",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1053.005/T1053.005.md#atomic-test-6---wmi-invoke-cimmethod-scheduled-task"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_cmdlet_scheduled_task.yml"
      }
    },
    {
      "id": "dddfebae-c46f-439c-af7a-fdb6bde90218",
      "title": "SyncAppvPublishingServer Execution to Bypass Powershell Restriction",
      "status": "test",
      "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1218"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "SyncAppvPublishingServer.exe",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1218"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Ensar amil, @sblmsrsn, OSCD Community",
        "date": "2020-10-05",
        "modified": "2022-12-25",
        "references": [
          "https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/"
        ],
        "falsepositives": [
          "App-V clients"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_syncappvpublishingserver_exe.yml"
      }
    },
    {
      "id": "603c6630-5225-49c1-8047-26c964553e0e",
      "title": "Enumerate Credentials from Windows Credential Manager With PowerShell",
      "status": "test",
      "description": "Adversaries may search for common password storage locations to obtain user credentials.\nPasswords are stored in several places on a system, depending on the operating system or application holding the credentials.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1555"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmd": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "vaultcmd",
                  "/listcreds:"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_option": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Windows Credentials",
                  "Web Credentials"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1555"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-20",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1555/T1555.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_enumerate_password_windows_credential_manager.yml"
      }
    },
    {
      "id": "d59d7842-9a21-4bc6-ba98-64bfe0091355",
      "title": "Powershell DNSExfiltration",
      "status": "test",
      "description": "DNSExfiltrator allows for transferring (exfiltrate) a file over a DNS request covert channel",
      "level": "high",
      "tags": [
        "attack.exfiltration",
        "attack.t1048"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains": {
                    "field": "ScriptBlockText",
                    "value": "Invoke-DNSExfiltrator",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains_all": {
                    "field": "ScriptBlockText",
                    "value": [
                      " -i ",
                      " -d ",
                      " -p ",
                      " -doh ",
                      " -t "
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection_cmdlet",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_cmdlet"
        }
      },
      "mitre": {
        "techniques": [
          "T1048"
        ],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-07",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048/T1048.md#atomic-test-3---dnsexfiltration-doh",
          "https://github.com/Arno0x/DNSExfiltrator"
        ],
        "falsepositives": [
          "Legitimate script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_dnsexfiltration.yml"
      }
    },
    {
      "id": "c2993223-6da8-4b1a-88ee-668b8bf315e9",
      "title": "User Discovery And Export Via Get-ADUser Cmdlet - PowerShell",
      "status": "test",
      "description": "Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1033"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ADUser ",
                  " -Filter \\*"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " > ",
                  " | Select ",
                  "Out-File",
                  "Set-Content",
                  "Add-Content"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1033"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-11-17",
        "modified": "",
        "references": [
          "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
          "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/"
        ],
        "falsepositives": [
          "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_user_discovery_get_aduser.yml"
      }
    },
    {
      "id": "db92dd33-a3ad-49cf-8c2c-608c3e30ace0",
      "title": "Invoke-Obfuscation Via Use Clip - Powershell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use Clip.exe in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "(?i)echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?)",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-09",
        "modified": "2024-04-15",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_clip.yml"
      }
    },
    {
      "id": "162e69a7-7981-4344-84a9-0f1c9a217a52",
      "title": "Powershell Directory Enumeration",
      "status": "test",
      "description": "Detects technique used by MAZE ransomware to enumerate directories using Powershell",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1083"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "foreach",
                  "Get-ChildItem",
                  "-Path ",
                  "-ErrorAction ",
                  "SilentlyContinue",
                  "Out-File ",
                  "-append"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1083"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1083/T1083.md",
          "https://www.mandiant.com/resources/tactics-techniques-procedures-associated-with-maze-ransomware-incidents"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_directory_enum.yml"
      }
    },
    {
      "id": "d4488827-73af-4f8d-9244-7b7662ef046e",
      "title": "Change User Agents with WebRequest",
      "status": "test",
      "description": "Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic.\nCommands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server.\n",
      "level": "medium",
      "tags": [
        "attack.command-and-control",
        "attack.t1071.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_webrequest": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-WebRequest",
                  "Invoke-RestMethod",
                  " irm ",
                  "iwr "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_useragent": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "-UserAgent ",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1071.001"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-23",
        "modified": "2025-07-18",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1071.001/T1071.001.md#t1071001---web-protocols"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_invoke_webrequest_useragent.yml"
      }
    },
    {
      "id": "991a9744-f2f0-44f2-bd33-9092eba17dc3",
      "title": "Enable Windows Remote Management",
      "status": "test",
      "description": "Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user.",
      "level": "medium",
      "tags": [
        "attack.lateral-movement",
        "attack.t1021.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Enable-PSRemoting ",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_cmdlet",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_cmdlet"
        }
      },
      "mitre": {
        "techniques": [
          "T1021.006"
        ],
        "tactics": [
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-07",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.006/T1021.006.md#atomic-test-1---enable-windows-remote-management",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.2"
        ],
        "falsepositives": [
          "Legitimate script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_enable_psremoting.yml"
      }
    },
    {
      "id": "8bc063d5-3a3a-4f01-a140-bc15e55e8437",
      "title": "Suspicious GetTypeFromCLSID ShellExecute",
      "status": "test",
      "description": "Detects suspicious Powershell code that execute COM Objects",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.persistence",
        "attack.t1546.015"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "::GetTypeFromCLSID(",
                  ".ShellExecute("
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1546.015"
        ],
        "tactics": [
          "privilege_escalation",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-04-02",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.015/T1546.015.md#atomic-test-2---powershell-execute-com-object"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_gettypefromclsid.yml"
      }
    },
    {
      "id": "99c4658d-2c5e-4d87-828d-7c066ca537c3",
      "title": "Disable-WindowsOptionalFeature Command PowerShell",
      "status": "test",
      "description": "Detect built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool.\nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\n",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmd": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Disable-WindowsOptionalFeature",
                  "-Online",
                  "-FeatureName"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_feature": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Windows-Defender-Gui",
                  "Windows-Defender-Features",
                  "Windows-Defender",
                  "Windows-Defender-ApplicationGuard"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-09-10",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/5b67c9b141fa3918017f8fa44f2f88f0b1ecb9e1/atomics/T1562.001/T1562.001.md",
          "https://learn.microsoft.com/en-us/powershell/module/dism/disable-windowsoptionalfeature?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_disable_windows_optional_feature.yml"
      }
    },
    {
      "id": "cdfa73b6-3c9d-4bb8-97f8-ddbd8921f5c5",
      "title": "Potential Unconstrained Delegation Discovery Via Get-ADComputer - ScriptBlock",
      "status": "experimental",
      "description": "Detects the use of the \"Get-ADComputer\" cmdlet in order to identify systems which are configured for unconstrained delegation.",
      "level": "medium",
      "tags": [
        "attack.reconnaissance",
        "attack.discovery",
        "attack.credential-access",
        "attack.t1018",
        "attack.t1558",
        "attack.t1589.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-Properties*TrustedForDelegation",
                  "-Properties*TrustedToAuthForDelegation",
                  "-Properties*msDS-AllowedToDelegateTo",
                  "-Properties*PrincipalsAllowedToDelegateToAccount",
                  "-LDAPFilter*(userAccountControl:1.2.840.113556.1.4.803:=524288)"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1018",
          "T1558",
          "T1589.002"
        ],
        "tactics": [
          "reconnaissance",
          "discovery",
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2025-03-05",
        "modified": "",
        "references": [
          "https://pentestlab.blog/2022/03/21/unconstrained-delegation/",
          "https://learn.microsoft.com/en-us/powershell/module/activedirectory/get-adcomputer?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate use of the library for administrative activity"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_potential_unconstrained_delegation_discovery.yml"
      }
    },
    {
      "id": "b7a3c9a3-09ea-4934-8864-6a32cacd98d9",
      "title": "Zip A Folder With PowerShell For Staging In Temp - PowerShell Script",
      "status": "test",
      "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1074.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Compress-Archive -Path*-DestinationPath $env:TEMP",
                  "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                  "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1074.001"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
        "date": "2021-07-20",
        "modified": "2023-12-18",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
          "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_zip_compress.yml"
      }
    },
    {
      "id": "c5ac6a1e-9407-45f5-a0ce-ca9a0806a287",
      "title": "Replace Desktop Wallpaper by Powershell",
      "status": "test",
      "description": "An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users.\nThis may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper\n",
      "level": "low",
      "tags": [
        "attack.impact",
        "attack.t1491.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_1": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ItemProperty",
                  "Registry::",
                  "HKEY_CURRENT_USER\\Control Panel\\Desktop\\",
                  "WallPaper"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "SystemParametersInfo(20,0,*,3)",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1491.001"
        ],
        "tactics": [
          "impact"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-26",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1491.001/T1491.001.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_wallpaper.yml"
      }
    },
    {
      "id": "91109523-17f0-4248-a800-f81d9e7c081d",
      "title": "PowerShell WMI Win32_Product Install MSI",
      "status": "test",
      "description": "Detects the execution of an MSI file using PowerShell and the WMI Win32_Product class",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1218.007"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-CimMethod ",
                  "-ClassName ",
                  "Win32_Product ",
                  "-MethodName ",
                  ".msi"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1218.007"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-04-24",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_win32_product_install_msi.yml"
      }
    },
    {
      "id": "34f90d3c-c297-49e9-b26d-911b05a4866c",
      "title": "Powershell Keylogging",
      "status": "test",
      "description": "Adversaries may log user keystrokes to intercept credentials as the user types them.",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.collection",
        "attack.t1056.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_basic": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-Keystrokes",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_high": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ProcAddress user32.dll GetAsyncKeyState",
                  "Get-ProcAddress user32.dll GetForegroundWindow"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1056.001"
        ],
        "tactics": [
          "credential_access",
          "collection"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-07-30",
        "modified": "2022-07-11",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218/T1218.md",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1056.001/src/Get-Keystrokes.ps1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_keylogging.yml"
      }
    },
    {
      "id": "2837e152-93c8-43d2-85ba-c3cd3c2ae614",
      "title": "Powershell Local Email Collection",
      "status": "test",
      "description": "Adversaries may target user email on local systems to collect sensitive information.\nFiles containing email data can be acquired from a users local system, such as Outlook storage or cache files.\n",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1114.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-Inbox.ps1",
                  "Microsoft.Office.Interop.Outlook",
                  "Microsoft.Office.Interop.Outlook.olDefaultFolders",
                  "-comobject outlook.application"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1114.001"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-07-21",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1114.001/T1114.001.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_mail_acces.yml"
      }
    },
    {
      "id": "504d63cb-0dba-4d02-8531-e72981aace2c",
      "title": "Suspicious X509Enrollment - Ps Script",
      "status": "test",
      "description": "Detect use of X509Enrollment",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1553.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "X509Enrollment.CBinaryConverter",
                  "884e2002-217d-11da-b2a4-000e7bbb2b09"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1553.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-12-23",
        "modified": "",
        "references": [
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=42",
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=41",
          "https://learn.microsoft.com/en-us/dotnet/api/microsoft.hpc.scheduler.store.cx509enrollmentwebclassfactoryclass?view=hpc-sdk-5.1.6115"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_x509enrollment.yml"
      }
    },
    {
      "id": "21f9162c-5f5d-4b01-89a8-b705bd7d10ab",
      "title": "Import PowerShell Modules From Suspicious Directories",
      "status": "test",
      "description": "Detects powershell scripts that import modules from suspicious directories",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Import-Module \"$Env:Temp\\",
                  "Import-Module '$Env:Temp\\",
                  "Import-Module $Env:Temp\\",
                  "Import-Module \"$Env:Appdata\\",
                  "Import-Module '$Env:Appdata\\",
                  "Import-Module $Env:Appdata\\",
                  "Import-Module C:\\Users\\Public\\",
                  "ipmo \"$Env:Temp\\",
                  "ipmo '$Env:Temp\\",
                  "ipmo $Env:Temp\\",
                  "ipmo \"$Env:Appdata\\",
                  "ipmo '$Env:Appdata\\",
                  "ipmo $Env:Appdata\\",
                  "ipmo C:\\Users\\Public\\"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-07-07",
        "modified": "2023-01-10",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_import_module_susp_dirs.yml"
      }
    },
    {
      "id": "779c8c12-0eb1-11eb-adc1-0242ac120002",
      "title": "Invoke-Obfuscation STDIN+ Launcher - Powershell",
      "status": "test",
      "description": "Detects Obfuscated use of stdin to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "cmd.{0,5}(?:/c|/r).+powershell.+(?:\\$?\\{?input\\}?|noexit).+\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-15",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_stdin.yml"
      }
    },
    {
      "id": "e54f5149-6ba3-49cf-b153-070d24679126",
      "title": "Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via VAR++ LAUNCHER",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "(?i)&&set.*(\\{\\d\\}){2,}\\\\\"\\s+?-f.*&&.*cmd.*/c",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-13",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_var.yml"
      }
    },
    {
      "id": "bd5971a7-626d-46ab-8176-ed643f694f68",
      "title": "Extracting Information with PowerShell",
      "status": "test",
      "description": "Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials.\nThese can be files created by users to store their own credentials, shared credential stores for a group of individuals,\nconfiguration files containing passwords for a system or service, or source code/binary files containing embedded passwords.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1552.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "ls",
                  " -R",
                  "select-string ",
                  "-Pattern "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1552.001"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-19",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.001/T1552.001.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_extracting.yml"
      }
    },
    {
      "id": "2650dd1a-eb2a-412d-ac36-83f06c4f2282",
      "title": "Detected Windows Software Discovery - PowerShell",
      "status": "test",
      "description": "Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1518"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "get-itemProperty",
                  "\\software\\",
                  "select-object",
                  "format-table"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1518"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-16",
        "modified": "2022-12-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518/T1518.md",
          "https://github.com/harleyQu1nn/AggressorScripts"
        ],
        "falsepositives": [
          "Legitimate administration activities"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_software_discovery.yml"
      }
    },
    {
      "id": "0718cd72-f316-4aa2-988f-838ea8533277",
      "title": "Suspicious Start-Process PassThru",
      "status": "test",
      "description": "Powershell use PassThru option to start in background",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1036.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Start-Process",
                  "-PassThru ",
                  "-FilePath "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1036.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-15",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1036.003/T1036.003.md",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/Start-Process?view=powershell-5.1&viewFallbackFrom=powershell-7"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_start_process.yml"
      }
    },
    {
      "id": "2a0a169d-cc66-43ce-9ae2-6e678e54e46a",
      "title": "Registry Modification Attempt Via VBScript - PowerShell",
      "status": "experimental",
      "description": "Detects attempts to modify the registry using VBScript's CreateObject(\"Wscript.shell\") and RegWrite methods embedded within PowerShell scripts or commands.\nThreat actors commonly embed VBScript code within PowerShell to perform registry modifications, attempting to evade detection that monitors for direct registry access through traditional tools.\nThis technique can be used for persistence, defense evasion, and privilege escalation by modifying registry keys without using regedit.exe, reg.exe, or PowerShell's native registry cmdlets.\n",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.persistence",
        "attack.execution",
        "attack.t1112",
        "attack.t1059.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "CreateObject",
                  "Wscript.shell",
                  ".RegWrite"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1112",
          "T1059.005"
        ],
        "tactics": [
          "defense_evasion",
          "persistence",
          "execution"
        ]
      },
      "meta": {
        "author": "Swachchhanda Shrawan Poudel (Nextron Systems)",
        "date": "2025-08-13",
        "modified": "",
        "references": [
          "https://www.linkedin.com/posts/mauricefielenbach_livingofftheland-redteam-persistence-activity-7344801774182051843-TE00/",
          "https://www.nextron-systems.com/2025/07/29/detecting-the-most-popular-mitre-persistence-method-registry-run-keys-startup-folder/",
          "https://detect.fyi/hunting-fileless-malware-in-the-windows-registry-1339ccde00ad"
        ],
        "falsepositives": [
          "Some legitimate admin or install scripts may use these processes for registry modifications."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_vbscript_registry_modification.yml"
      }
    },
    {
      "id": "d2e3f2f6-7e09-4bf2-bc5d-90186809e7fb",
      "title": "PowerShell Script With File Upload Capabilities",
      "status": "test",
      "description": "Detects PowerShell scripts leveraging the \"Invoke-WebRequest\" cmdlet to send data via either \"PUT\" or \"POST\" method.",
      "level": "low",
      "tags": [
        "attack.exfiltration",
        "attack.t1020"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-RestMethod",
                  "Invoke-WebRequest",
                  "irm ",
                  "iwr "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_flag": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-Method \"POST\"",
                  "-Method \"PUT\"",
                  "-Method POST",
                  "-Method PUT",
                  "-Method 'POST'",
                  "-Method 'PUT'"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1020"
        ],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-07",
        "modified": "2025-07-18",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1020/T1020.md",
          "https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest?view=powershell-7.4"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_script_with_upload_capabilities.yml"
      }
    },
    {
      "id": "189e3b02-82b2-4b90-9662-411eb64486d4",
      "title": "Potential Invoke-Mimikatz PowerShell Script",
      "status": "test",
      "description": "Detects Invoke-Mimikatz PowerShell script and alike. Mimikatz is a credential dumper capable of obtaining plaintext Windows account logins and passwords.",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_1": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "DumpCreds",
                  "DumpCerts"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "sekurlsa::logonpasswords",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_3": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "crypto::certificates",
                  "CERT_SYSTEM_STORE_LOCAL_MACHINE"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Tim Rauch, Elastic (idea)",
        "date": "2022-09-28",
        "modified": "",
        "references": [
          "https://www.elastic.co/guide/en/security/current/potential-invoke-mimikatz-powershell-script.html#potential-invoke-mimikatz-powershell-script"
        ],
        "falsepositives": [
          "Mimikatz can be useful for testing the security of networks"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_potential_invoke_mimikatz.yml"
      }
    },
    {
      "id": "af4c87ce-bdda-4215-b998-15220772e993",
      "title": "Suspicious Process Discovery With Get-Process",
      "status": "test",
      "description": "Get the processes that are running on the local computer.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1057"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-Process",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1057"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1057/T1057.md#atomic-test-3---process-discovery---get-process",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-process?view=powershell-7.4"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_get_process.yml"
      }
    },
    {
      "id": "89819aa4-bbd6-46bc-88ec-c7f7fe30efa6",
      "title": "Malicious PowerShell Commandlets - ScriptBlock",
      "status": "test",
      "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.discovery",
        "attack.t1482",
        "attack.t1087",
        "attack.t1087.001",
        "attack.t1087.002",
        "attack.t1069.001",
        "attack.t1069.002",
        "attack.t1069",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-Exfiltration",
                  "Add-Persistence",
                  "Add-RegBackdoor",
                  "Add-RemoteRegBackdoor",
                  "Add-ScrnSaveBackdoor",
                  "ConvertTo-Rc4ByteStream",
                  "Decrypt-Hash",
                  "Disable-ADIDNSNode",
                  "Do-Exfiltration",
                  "Enable-ADIDNSNode",
                  "Enabled-DuplicateToken",
                  "Exploit-Jboss",
                  "Export-ADRCSV",
                  "Export-ADRExcel",
                  "Export-ADRHTML",
                  "Export-ADRJSON",
                  "Export-ADRXML",
                  "Find-Fruit",
                  "Find-GPOLocation",
                  "Find-TrustedDocuments",
                  "Get-ADIDNSNodeAttribute",
                  "Get-ADIDNSNodeOwner",
                  "Get-ADIDNSNodeTombstoned",
                  "Get-ADIDNSPermission",
                  "Get-ADIDNSZone",
                  "Get-ChromeDump",
                  "Get-ClipboardContents",
                  "Get-FoxDump",
                  "Get-GPPPassword",
                  "Get-IndexedItem",
                  "Get-KerberosAESKey",
                  "Get-Keystrokes",
                  "Get-LSASecret",
                  "Get-PassHashes",
                  "Get-RegAlwaysInstallElevated",
                  "Get-RegAutoLogon",
                  "Get-RemoteBootKey",
                  "Get-RemoteCachedCredential",
                  "Get-RemoteLocalAccountHash",
                  "Get-RemoteLSAKey",
                  "Get-RemoteMachineAccountHash",
                  "Get-RemoteNLKMKey",
                  "Get-RickAstley",
                  "Get-SecurityPackages",
                  "Get-ServiceFilePermission",
                  "Get-ServicePermission",
                  "Get-ServiceUnquoted",
                  "Get-SiteListPassword",
                  "Get-System",
                  "Get-TimedScreenshot",
                  "Get-UnattendedInstallFile",
                  "Get-Unconstrained",
                  "Get-USBKeystrokes",
                  "Get-VaultCredential",
                  "Get-VulnAutoRun",
                  "Get-VulnSchTask",
                  "Grant-ADIDNSPermission",
                  "Gupt-Backdoor",
                  "Invoke-ACLScanner",
                  "Invoke-ADRecon",
                  "Invoke-ADSBackdoor",
                  "Invoke-AgentSmith",
                  "Invoke-AllChecks",
                  "Invoke-ARPScan",
                  "Invoke-AzureHound",
                  "Invoke-BackdoorLNK",
                  "Invoke-BadPotato",
                  "Invoke-BetterSafetyKatz",
                  "Invoke-BypassUAC",
                  "Invoke-Carbuncle",
                  "Invoke-Certify",
                  "Invoke-ConPtyShell",
                  "Invoke-CredentialInjection",
                  "Invoke-DAFT",
                  "Invoke-DCSync",
                  "Invoke-DinvokeKatz",
                  "Invoke-DllInjection",
                  "Invoke-DNSUpdate",
                  "Invoke-DNSExfiltrator",
                  "Invoke-DomainPasswordSpray",
                  "Invoke-DowngradeAccount",
                  "Invoke-EgressCheck",
                  "Invoke-Eyewitness",
                  "Invoke-FakeLogonScreen",
                  "Invoke-Farmer",
                  "Invoke-Get-RBCD-Threaded",
                  "Invoke-Gopher",
                  "Invoke-Grouper",
                  "Invoke-HandleKatz",
                  "Invoke-ImpersonatedProcess",
                  "Invoke-ImpersonateSystem",
                  "Invoke-InteractiveSystemPowerShell",
                  "Invoke-Internalmonologue",
                  "Invoke-Inveigh",
                  "Invoke-InveighRelay",
                  "Invoke-KrbRelay",
                  "Invoke-LdapSignCheck",
                  "Invoke-Lockless",
                  "Invoke-MalSCCM",
                  "Invoke-Mimikatz",
                  "Invoke-Mimikittenz",
                  "Invoke-MITM6",
                  "Invoke-NanoDump",
                  "Invoke-NetRipper",
                  "Invoke-Nightmare",
                  "Invoke-NinjaCopy",
                  "Invoke-OfficeScrape",
                  "Invoke-OxidResolver",
                  "Invoke-P0wnedshell",
                  "Invoke-Paranoia",
                  "Invoke-PortScan",
                  "Invoke-PoshRatHttp",
                  "Invoke-PostExfil",
                  "Invoke-PowerDump",
                  "Invoke-PowerDPAPI",
                  "Invoke-PowerShellTCP",
                  "Invoke-PowerShellWMI",
                  "Invoke-PPLDump",
                  "Invoke-PsExec",
                  "Invoke-PSInject",
                  "Invoke-PsUaCme",
                  "Invoke-ReflectivePEInjection",
                  "Invoke-ReverseDNSLookup",
                  "Invoke-Rubeus",
                  "Invoke-RunAs",
                  "Invoke-SafetyKatz",
                  "Invoke-SauronEye",
                  "Invoke-SCShell",
                  "Invoke-Seatbelt",
                  "Invoke-ServiceAbuse",
                  "Invoke-ShadowSpray",
                  "Invoke-Sharp",
                  "Invoke-Shellcode",
                  "Invoke-SMBScanner",
                  "Invoke-Snaffler",
                  "Invoke-Spoolsample",
                  "Invoke-SpraySinglePassword",
                  "Invoke-SSHCommand",
                  "Invoke-StandIn",
                  "Invoke-StickyNotesExtract",
                  "Invoke-SystemCommand",
                  "Invoke-Tasksbackdoor",
                  "Invoke-Tater",
                  "Invoke-Thunderfox",
                  "Invoke-ThunderStruck",
                  "Invoke-TokenManipulation",
                  "Invoke-Tokenvator",
                  "Invoke-TotalExec",
                  "Invoke-UrbanBishop",
                  "Invoke-UserHunter",
                  "Invoke-VoiceTroll",
                  "Invoke-Whisker",
                  "Invoke-WinEnum",
                  "Invoke-winPEAS",
                  "Invoke-WireTap",
                  "Invoke-WmiCommand",
                  "Invoke-WMIExec",
                  "Invoke-WScriptBypassUAC",
                  "Invoke-Zerologon",
                  "MailRaider",
                  "New-ADIDNSNode",
                  "New-HoneyHash",
                  "New-InMemoryModule",
                  "New-SOASerialNumberArray",
                  "Out-Minidump",
                  "PowerBreach",
                  "powercat ",
                  "PowerUp",
                  "PowerView",
                  "Remove-ADIDNSNode",
                  "Remove-Update",
                  "Rename-ADIDNSNode",
                  "Revoke-ADIDNSPermission",
                  "Set-ADIDNSNode",
                  "Show-TargetScreen",
                  "Start-CaptureServer",
                  "Start-Dnscat2",
                  "Start-WebcamRecorder",
                  "VolumeShadowCopyTools"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_optional_amazon_ec2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-SystemDriveInfo",
                  "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Module\\"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_optional_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1482",
          "T1087",
          "T1087.001",
          "T1087.002",
          "T1069.001",
          "T1069.002",
          "T1069",
          "T1059.001"
        ],
        "tactics": [
          "execution",
          "discovery"
        ]
      },
      "meta": {
        "author": "Sean Metcalf, Florian Roth, Bartlomiej Czyz @bczyz1, oscd.community, Nasreddine Bencherchali, Tim Shelton, Mustafa Kaan Demir, Georg Lauenstein, Max Altgelt, Tobias Michalski, Austin Songer",
        "date": "2017-03-05",
        "modified": "2025-12-10",
        "references": [
          "https://adsecurity.org/?p=2921",
          "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
          "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
          "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
          "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
          "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
          "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
          "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
          "https://github.com/calebstewart/CVE-2021-1675",
          "https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1",
          "https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html",
          "https://github.com/HarmJ0y/DAMP",
          "https://github.com/samratashok/nishang",
          "https://github.com/DarkCoderSc/PowerRunAsSystem/",
          "https://github.com/besimorhino/powercat",
          "https://github.com/Kevin-Robertson/Powermad",
          "https://github.com/adrecon/ADRecon",
          "https://github.com/adrecon/AzureADRecon",
          "https://github.com/The-Viper-One/Invoke-PowerDPAPI/",
          "https://github.com/Arno0x/DNSExfiltrator/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_malicious_commandlets.yml"
      }
    },
    {
      "id": "3c7d1587-3b13-439f-9941-7d14313dbdfe",
      "title": "Potential COM Objects Download Cradles Usage - PS Script",
      "status": "test",
      "description": "Detects usage of COM objects that can be abused to download files in PowerShell by CLSID",
      "level": "medium",
      "tags": [
        "attack.command-and-control",
        "attack.t1105"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_1": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "[Type]::GetTypeFromCLSID(",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "0002DF01-0000-0000-C000-000000000046",
                  "F6D90F16-9C73-11D3-B32E-00C04F990BB4",
                  "F5078F35-C551-11D3-89B9-0000F81FE221",
                  "88d96a0a-f192-11d4-a65f-0040963251e5",
                  "AFBA6B42-5692-48EA-8141-DC517DCF0EF1",
                  "AFB40FFD-B609-40A3-9828-F88BBE11E4E3",
                  "88d96a0b-f192-11d4-a65f-0040963251e5",
                  "2087c2f4-2cef-4953-a8ab-66779b670495",
                  "000209FF-0000-0000-C000-000000000046",
                  "00024500-0000-0000-C000-000000000046"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1105"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-12-25",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/dotnet/api/system.type.gettypefromclsid?view=net-7.0",
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=57"
        ],
        "falsepositives": [
          "Legitimate use of the library"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_download_com_cradles.yml"
      }
    },
    {
      "id": "902cedee-0398-4e3a-8183-6f3a89773a96",
      "title": "Suspicious Invoke-Item From Mount-DiskImage",
      "status": "test",
      "description": "Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1553.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Mount-DiskImage ",
                  "-ImagePath ",
                  "Get-Volume",
                  ".DriveLetter",
                  "invoke-item ",
                  "):\\"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1553.005"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-01",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.005/T1553.005.md#atomic-test-2---mount-an-iso-image-and-run-executable-from-the-iso",
          "https://learn.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_run_from_mount_diskimage.yml"
      }
    },
    {
      "id": "a861d835-af37-4930-bcd6-5b178bfb54df",
      "title": "Suspicious Kerberos Ticket Request via PowerShell Script - ScriptBlock",
      "status": "test",
      "description": "Detects PowerShell scripts that utilize native PowerShell Identity modules to request Kerberos tickets.\nThis behavior is typically seen during a Kerberos or silver ticket attack. A successful execution will output the SPNs for the endpoint in question.\n",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1558.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "System.IdentityModel.Tokens.KerberosRequestorSecurityToken",
                  ".GetRequest()"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1558.003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "2025-11-18",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1558.003/T1558.003.md#atomic-test-4---request-a-single-ticket-via-powershell",
          "https://learn.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.kerberosrequestorsecuritytoken?view=netframework-4.8.1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_request_kerberos_ticket.yml"
      }
    },
    {
      "id": "976d6e6f-a04b-4900-9713-0134a353e38b",
      "title": "Veeam Backup Servers Credential Dumping Script Execution",
      "status": "test",
      "description": "Detects execution of a PowerShell script that contains calls to the \"Veeam.Backup\" class, in order to dump stored credentials.",
      "level": "high",
      "tags": [
        "attack.credential-access"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "[Credentials]",
                  "[Veeam.Backup.Common.ProtectedStorage]::GetLocalString",
                  "Invoke-Sqlcmd",
                  "Veeam Backup and Replication"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-05-04",
        "modified": "",
        "references": [
          "https://www.pwndefend.com/2021/02/15/retrieving-passwords-from-veeam-backup-servers/",
          "https://labs.withsecure.com/publications/fin7-target-veeam-servers"
        ],
        "falsepositives": [
          "Administrators backup scripts (must be investigated)"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_veeam_credential_dumping_script.yml"
      }
    },
    {
      "id": "55c925c1-7195-426b-a136-a9396800e29b",
      "title": "Potential Suspicious Windows Feature Enabled",
      "status": "test",
      "description": "Detects usage of the built-in PowerShell cmdlet \"Enable-WindowsOptionalFeature\" used as a Deployment Image Servicing and Management tool.\nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\n",
      "level": "medium",
      "tags": [
        "attack.defense-evasion"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmd": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Enable-WindowsOptionalFeature",
                  "-Online",
                  "-FeatureName"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_feature": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "TelnetServer",
                  "Internet-Explorer-Optional-amd64",
                  "TFTP",
                  "SMB1Protocol",
                  "Client-ProjFS",
                  "Microsoft-Windows-Subsystem-Linux"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-09-10",
        "modified": "2022-12-29",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/dism/enable-windowsoptionalfeature?view=windowsserver2022-ps",
          "https://learn.microsoft.com/en-us/windows/win32/projfs/enabling-windows-projected-file-system",
          "https://learn.microsoft.com/en-us/windows/wsl/install-on-server"
        ],
        "falsepositives": [
          "Legitimate usage of the features listed in the rule."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_enable_susp_windows_optional_feature.yml"
      }
    },
    {
      "id": "dcd74b95-3f36-4ed9-9598-0490951643aa",
      "title": "PowerView PowerShell Cmdlets - ScriptBlock",
      "status": "test",
      "description": "Detects Cmdlet names from PowerView of the PowerSploit exploitation framework.",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Export-PowerViewCSV",
                  "Find-DomainLocalGroupMember",
                  "Find-DomainObjectPropertyOutlier",
                  "Find-DomainProcess",
                  "Find-DomainShare",
                  "Find-DomainUserEvent",
                  "Find-DomainUserLocation",
                  "Find-ForeignGroup",
                  "Find-ForeignUser",
                  "Find-GPOComputerAdmin",
                  "Find-GPOLocation",
                  "Find-InterestingDomain",
                  "Find-InterestingFile",
                  "Find-LocalAdminAccess",
                  "Find-ManagedSecurityGroups",
                  "Get-CachedRDPConnection",
                  "Get-DFSshare",
                  "Get-DomainDFSShare",
                  "Get-DomainDNSRecord",
                  "Get-DomainDNSZone",
                  "Get-DomainFileServer",
                  "Get-DomainGPOComputerLocalGroupMapping",
                  "Get-DomainGPOLocalGroup",
                  "Get-DomainGPOUserLocalGroupMapping",
                  "Get-LastLoggedOn",
                  "Get-LoggedOnLocal",
                  "Get-NetFileServer",
                  "Get-NetForest",
                  "Get-NetGPOGroup",
                  "Get-NetProcess",
                  "Get-NetRDPSession",
                  "Get-RegistryMountedDrive",
                  "Get-RegLoggedOn",
                  "Get-WMIRegCachedRDPConnection",
                  "Get-WMIRegLastLoggedOn",
                  "Get-WMIRegMountedDrive",
                  "Get-WMIRegProxy",
                  "Invoke-ACLScanner",
                  "Invoke-CheckLocalAdminAccess",
                  "Invoke-EnumerateLocalAdmin",
                  "Invoke-EventHunter",
                  "Invoke-FileFinder",
                  "Invoke-Kerberoast",
                  "Invoke-MapDomainTrust",
                  "Invoke-ProcessHunter",
                  "Invoke-RevertToSelf",
                  "Invoke-ShareFinder",
                  "Invoke-UserHunter",
                  "Invoke-UserImpersonation",
                  "Remove-RemoteConnection",
                  "Request-SPNTicket",
                  "Resolve-IPAddress"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Bhabesh Raj",
        "date": "2021-05-18",
        "modified": "2023-11-22",
        "references": [
          "https://powersploit.readthedocs.io/en/stable/Recon/README",
          "https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon",
          "https://thedfirreport.com/2020/10/08/ryuks-return",
          "https://adsecurity.org/?p=2277"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_powerview_malicious_commandlets.yml"
      }
    },
    {
      "id": "402e1e1d-ad59-47b6-bf80-1ee44985b3a7",
      "title": "Malicious ShellIntel PowerShell Commandlets",
      "status": "test",
      "description": "Detects Commandlet names from ShellIntel exploitation scripts.",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-SMBAutoBrute",
                  "Invoke-GPOLinks",
                  "Invoke-Potato"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)",
        "date": "2021-08-09",
        "modified": "2023-01-02",
        "references": [
          "https://github.com/Shellntel/scripts/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_shellintel_malicious_commandlets.yml"
      }
    },
    {
      "id": "db885529-903f-4c5d-9864-28fe199e6370",
      "title": "Computer Discovery And Export Via Get-ADComputer Cmdlet - PowerShell",
      "status": "test",
      "description": "Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1033"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ADComputer ",
                  " -Filter \\*"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " | Select ",
                  "Out-File",
                  "Set-Content",
                  "Add-Content"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1033"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-11-17",
        "modified": "",
        "references": [
          "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
          "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/",
          "https://www.cisa.gov/uscert/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf"
        ],
        "falsepositives": [
          "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_computer_discovery_get_adcomputer.yml"
      }
    },
    {
      "id": "cacef8fc-9d3d-41f7-956d-455c6e881bc5",
      "title": "Potential RemoteFXvGPUDisablement.EXE Abuse - PowerShell ScriptBlock",
      "status": "test",
      "description": "Detects PowerShell module creation where the module Contents are set to \"function Get-VMRemoteFXPhysicalVideoAdapter\". This could be a sign of potential abuse of the \"RemoteFXvGPUDisablement.exe\" binary which is known to be vulnerable to module load-order hijacking.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1218"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__startswith": {
                "field": "ScriptBlockText",
                "value": "function Get-VMRemoteFXPhysicalVideoAdapter {",
                "modifiers": [
                  "startswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1218"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-05-09",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218/T1218.md",
          "https://github.com/redcanaryco/AtomicTestHarnesses/blob/7e1e4da116801e3d6fcc6bedb207064577e40572/TestHarnesses/T1218_SignedBinaryProxyExecution/InvokeRemoteFXvGPUDisablementCommand.ps1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_remotefxvgpudisablement_abuse.yml"
      }
    },
    {
      "id": "a0edd39f-a0c6-4c17-8141-261f958e8d8f",
      "title": "PowerShell Remote Session Creation",
      "status": "test",
      "description": "Adversaries may abuse PowerShell commands and scripts for execution.\nPowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system\n",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-PSSession",
                  "-ComputerName "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-06",
        "modified": "2023-01-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1059.001/T1059.001.md#atomic-test-10---powershell-invoke-downloadcradle",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssession?view=powershell-7.4"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_remote_session_creation.yml"
      }
    },
    {
      "id": "95f0643a-ed40-467c-806b-aac9542ec5ab",
      "title": "Suspicious Get Information for SMB Share",
      "status": "test",
      "description": "Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as\na precursor for Collection and to identify potential systems of interest for Lateral Movement.\nNetworks often contain shared network drives and folders that enable users to access file directories on various systems across a network.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "get-smbshare",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-15",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_smb_share_reco.yml"
      }
    },
    {
      "id": "1f6399cf-2c80-4924-ace1-6fcff3393480",
      "title": "DirectorySearcher Powershell Exploitation",
      "status": "test",
      "description": "Enumerates Active Directory to determine computers that are joined to the domain",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1018"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object ",
                  "System.DirectoryServices.DirectorySearcher",
                  ".PropertiesToLoad.Add",
                  ".findall()",
                  "Properties.name"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1018"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-12",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1018/T1018.md#atomic-test-15---enumerate-domain-computers-within-active-directory-using-directorysearcher"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_directorysearcher.yml"
      }
    },
    {
      "id": "bf72941a-cba0-41ea-b18c-9aca3925690d",
      "title": "PowerShell ADRecon Execution",
      "status": "test",
      "description": "Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7",
      "level": "high",
      "tags": [
        "attack.discovery",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Function Get-ADRExcelComOb",
                  "Get-ADRGPO",
                  "Get-ADRDomainController",
                  "ADRecon-Report.xlsx"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "discovery",
          "execution"
        ]
      },
      "meta": {
        "author": "Bhabesh Raj",
        "date": "2021-07-16",
        "modified": "2022-09-06",
        "references": [
          "https://github.com/sense-of-security/ADRecon/blob/11881a24e9c8b207f31b56846809ce1fb189bcc9/ADRecon.ps1",
          "https://bi-zone.medium.com/from-pentest-to-apt-attack-cybercriminal-group-fin7-disguises-its-malware-as-an-ethical-hackers-c23c9a75e319"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_adrecon_execution.yml"
      }
    },
    {
      "id": "fa6a5a45-3ee2-4529-aa14-ee5edc9e29cb",
      "title": "Suspicious Get Local Groups Information - PowerShell",
      "status": "test",
      "description": "Detects the use of PowerShell modules and cmdlets to gather local group information.\nAdversaries may use local system permission groups to determine which groups exist and which users belong to a particular group such as the local administrators group.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_localgroup": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "get-localgroup ",
                  "get-localgroupmember "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_wmi_module": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "get-wmiobject ",
                  "gwmi ",
                  "get-ciminstance ",
                  "gcim "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_wmi_class": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "win32_group",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_localgroup or all of selection_wmi_*",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "selection_localgroup",
            "all of selection_wmi_*"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-12",
        "modified": "2025-08-22",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
        ],
        "falsepositives": [
          "Inventory scripts or admin tasks"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_local_group_reco.yml"
      }
    },
    {
      "id": "bbb9495b-58fc-4016-b9df-9a3a1b67ca82",
      "title": "Password Policy Discovery With Get-AdDefaultDomainPasswordPolicy",
      "status": "test",
      "description": "Detetcts PowerShell activity in which Get-Addefaultdomainpasswordpolicy is used to get the default password policy for an Active Directory domain.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1201"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-AdDefaultDomainPasswordPolicy",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1201"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1201/T1201.md#atomic-test-9---enumerate-active-directory-password-policy-with-get-addefaultdomainpasswordpolicy",
          "https://learn.microsoft.com/en-us/powershell/module/activedirectory/get-addefaultdomainpasswordpolicy?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_get_addefaultdomainpasswordpolicy.yml"
      }
    },
    {
      "id": "0f017df3-8f5a-414f-ad6b-24aff1128278",
      "title": "Suspicious Eventlog Clear",
      "status": "test",
      "description": "Detects usage of known powershell cmdlets such as \"Clear-EventLog\" to clear the Windows event logs",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains": {
                    "field": "ScriptBlockText",
                    "value": [
                      "Clear-EventLog ",
                      "Remove-EventLog ",
                      "Limit-EventLog ",
                      "Clear-WinEvent "
                    ],
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains_all": {
                    "field": "ScriptBlockText",
                    "value": [
                      "Eventing.Reader.EventLogSession",
                      "ClearLog"
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains_all": {
                    "field": "ScriptBlockText",
                    "value": [
                      "Diagnostics.EventLog",
                      "Clear"
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1070.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)",
        "date": "2022-09-12",
        "modified": "2025-10-06",
        "references": [
          "https://twitter.com/oroneequalsone/status/1568432028361830402",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.001/T1070.001.md",
          "https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html",
          "https://stackoverflow.com/questions/66011412/how-to-clear-a-event-log-in-powershell-7",
          "https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.eventing.reader.eventlogsession.clearlog?view=windowsdesktop-9.0&viewFallbackFrom=dotnet-plat-ext-5.0#System_Diagnostics_Eventing_Reader_EventLogSession_ClearLog_System_String_",
          "https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.eventlog.clear"
        ],
        "falsepositives": [
          "Rare need to clear logs before doing something. Sometimes used by installers or cleaner scripts. The script should be investigated to determine if it's legitimate"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_clear_eventlog.yml"
      }
    },
    {
      "id": "afd3df04-948d-46f6-ae44-25966c44b97f",
      "title": "PSAsyncShell - Asynchronous TCP Reverse Shell",
      "status": "test",
      "description": "Detects the use of PSAsyncShell an Asynchronous TCP Reverse Shell written in powershell",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "PSAsyncShell",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-10-04",
        "modified": "",
        "references": [
          "https://github.com/JoelGMSec/PSAsyncShell"
        ],
        "falsepositives": [
          "Unlikely"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_psasyncshell.yml"
      }
    },
    {
      "id": "3ceb2083-a27f-449a-be33-14ec1b7cc973",
      "title": "Silence.EDA Detection",
      "status": "test",
      "description": "Detects Silence EmpireDNSAgent as described in the Group-IP report",
      "level": "critical",
      "tags": [
        "attack.execution",
        "attack.t1059.001",
        "attack.command-and-control",
        "attack.t1071.004",
        "attack.t1572",
        "attack.impact",
        "attack.t1529",
        "attack.g0091",
        "attack.s0363"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "empire": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "System.Diagnostics.Process",
                  "Stop-Computer",
                  "Restart-Computer",
                  "Exception in execution",
                  "$cmdargs",
                  "Close-Dnscat2Tunnel"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "dnscat": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "set type=$LookupType`nserver",
                  "$Command | nslookup 2>&1 | Out-String",
                  "New-RandomDNSField",
                  "[Convert]::ToString($SYNOptions, 16)",
                  "$Session.Dead = $True",
                  "$Session[\"Driver\"] -eq"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "empire and dnscat",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "empire"
            },
            {
              "type": "ref",
              "value": "dnscat"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001",
          "T1071.004",
          "T1572",
          "T1529"
        ],
        "tactics": [
          "execution",
          "command_and_control",
          "impact"
        ]
      },
      "meta": {
        "author": "Alina Stepchenkova, Group-IB, oscd.community",
        "date": "2019-11-01",
        "modified": "2023-04-03",
        "references": [
          "https://www.group-ib.com/resources/threat-research/silence_2.0.going_global.pdf"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_apt_silence_eda.yml"
      }
    },
    {
      "id": "36fbec91-fa1b-4d5d-8df1-8d8edcb632ad",
      "title": "Code Executed Via Office Add-in XLL File",
      "status": "test",
      "description": "Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system.\nOffice add-ins can be used to add functionality to Office programs\n",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.t1137.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "new-object ",
                  "-ComObject ",
                  ".application",
                  ".RegisterXLL"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1137.006"
        ],
        "tactics": [
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1137.006/T1137.006.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_office_comobject_registerxll.yml"
      }
    },
    {
      "id": "03d83090-8cba-44a0-b02f-0b756a050306",
      "title": "Potential WinAPI Calls Via PowerShell Scripts",
      "status": "test",
      "description": "Detects use of WinAPI functions in PowerShell scripts",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001",
        "attack.t1106"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_injection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "VirtualAlloc",
                  "OpenProcess",
                  "WriteProcessMemory",
                  "CreateRemoteThread"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_token_steal": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "OpenProcessToken",
                  "LookupPrivilegeValue",
                  "AdjustTokenPrivileges"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_duplicate_token": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "OpenProcessToken",
                  "DuplicateTokenEx",
                  "CloseHandle"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_process_write_read": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "WriteProcessMemory",
                  "VirtualAlloc",
                  "ReadProcessMemory",
                  "VirtualFree"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001",
          "T1106"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), Nikita Nazarov, oscd.community",
        "date": "2020-10-06",
        "modified": "2023-06-20",
        "references": [
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_win_api_susp_access.yml"
      }
    },
    {
      "id": "ae2bdd58-0681-48ac-be7f-58ab4e593458",
      "title": "Tamper Windows Defender Remove-MpPreference - ScriptBlockLogging",
      "status": "test",
      "description": "Detects attempts to remove Windows Defender configuration using the 'MpPreference' cmdlet",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_remove": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Remove-MpPreference",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_tamper": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-ControlledFolderAccessProtectedFolders ",
                  "-AttackSurfaceReductionRules_Ids ",
                  "-AttackSurfaceReductionRules_Actions ",
                  "-CheckForSignaturesBeforeRunningScan "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-08-05",
        "modified": "",
        "references": [
          "https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/windows-10-controlled-folder-access-event-search/ba-p/2326088"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_tamper_windows_defender_rem_mp.yml"
      }
    },
    {
      "id": "4368354e-1797-463c-bc39-a309effbe8d7",
      "title": "Powershell Add Name Resolution Policy Table Rule",
      "status": "test",
      "description": "Detects powershell scripts that adds a Name Resolution Policy Table (NRPT) rule for the specified namespace.\nThis will bypass the default DNS server and uses a specified server for answering the query.\n",
      "level": "high",
      "tags": [
        "attack.impact",
        "attack.t1565"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-DnsClientNrptRule",
                  "-Namesp",
                  "-NameSe"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1565"
        ],
        "tactics": [
          "impact"
        ]
      },
      "meta": {
        "author": "Borna Talebi",
        "date": "2021-09-14",
        "modified": "2022-10-09",
        "references": [
          "https://twitter.com/NathanMcNulty/status/1569497348841287681",
          "https://learn.microsoft.com/en-us/powershell/module/dnsclient/add-dnsclientnrptrule?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_add_dnsclient_rule.yml"
      }
    },
    {
      "id": "c1337eb8-921a-4b59-855b-4ba188ddcc42",
      "title": "Deletion of Volume Shadow Copies via WMI with PowerShell - PS Script",
      "status": "test",
      "description": "Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil",
      "level": "high",
      "tags": [
        "attack.impact",
        "attack.t1490"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_get": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-WmiObject",
                  "gwmi",
                  "Get-CimInstance",
                  "gcim"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_shadowcopy": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Win32_ShadowCopy",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_delete": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".Delete()",
                  "Remove-WmiObject",
                  "rwmi",
                  "Remove-CimInstance",
                  "rcim"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1490"
        ],
        "tactics": [
          "impact"
        ]
      },
      "meta": {
        "author": "Tim Rauch, frack113",
        "date": "2022-09-20",
        "modified": "2022-12-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell",
          "https://www.elastic.co/guide/en/security/current/volume-shadow-copy-deletion-via-powershell.html"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_win32_shadowcopy_deletion.yml"
      }
    },
    {
      "id": "115fdba9-f017-42e6-84cf-d5573bf2ddf8",
      "title": "Disable of ETW Trace - Powershell",
      "status": "test",
      "description": "Detects usage of powershell cmdlets to disable or remove ETW trace sessions",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070",
        "attack.t1562.006",
        "car.2016-04-002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_pwsh_remove": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Remove-EtwTraceProvider ",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_pwsh_set": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-EtwTraceProvider ",
                  "0x11"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1070",
          "T1562.006"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-06-28",
        "modified": "2022-11-25",
        "references": [
          "https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_etw_trace_evasion.yml"
      }
    },
    {
      "id": "15b7abbb-8b40-4d01-9ee2-b51994b1d474",
      "title": "Suspicious PowerShell Mailbox SMTP Forward Rule",
      "status": "test",
      "description": "Detects usage of the powerShell Set-Mailbox Cmdlet to set-up an SMTP forwarding rule.",
      "level": "medium",
      "tags": [
        "attack.exfiltration"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Mailbox ",
                  " -DeliverToMailboxAndForward ",
                  " -ForwardingSmtpAddress "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-10-26",
        "modified": "",
        "references": [
          "https://m365internals.com/2022/10/07/hunting-in-on-premises-exchange-server-logs/"
        ],
        "falsepositives": [
          "Legitimate usage of the cmdlet to forward emails"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_exchange_mailbox_smpt_forwarding_rule.yml"
      }
    },
    {
      "id": "e0565f5d-d420-4e02-8a68-ac00d864f9cf",
      "title": "Automated Collection Bookmarks Using Get-ChildItem PowerShell",
      "status": "test",
      "description": "Adversaries may enumerate browser bookmarks to learn more about compromised hosts.\nBrowser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about\ninternal network resources such as servers, tools/dashboards, or other related infrastructure.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1217"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ChildItem",
                  " -Recurse ",
                  " -Path ",
                  " -Filter Bookmarks",
                  " -ErrorAction SilentlyContinue",
                  " -Force"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1217"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-13",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1217/T1217.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_childitem_bookmarks.yml"
      }
    },
    {
      "id": "1c563233-030e-4a07-af8c-ee0490a66d3a",
      "title": "Suspicious New-PSDrive to Admin Share",
      "status": "test",
      "description": "Adversaries may use to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user.",
      "level": "medium",
      "tags": [
        "attack.lateral-movement",
        "attack.t1021.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-PSDrive",
                  "-psprovider ",
                  "filesystem",
                  "-root ",
                  "\\\\\\\\",
                  "$"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1021.002"
        ],
        "tactics": [
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-08-13",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.002/T1021.002.md#atomic-test-2---map-admin-share-powershell",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-psdrive?view=powershell-7.2"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_new_psdrive.yml"
      }
    },
    {
      "id": "91e69562-2426-42ce-a647-711b8152ced6",
      "title": "AADInternals PowerShell Cmdlets Execution - PsScript",
      "status": "test",
      "description": "Detects ADDInternals Cmdlet execution. A tool for administering Azure AD and Office 365. Which can be abused by threat actors to attack Azure AD or Office 365.",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.reconnaissance",
        "attack.discovery",
        "attack.credential-access",
        "attack.impact"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-AADInt",
                  "ConvertTo-AADInt",
                  "Disable-AADInt",
                  "Enable-AADInt",
                  "Export-AADInt",
                  "Find-AADInt",
                  "Get-AADInt",
                  "Grant-AADInt",
                  "Initialize-AADInt",
                  "Install-AADInt",
                  "Invoke-AADInt",
                  "Join-AADInt",
                  "New-AADInt",
                  "Open-AADInt",
                  "Read-AADInt",
                  "Register-AADInt",
                  "Remove-AADInt",
                  "Reset-AADInt",
                  "Resolve-AADInt",
                  "Restore-AADInt",
                  "Save-AADInt",
                  "Search-AADInt",
                  "Send-AADInt",
                  "Set-AADInt",
                  "Start-AADInt",
                  "Unprotect-AADInt",
                  "Update-AADInt"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "execution",
          "reconnaissance",
          "discovery",
          "credential_access",
          "impact"
        ]
      },
      "meta": {
        "author": "Austin Songer (@austinsonger), Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel (Nextron Systems)",
        "date": "2022-12-23",
        "modified": "2025-02-06",
        "references": [
          "https://o365blog.com/aadinternals/",
          "https://github.com/Gerenios/AADInternals"
        ],
        "falsepositives": [
          "Legitimate use of the library for administrative activity"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_aadinternals_cmdlets_execution.yml"
      }
    },
    {
      "id": "313fbb0a-a341-4682-848d-6d6f8c4fab7c",
      "title": "Suspicious PowerShell WindowStyle Option",
      "status": "test",
      "description": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users.\nIn some cases, windows that would typically be displayed when an application carries out an operation can be hidden\n",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1564.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "powershell",
                  "WindowStyle",
                  "Hidden"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  ":\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\",
                  "$PSScriptRoot\\Module\\WorkspaceScriptModule\\WorkspaceScriptModule"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not filter",
        "condition_parsed": {
          "op": "and_not",
          "include": "selection",
          "exclude": "filter"
        }
      },
      "mitre": {
        "techniques": [
          "T1564.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Tim Shelton (fp AWS)",
        "date": "2021-10-20",
        "modified": "2023-01-03",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.003/T1564.003.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_windowstyle.yml"
      }
    },
    {
      "id": "26b692dc-1722-49b2-b496-a8258aa6371d",
      "title": "Clear PowerShell History - PowerShell",
      "status": "test",
      "description": "Detects keywords that could indicate clearing PowerShell history",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection1a": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "del",
                  "Remove-Item",
                  "rm"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection1b": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "(Get-PSReadlineOption).HistorySavePath",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-PSReadlineOption",
                  "HistorySaveStyle",
                  "SaveNothing"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_3": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-PSReadlineOption",
                  "-HistorySaveStyle",
                  "SaveNothing"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_* or all of selection1*",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "1 of selection_*",
            "all of selection1*"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1070.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Ilyas Ochkov, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community",
        "date": "2022-01-25",
        "modified": "2022-12-02",
        "references": [
          "https://gist.github.com/hook-s3c/7363a856c3cdbadeb71085147f042c1a"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_clear_powershell_history.yml"
      }
    },
    {
      "id": "f5d1def8-1de0-4a0e-9794-1f6f27dd605c",
      "title": "PowerShell Hotfix Enumeration",
      "status": "test",
      "description": "Detects call to \"Win32_QuickFixEngineering\" in order to enumerate installed hotfixes often used in \"enum\" scripts by attackers",
      "level": "medium",
      "tags": [
        "attack.discovery"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Win32_QuickFixEngineering",
                  "HotFixID"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-06-21",
        "modified": "",
        "references": [
          "https://github.com/411Hall/JAWS/blob/233f142fcb1488172aa74228a666f6b3c5c48f1d/jaws-enum.ps1"
        ],
        "falsepositives": [
          "Legitimate administration scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_hotfix_enum.yml"
      }
    },
    {
      "id": "42d36aa1-3240-4db0-8257-e0118dcdd9cd",
      "title": "Suspicious Hyper-V Cmdlets",
      "status": "test",
      "description": "Adversaries may carry out malicious operations using a virtual instance to avoid detection",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1564.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "New-VM",
                  "Set-VMFirmware",
                  "Start-VM"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1564.006"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-04-09",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.006/T1564.006.md#atomic-test-3---create-and-start-hyper-v-virtual-machine"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_hyper_v_condlet.yml"
      }
    },
    {
      "id": "48a45d45-8112-416b-8a67-46e03a4b2107",
      "title": "Remove Account From Domain Admin Group",
      "status": "test",
      "description": "Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users.\nAccounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.\n",
      "level": "medium",
      "tags": [
        "attack.impact",
        "attack.t1531"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Remove-ADGroupMember",
                  "-Identity ",
                  "-Members "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1531"
        ],
        "tactics": [
          "impact"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-26",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1531/T1531.md#atomic-test-3---remove-account-from-domain-admin-group"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_remove_adgroupmember.yml"
      }
    },
    {
      "id": "c6438007-e081-42ce-9483-b067fbef33c3",
      "title": "Powershell Timestomp",
      "status": "test",
      "description": "Adversaries may modify file time attributes to hide new or changes to existing files.\nTimestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.\n",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_ioc": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".CreationTime =",
                  ".LastWriteTime =",
                  ".LastAccessTime =",
                  "[IO.File]::SetCreationTime",
                  "[IO.File]::SetLastAccessTime",
                  "[IO.File]::SetLastWriteTime"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_ioc",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_ioc"
        }
      },
      "mitre": {
        "techniques": [
          "T1070.006"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-08-03",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.006/T1070.006.md",
          "https://www.offensive-security.com/metasploit-unleashed/timestomp/"
        ],
        "falsepositives": [
          "Legitimate admin script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_timestomp.yml"
      }
    },
    {
      "id": "eb2fd349-ec67-4caa-9143-d79c7fb34441",
      "title": "Suspicious GPO Discovery With Get-GPO",
      "status": "test",
      "description": "Detect use of Get-GPO to get one GPO or all the GPOs in a domain.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1615"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-GPO",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1615"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-06-04",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1615/T1615.md",
          "https://learn.microsoft.com/en-us/powershell/module/grouppolicy/get-gpo?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_get_gpo.yml"
      }
    },
    {
      "id": "e8314f79-564d-4f79-bc13-fbc0bf2660d8",
      "title": "Potential PowerShell Obfuscation Using Character Join",
      "status": "test",
      "description": "Detects specific techniques often seen used inside of PowerShell scripts to obfscuate Alias creation",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.execution",
        "attack.t1027",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "-Alias",
                  " -Value (-join("
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-09",
        "modified": "",
        "references": [
          "Internal Research"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_alias_obfscuation.yml"
      }
    },
    {
      "id": "20e5497e-331c-4cd5-8d36-935f6e2a9a07",
      "title": "Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via COMPRESS OBFUSCATION",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "new-object",
                  "text.encoding]::ascii"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "system.io.compression.deflatestream",
                  "system.io.streamreader"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__endswith": {
                "field": "ScriptBlockText",
                "value": "readtoend",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-18",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_compress.yml"
      }
    },
    {
      "id": "84c174ab-d3ef-481f-9c86-a50d0b8e3edb",
      "title": "PowerShell Get-Process LSASS in ScriptBlock",
      "status": "test",
      "description": "Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1003.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-Process lsass",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003.001"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2021-04-23",
        "modified": "2022-12-25",
        "references": [
          "https://web.archive.org/web/20220205033028/https://twitter.com/PythonResponder/status/1385064506049630211"
        ],
        "falsepositives": [
          "Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable)"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_getprocess_lsass.yml"
      }
    },
    {
      "id": "904e8e61-8edf-4350-b59c-b905fc8e810c",
      "title": "Security Software Discovery Via Powershell Script",
      "status": "test",
      "description": "Detects calls to \"get-process\" where the output is piped to a \"where-object\" filter to search for security solution processes.\nAdversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-virus\n",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1518.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "get-process | \\?",
                  "get-process | where",
                  "gps | \\?",
                  "gps | where"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_field": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Company -like",
                  "Description -like",
                  "Name -like",
                  "Path -like",
                  "Product -like"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_keywords": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "\\*avira\\*",
                  "\\*carbonblack\\*",
                  "\\*cylance\\*",
                  "\\*defender\\*",
                  "\\*kaspersky\\*",
                  "\\*malware\\*",
                  "\\*sentinel\\*",
                  "\\*symantec\\*",
                  "\\*virus\\*"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1518.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113, Anish Bogati, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2021-12-16",
        "modified": "2023-10-24",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md#atomic-test-2---security-software-discovery---powershell"
        ],
        "falsepositives": [
          "False positives might occur due to the nature of the ScriptBlock being ingested as a big blob. Initial tuning is required.",
          "As the \"selection_cmdlet\" is common in scripts the matching engine might slow down the search. Change into regex or a more accurate string to avoid heavy resource consumption if experienced"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_process_security_software_discovery.yml"
      }
    },
    {
      "id": "da34e323-1e65-42db-83be-a6725ac2caa3",
      "title": "Potential Packet Capture Activity Via Start-NetEventSession - ScriptBlock",
      "status": "test",
      "description": "Detects the execution of powershell scripts with calls to the \"Start-NetEventSession\" cmdlet. Which allows an attacker to start event and packet capture for a network event session.\nAdversaries may attempt to capture network to gather information over the course of an operation.\nData captured via this technique may include user credentials, especially those sent over an insecure, unencrypted protocol.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.discovery",
        "attack.t1040"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Start-NetEventSession",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1040"
        ],
        "tactics": [
          "credential_access",
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2024-05-12",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/5f866ca4517e837c4ea576e7309d0891e78080a8/atomics/T1040/T1040.md#atomic-test-16---powershell-network-sniffing",
          "https://github.com/0xsyr0/Awesome-Cybersecurity-Handbooks/blob/7b8935fe4c82cb64d61343de1a8b2e38dd968534/handbooks/10_post_exploitation.md",
          "https://github.com/forgottentq/powershell/blob/9e616363d497143dc955c4fdce68e5c18d28a6cb/captureWindows-Endpoint.ps1#L13"
        ],
        "falsepositives": [
          "Legitimate network diagnostic scripts."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_packet_capture.yml"
      }
    },
    {
      "id": "cd185561-4760-45d6-a63e-a51325112cae",
      "title": "Live Memory Dump Using Powershell",
      "status": "test",
      "description": "Detects usage of a PowerShell command to dump the live memory of a Windows machine",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-StorageDiagnosticInfo",
                  "-IncludeLiveDump"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Max Altgelt (Nextron Systems)",
        "date": "2021-09-21",
        "modified": "2022-12-25",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/storage/get-storagediagnosticinfo?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Diagnostics"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_memorydump_getstoragediagnosticinfo.yml"
      }
    },
    {
      "id": "4fdc44df-bfe9-4fcc-b041-68f5a2d3031c",
      "title": "Powershell LocalAccount Manipulation",
      "status": "test",
      "description": "Adversaries may manipulate accounts to maintain access to victim systems.\nAccount manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups\n",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.persistence",
        "attack.t1098"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Disable-LocalUser",
                  "Enable-LocalUser",
                  "Get-LocalUser",
                  "Set-LocalUser",
                  "New-LocalUser",
                  "Rename-LocalUser",
                  "Remove-LocalUser"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1098"
        ],
        "tactics": [
          "privilege_escalation",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1098/T1098.md#atomic-test-1---admin-account-manipulate",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/?view=powershell-5.1"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_localuser.yml"
      }
    },
    {
      "id": "05b3e303-faf0-4f4a-9b30-46cc13e69152",
      "title": "Potential Persistence Via PowerShell User Profile Using Add-Content",
      "status": "test",
      "description": "Detects calls to \"Add-Content\" cmdlet in order to modify the content of the user profile and potentially adding suspicious commands for persistence",
      "level": "medium",
      "tags": [
        "attack.persistence",
        "attack.privilege-escalation",
        "attack.t1546.013"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_add": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Add-Content $profile",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_options": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-Value \"IEX ",
                  "-Value \"Invoke-Expression",
                  "-Value \"Invoke-WebRequest",
                  "-Value \"Start-Process",
                  "-Value 'IEX ",
                  "-Value 'Invoke-Expression",
                  "-Value 'Invoke-WebRequest",
                  "-Value 'Start-Process"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1546.013"
        ],
        "tactics": [
          "persistence",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2021-08-18",
        "modified": "2023-05-04",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.013/T1546.013.md"
        ],
        "falsepositives": [
          "Legitimate administration and tuning scripts that aim to add functionality to a user PowerShell session"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_user_profile_tampering.yml"
      }
    },
    {
      "id": "96cd126d-f970-49c4-848a-da3a09f55c55",
      "title": "Potential PowerShell Obfuscation Using Alias Cmdlets",
      "status": "test",
      "description": "Detects Set-Alias or New-Alias cmdlet usage. Which can be use as a mean to obfuscate PowerShell scripts",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.execution",
        "attack.t1027",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Alias ",
                  "New-Alias "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_cim": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Alias -Name ncms -Value New-CimSession -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name gcls -Value Get-CimClass -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name ncso -Value New-CimSessionOption -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name gcms -Value Get-CimSession -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name rcms -Value Remove-cimSession -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name rcie -Value Register-CimIndicationEvent -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name gcai -Value Get-CimAssociatedInstance -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name gcim -Value Get-CimInstance -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name scim -Value Set-CimInstance -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name ncim -Value New-CimInstance -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name rcim -Value Remove-cimInstance -Option ReadOnly, AllScope -ErrorAction SilentlyContinue",
                  "Set-Alias -Name icim -Value Invoke-CimMethod -Option ReadOnly, AllScope -ErrorAction SilentlyContinue"
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2023-01-08",
        "modified": "2025-10-22",
        "references": [
          "https://github.com/1337Rin/Swag-PSO"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_set_alias.yml"
      }
    },
    {
      "id": "b29a93fb-087c-4b5b-a84d-ee3309e69d08",
      "title": "Manipulation of User Computer or Group Security Principals Across AD",
      "status": "test",
      "description": "Adversaries may create a domain account to maintain access to victim systems.\nDomain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain..\n",
      "level": "medium",
      "tags": [
        "attack.persistence",
        "attack.t1136.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "System.DirectoryServices.AccountManagement",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1136.002"
        ],
        "tactics": [
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-28",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1136.002/T1136.002.md#atomic-test-3---create-a-new-domain-account-using-powershell",
          "https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.accountmanagement?view=net-8.0"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_directoryservices_accountmanagement.yml"
      }
    },
    {
      "id": "66a4d409-451b-4151-94f4-a55d559c49b0",
      "title": "PowerShell Deleted Mounted Share",
      "status": "test",
      "description": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Remove-SmbShare",
                  "Remove-FileShare"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_module_load": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "FileShare.cdxml",
                  "Microsoft.PowerShell.Core\\Export-ModuleMember",
                  "ROOT/Microsoft/Windows/Storage/MSFT_FileShare",
                  "ObjectModelWrapper",
                  "Cmdletization.MethodParameter"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1070.005"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "oscd.community, @redcanary, Zach Stanford @svch0st",
        "date": "2020-10-08",
        "modified": "2025-10-07",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.005/T1070.005.md"
        ],
        "falsepositives": [
          "Administrators or Power users may remove their shares via cmd line"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_mounted_share_deletion.yml"
      }
    },
    {
      "id": "bd33d2aa-497e-4651-9893-5c5364646595",
      "title": "Suspicious TCP Tunnel Via PowerShell Script",
      "status": "test",
      "description": "Detects powershell scripts that creates sockets/listeners which could be indicative of tunneling activity",
      "level": "medium",
      "tags": [
        "attack.command-and-control",
        "attack.t1090"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "[System.Net.HttpWebRequest]",
                  "System.Net.Sockets.TcpListener",
                  "AcceptTcpClient"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1090"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-07-08",
        "modified": "",
        "references": [
          "https://github.com/Arno0x/PowerShellScripts/blob/a6b7d5490fbf0b20f91195838f3a11156724b4f7/proxyTunnel.ps1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_proxy_scripts.yml"
      }
    },
    {
      "id": "a5a30a6e-75ca-4233-8b8c-42e0f2037d3b",
      "title": "Invoke-Obfuscation Via Use Rundll32 - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use Rundll32 in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "&&",
                  "rundll32",
                  "shell32.dll",
                  "shellexec_rundll"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "value",
                  "invoke",
                  "comspec",
                  "iex"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2019-10-08",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_rundll32.yml"
      }
    },
    {
      "id": "29e1c216-6408-489d-8a06-ee9d151ef819",
      "title": "Suspicious Mount-DiskImage",
      "status": "test",
      "description": "Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW.",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.t1553.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Mount-DiskImage ",
                  "-ImagePath "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1553.005"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-01",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.005/T1553.005.md#atomic-test-1---mount-iso-image",
          "https://learn.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_mount_diskimage.yml"
      }
    },
    {
      "id": "488b44e7-3781-4a71-888d-c95abfacf44d",
      "title": "Windows Firewall Profile Disabled",
      "status": "test",
      "description": "Detects when a user disables the Windows Firewall via a Profile to help evade defense.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_args": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-NetFirewallProfile ",
                  " -Enabled ",
                  " False"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_opt": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " -All ",
                  "Public",
                  "Domain",
                  "Private"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Austin Songer @austinsonger",
        "date": "2021-10-12",
        "modified": "2022-12-30",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallprofile?view=windowsserver2022-ps",
          "https://www.tutorialspoint.com/how-to-get-windows-firewall-profile-settings-using-powershell",
          "https://web.archive.org/web/20230929023836/http://powershellhelp.space/commands/set-netfirewallrule-psv5.php",
          "http://woshub.com/manage-windows-firewall-powershell/",
          "https://www.elastic.co/guide/en/security/current/windows-firewall-disabled-via-powershell.html"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_windows_firewall_profile_disabled.yml"
      }
    },
    {
      "id": "fbc5e92f-3044-4e73-a5c6-1c4359b539de",
      "title": "PowerShell Script With File Hostname Resolving Capabilities",
      "status": "test",
      "description": "Detects PowerShell scripts that have capabilities to read files, loop through them and resolve DNS host entries.",
      "level": "medium",
      "tags": [
        "attack.exfiltration",
        "attack.t1020"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-content ",
                  "foreach",
                  "[System.Net.Dns]::GetHostEntry",
                  "Out-File"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1020"
        ],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-05-05",
        "modified": "",
        "references": [
          "https://www.fortypoundhead.com/showcontent.asp?artid=24022",
          "https://labs.withsecure.com/publications/fin7-target-veeam-servers"
        ],
        "falsepositives": [
          "The same functionality can be implemented by admin scripts, correlate with name and creator"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_resolve_list_of_ip_from_file.yml"
      }
    },
    {
      "id": "23590215-4702-4a70-8805-8dc9e58314a2",
      "title": "Registry-Free Process Scope COR_PROFILER",
      "status": "test",
      "description": "Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR.\nThe COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR).\nThese profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR.\n(Citation: Microsoft Profiling Mar 2017)\n(Citation: Microsoft COR_PROFILER Feb 2013)\n",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1574.012"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "$env:COR_ENABLE_PROFILING",
                  "$env:COR_PROFILER",
                  "$env:COR_PROFILER_PATH"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1574.012"
        ],
        "tactics": [
          "privilege_escalation",
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-30",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_cor_profiler.yml"
      }
    },
    {
      "id": "c1344fa2-323b-4d2e-9176-84b4d4821c88",
      "title": "Windows Defender Exclusions Added - PowerShell",
      "status": "test",
      "description": "Detects modifications to the Windows Defender configuration settings using PowerShell to add exclusions",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562",
        "attack.execution",
        "attack.t1059"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_args_exc": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  " -ExclusionPath ",
                  " -ExclusionExtension ",
                  " -ExclusionProcess ",
                  " -ExclusionIpAddress "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_args_pref": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Add-MpPreference ",
                  "Set-MpPreference "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562",
          "T1059"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Tim Rauch, Elastic (idea)",
        "date": "2022-09-16",
        "modified": "2022-11-26",
        "references": [
          "https://www.elastic.co/guide/en/security/current/windows-defender-exclusions-added-via-powershell.html"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_win_defender_exclusions_added.yml"
      }
    },
    {
      "id": "9e07f6e7-83aa-45c6-998e-0af26efd0a85",
      "title": "Powershell WMI Persistence",
      "status": "test",
      "description": "Adversaries may establish persistence and elevate privileges by executing malicious content triggered by a Windows Management Instrumentation (WMI) event subscription.",
      "level": "medium",
      "tags": [
        "attack.persistence",
        "attack.privilege-escalation",
        "attack.t1546.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_ioc": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains_all": {
                    "field": "ScriptBlockText",
                    "value": [
                      "New-CimInstance ",
                      "-Namespace root/subscription ",
                      "-ClassName __EventFilter ",
                      "-Property "
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ScriptBlockText__contains_all": {
                    "field": "ScriptBlockText",
                    "value": [
                      "New-CimInstance ",
                      "-Namespace root/subscription ",
                      "-ClassName CommandLineEventConsumer ",
                      "-Property "
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection_ioc",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_ioc"
        }
      },
      "mitre": {
        "techniques": [
          "T1546.003"
        ],
        "tactics": [
          "persistence",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-08-19",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.003/T1546.003.md",
          "https://github.com/EmpireProject/Empire/blob/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/persistence/Persistence.psm1#L545"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_wmi_persistence.yml"
      }
    },
    {
      "id": "16b37b70-6fcf-4814-a092-c36bd3aafcbd",
      "title": "PowerShell ShellCode",
      "status": "test",
      "description": "Detects Base64 encoded Shellcode",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.privilege-escalation",
        "attack.t1055",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "OiCAAAAYInlM",
                  "OiJAAAAYInlM"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1055",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "privilege_escalation",
          "execution"
        ]
      },
      "meta": {
        "author": "David Ledbetter (shellcode), Florian Roth (Nextron Systems)",
        "date": "2018-11-17",
        "modified": "2024-01-25",
        "references": [
          "https://twitter.com/cyb3rops/status/1063072865992523776"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_shellcode_b64.yml"
      }
    },
    {
      "id": "cae80281-ef23-44c5-873b-fd48d2666f49",
      "title": "PowerShell Script Change Permission Via Set-Acl - PsScript",
      "status": "test",
      "description": "Detects PowerShell scripts set ACL to of a file or a folder",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.t1222"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Set-Acl ",
                  "-AclObject ",
                  "-Path "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1222"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-07-18",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/74438b0237d141ee9c99747976447dc884cb1a39/atomics/T1505.005/T1505.005.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_set_acl.yml"
      }
    },
    {
      "id": "35f41cd7-c98e-469f-8a02-ec4ba0cc7a7e",
      "title": "PowerShell Write-EventLog Usage",
      "status": "test",
      "description": "Detects usage of the \"Write-EventLog\" cmdlet with 'RawData' flag. The cmdlet can be levreage to write malicious payloads to the EventLog and then retrieve them later for later use",
      "level": "medium",
      "tags": [
        "attack.defense-evasion"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Write-EventLog",
                  "-RawData "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-08-16",
        "modified": "",
        "references": [
          "https://www.blackhillsinfosec.com/windows-event-logs-for-red-teams/"
        ],
        "falsepositives": [
          "Legitimate applications writing events via this cmdlet. Investigate alerts to determine if the action is benign"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_write_eventlog.yml"
      }
    },
    {
      "id": "61d0475c-173f-4844-86f7-f3eebae1c66b",
      "title": "Change PowerShell Policies to an Insecure Level - PowerShell",
      "status": "test",
      "description": "Detects changing the PowerShell script execution policy to a potentially insecure level using the \"Set-ExecutionPolicy\" cmdlet.",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Set-ExecutionPolicy",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_option": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Unrestricted",
                  "bypass"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_optional_chocolatey": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1')",
                  "(New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1')"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "all of selection_* and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "all_of_and_not_1_of",
          "all_of": "selection_",
          "none_of": "filter_optional_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-10-20",
        "modified": "2023-12-14",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.4",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.4",
          "https://adsecurity.org/?p=2604"
        ],
        "falsepositives": [
          "Administrator script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_set_policies_to_unsecure_level.yml"
      }
    },
    {
      "id": "78aa1347-1517-4454-9982-b338d6df8343",
      "title": "Powershell MsXml COM Object",
      "status": "test",
      "description": "Adversaries may abuse PowerShell commands and scripts for execution.\nPowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell)\nAdversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code\n",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "-ComObject",
                  "MsXml2.",
                  "XmlHttp"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113, MatilJ",
        "date": "2022-01-19",
        "modified": "2022-05-19",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1059.001/T1059.001.md#atomic-test-7---powershell-msxml-com-object---with-prompt",
          "https://learn.microsoft.com/en-us/previous-versions/windows/desktop/ms766431(v=vs.85)",
          "https://www.trendmicro.com/en_id/research/22/e/uncovering-a-kingminer-botnet-attack-using-trend-micro-managed-x.html"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_msxml_com.yml"
      }
    },
    {
      "id": "ae7fbf8e-f3cb-49fd-8db4-5f3bed522c71",
      "title": "Suspicious PowerShell Invocations - Specific",
      "status": "test",
      "description": "Detects suspicious PowerShell invocation command parameters",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_convert_b64": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "-nop",
                  " -w ",
                  "hidden",
                  " -c ",
                  "[Convert]::FromBase64String"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_iex_selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  " -w ",
                  "hidden",
                  "-noni",
                  "-nop",
                  " -c ",
                  "iex",
                  "New-Object"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_enc_selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  " -w ",
                  "hidden",
                  "-ep",
                  "bypass",
                  "-Enc"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_reg_selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "powershell",
                  "reg",
                  "add"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "\\software\\microsoft\\windows\\currentversion\\run",
                  "\\software\\wow6432node\\microsoft\\windows\\currentversion\\run",
                  "\\software\\microsoft\\windows\\currentversion\\policies\\explorer\\run"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_webclient_selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "bypass",
                  "-noprofile",
                  "-windowstyle",
                  "hidden",
                  "new-object",
                  "system.net.webclient",
                  ".download"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_iex_webclient": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "iex",
                  "New-Object",
                  "Net.WebClient",
                  ".Download"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_chocolatey": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1",
                  "(New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1')",
                  "Write-ChocolateyWarning"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "1 of selection_* and not 1 of filter_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "1 of selection_*"
            },
            {
              "type": "not",
              "value": "1 of filter_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems), Jonhnathan Ribeiro",
        "date": "2017-03-05",
        "modified": "2025-02-17",
        "references": [
          "Internal Research",
          "https://github.com/HackTricks-wiki/hacktricks/blob/e4c7b21b8f36c97c35b7c622732b38a189ce18f7/src/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_invocation_specific.yml"
      }
    },
    {
      "id": "63bf8794-9917-45bc-88dd-e1b5abc0ecfd",
      "title": "Powershell Install a DLL in System Directory",
      "status": "test",
      "description": "Uses PowerShell to install/copy a file into a system directory such as \"System32\" or \"SysWOW64\"",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.defense-evasion",
        "attack.credential-access",
        "attack.t1556.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "(Copy-Item|cpi) .{2,128} -Destination .{1,32}\\\\Windows\\\\(System32|SysWOW64)",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1556.002"
        ],
        "tactics": [
          "persistence",
          "defense_evasion",
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2021-12-27",
        "modified": "2024-01-22",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1556.002/T1556.002.md#atomic-test-1---install-and-register-password-filter-dll"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_copy_item_system_directory.yml"
      }
    },
    {
      "id": "a699b30e-d010-46c8-bbd1-ee2e26765fe9",
      "title": "Powershell Store File In Alternate Data Stream",
      "status": "test",
      "description": "Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1564.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_compspec": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Start-Process",
                  "-FilePath \"$env:comspec\" ",
                  "-ArgumentList ",
                  ">"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_compspec",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_compspec"
        }
      },
      "mitre": {
        "techniques": [
          "T1564.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-09-02",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.004/T1564.004.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_store_file_in_alternate_data_stream.yml"
      }
    },
    {
      "id": "4c4af3cd-2115-479c-8193-6b8bfce9001c",
      "title": "PowerShell ICMP Exfiltration",
      "status": "test",
      "description": "Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.",
      "level": "medium",
      "tags": [
        "attack.exfiltration",
        "attack.t1048.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "System.Net.NetworkInformation.Ping",
                  ".Send("
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1048.003"
        ],
        "tactics": [
          "exfiltration"
        ]
      },
      "meta": {
        "author": "Bartlomiej Czyz @bczyz1, oscd.community",
        "date": "2020-10-10",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-2---exfiltration-over-alternative-protocol---icmp"
        ],
        "falsepositives": [
          "Legitimate usage of System.Net.NetworkInformation.Ping class"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_icmp_exfiltration.yml"
      }
    },
    {
      "id": "b7ec41a4-042c-4f31-a5db-d0fcde9fa5c5",
      "title": "PowerShell PSAttack",
      "status": "test",
      "description": "Detects the use of PSAttack PowerShell hack tool",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "PS ATTACK!!!",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Sean Metcalf (source), Florian Roth (Nextron Systems)",
        "date": "2017-03-05",
        "modified": "2022-12-25",
        "references": [
          "https://adsecurity.org/?p=2921"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_psattack.yml"
      }
    },
    {
      "id": "03409c93-a7c7-49ba-9a4c-a00badf2a153",
      "title": "Troubleshooting Pack Cmdlet Execution",
      "status": "test",
      "description": "Detects execution of \"TroubleshootingPack\" cmdlets to leverage CVE-2022-30190 or action similar to \"msdt\" lolbin (as described in LOLBAS)",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1202"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Invoke-TroubleshootingPack",
                  "C:\\Windows\\Diagnostics\\System\\PCW",
                  "-AnswerFile",
                  "-Unattended"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1202"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-06-21",
        "modified": "",
        "references": [
          "https://twitter.com/nas_bench/status/1537919885031772161",
          "https://lolbas-project.github.io/lolbas/Binaries/Msdt/"
        ],
        "falsepositives": [
          "Legitimate usage of \"TroubleshootingPack\" cmdlet for troubleshooting purposes"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_follina_execution.yml"
      }
    },
    {
      "id": "8c521530-5169-495d-a199-0a3a881ad24e",
      "title": "NTFS Alternate Data Stream",
      "status": "test",
      "description": "Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1564.004",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_content": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "set-content",
                  "add-content"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_stream": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "-stream",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1564.004",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Sami Ruohonen",
        "date": "2018-07-24",
        "modified": "2022-12-25",
        "references": [
          "https://web.archive.org/web/20220614030603/http://www.powertheshell.com/ntfsstreams/",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.004/T1564.004.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_ntfs_ads_access.yml"
      }
    },
    {
      "id": "9e620995-f2d8-4630-8430-4afd89f77604",
      "title": "Potential Active Directory Enumeration Using AD Module - PsScript",
      "status": "test",
      "description": "Detects usage of the \"Import-Module\" cmdlet to load the \"Microsoft.ActiveDirectory.Management.dl\" DLL. Which is often used by attackers to perform AD enumeration.",
      "level": "medium",
      "tags": [
        "attack.reconnaissance",
        "attack.discovery",
        "attack.impact"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_generic": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Import-Module ",
                  "Microsoft.ActiveDirectory.Management.dll"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_specific": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "ipmo Microsoft.ActiveDirectory.Management.dll",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "reconnaissance",
          "discovery",
          "impact"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali",
        "date": "2023-01-22",
        "modified": "",
        "references": [
          "https://github.com/samratashok/ADModule",
          "https://twitter.com/cyb3rops/status/1617108657166061568?s=20",
          "https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/active-directory-enumeration-with-ad-module-without-rsat-or-admin-privileges"
        ],
        "falsepositives": [
          "Legitimate use of the library for administrative activity"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_active_directory_module_dll_import.yml"
      }
    },
    {
      "id": "aa7a3fce-bef5-4311-9cc1-5f04bb8c308c",
      "title": "Certificate Exported Via PowerShell - ScriptBlock",
      "status": "test",
      "description": "Detects calls to cmdlets inside of PowerShell scripts that are used to export certificates from the local certificate store. Threat actors were seen abusing this to steal private keys from compromised machines.",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1552.004"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Export-PfxCertificate",
                  "Export-Certificate"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_optional_module_export": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "CmdletsToExport = @(",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_optional_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1552.004"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2021-04-23",
        "modified": "2023-05-18",
        "references": [
          "https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a",
          "https://learn.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate?view=windowsserver2022-ps",
          "https://www.splunk.com/en_us/blog/security/breaking-the-chain-defending-against-certificate-services-abuse.html"
        ],
        "falsepositives": [
          "Legitimate certificate exports by administrators. Additional filters might be required."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_export_certificate.yml"
      }
    },
    {
      "id": "7d416556-6502-45b2-9bad-9d2f05f38997",
      "title": "Powershell Sensitive File Discovery",
      "status": "test",
      "description": "Detect adversaries enumerate sensitive files",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.t1083"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_action": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "ls",
                  "get-childitem",
                  "gci"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_recurse": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "-recurse",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_file": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".pass",
                  ".kdbx",
                  ".kdb"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1083"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-09-16",
        "modified": "",
        "references": [
          "https://twitter.com/malmoeb/status/1570814999370801158"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_sensitive_file_discovery.yml"
      }
    },
    {
      "id": "d93129cd-1ee0-479f-bc03-ca6f129882e3",
      "title": "Powershell Detect Virtualization Environment",
      "status": "test",
      "description": "Adversaries may employ various system checks to detect and avoid virtualization and analysis environments.\nThis may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox\n",
      "level": "medium",
      "tags": [
        "attack.discovery",
        "attack.defense-evasion",
        "attack.t1497.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_action": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-WmiObject",
                  "gwmi"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_module": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "MSAcpi_ThermalZoneTemperature",
                  "Win32_ComputerSystem"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1497.001"
        ],
        "tactics": [
          "discovery",
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Duc.Le-GTSC",
        "date": "2021-08-03",
        "modified": "2022-03-03",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1497.001/T1497.001.md",
          "https://techgenix.com/malicious-powershell-scripts-evade-detection/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_detect_vm_env.yml"
      }
    },
    {
      "id": "88f0884b-331d-403d-a3a1-b668cf035603",
      "title": "AD Groups Or Users Enumeration Using PowerShell - ScriptBlock",
      "status": "test",
      "description": "Adversaries may attempt to find domain-level groups and permission settings.\nThe knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as domain administrators.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "test_2": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "get-ADPrincipalGroupMembership",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "test_7": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "get-aduser",
                  "-f ",
                  "-pr ",
                  "DoesNotRequirePreAuth"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of test_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "test_"
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-15",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_ad_group_reco.yml"
      }
    },
    {
      "id": "1883444f-084b-419b-ac62-e0d0c5b3693f",
      "title": "Suspicious Connection to Remote Account",
      "status": "test",
      "description": "Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts.\nWithout knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism\n",
      "level": "low",
      "tags": [
        "attack.credential-access",
        "attack.t1110.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "System.DirectoryServices.Protocols.LdapDirectoryIdentifier",
                  "System.Net.NetworkCredential",
                  "System.DirectoryServices.Protocols.LdapConnection"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1110.001"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-27",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1110.001/T1110.001.md#atomic-test-2---brute-force-credentials-of-single-active-directory-domain-user-via-ldap-against-domain-controller-ntlm-or-kerberos"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_networkcredential.yml"
      }
    },
    {
      "id": "e6cb92b4-b470-4eb8-8a9d-d63e8583aae0",
      "title": "Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated Powershell via RUNDLL LAUNCHER",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "rundll32.exe",
                  "shell32.dll",
                  "shellexec_rundll",
                  "powershell"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-18",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_rundll.yml"
      }
    },
    {
      "id": "5947497f-1aa4-41dd-9693-c9848d58727d",
      "title": "Suspicious Unblock-File",
      "status": "test",
      "description": "Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1553.005"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Unblock-File ",
                  "-Path "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1553.005"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-01",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.005/T1553.005.md#atomic-test-3---remove-the-zoneidentifier-alternate-data-stream",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file?view=powershell-7.2"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_unblock_file.yml"
      }
    },
    {
      "id": "243de76f-4725-4f2e-8225-a8a69b15ad61",
      "title": "PowerShell Create Local User",
      "status": "test",
      "description": "Detects creation of a local user via PowerShell",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001",
        "attack.persistence",
        "attack.t1136.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "New-LocalUser",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001",
          "T1136.001"
        ],
        "tactics": [
          "execution",
          "persistence"
        ]
      },
      "meta": {
        "author": "@ROxPinTeddy",
        "date": "2020-04-11",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1136.001/T1136.001.md"
        ],
        "falsepositives": [
          "Legitimate user creation"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_create_local_user.yml"
      }
    },
    {
      "id": "b5522a23-82da-44e5-9c8b-e10ed8955f88",
      "title": "Powershell Execute Batch Script",
      "status": "test",
      "description": "Adversaries may abuse the Windows command shell for execution.\nThe Windows command shell ([cmd](https://attack.mitre.org/software/S0106)) is the primary command prompt on Windows systems.\nThe Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands.\nBatch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops.\nCommon uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple system\n",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_start": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Start-Process",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_batch": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  ".cmd",
                  ".bat"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.003"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-02",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1059.003/T1059.003.md#atomic-test-1---create-and-execute-batch-script"
        ],
        "falsepositives": [
          "Legitimate administration script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_execute_batch_script.yml"
      }
    },
    {
      "id": "ddcd88cb-7f62-4ce5-86f9-1704190feb0a",
      "title": "Potential In-Memory Execution Using Reflection.Assembly",
      "status": "test",
      "description": "Detects usage of \"Reflection.Assembly\" load functions to dynamically load assemblies in memory",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1620"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "[Reflection.Assembly]::load",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1620"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-12-25",
        "modified": "",
        "references": [
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=50"
        ],
        "falsepositives": [
          "Legitimate use of the library"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_dotnet_assembly_from_file.yml"
      }
    },
    {
      "id": "7b836d7f-179c-4ba4-90a7-a7e60afb48e6",
      "title": "Execute Invoke-command on Remote Host",
      "status": "test",
      "description": "Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user.",
      "level": "medium",
      "tags": [
        "attack.lateral-movement",
        "attack.t1021.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "invoke-command ",
                  " -ComputerName "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_cmdlet",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_cmdlet"
        }
      },
      "mitre": {
        "techniques": [
          "T1021.006"
        ],
        "tactics": [
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-01-07",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.006/T1021.006.md#atomic-test-2---invoke-command",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.4"
        ],
        "falsepositives": [
          "Legitimate script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_command_remote.yml"
      }
    },
    {
      "id": "0adfbc14-0ed1-11eb-adc1-0242ac120002",
      "title": "Invoke-Obfuscation VAR+ Launcher - PowerShell",
      "status": "test",
      "description": "Detects Obfuscated use of Environment Variables to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4104": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__re": {
                "field": "ScriptBlockText",
                "value": "cmd.{0,5}(?:/c|/r)(?:\\s|)\"set\\s[a-zA-Z]{3,6}.*(?:\\{\\d\\}){1,}\\\\\"\\s+?-f(?:.*\\)){1,}.*\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4104",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4104"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-15",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_var.yml"
      }
    },
    {
      "id": "df69cb1d-b891-4cd9-90c7-d617d90100ce",
      "title": "Suspicious FromBase64String Usage On Gzip Archive - Ps Script",
      "status": "test",
      "description": "Detects attempts of decoding a base64 Gzip archive in a PowerShell script. This technique is often used as a method to load malicious content into memory afterward.",
      "level": "medium",
      "tags": [
        "attack.command-and-control",
        "attack.t1132.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "FromBase64String",
                  "MemoryStream",
                  "H4sI"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1132.001"
        ],
        "tactics": [
          "command_and_control"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-12-23",
        "modified": "",
        "references": [
          "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=43"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_frombase64string_archive.yml"
      }
    },
    {
      "id": "060c3ef1-fd0a-4091-bf46-e7d625f60b73",
      "title": "Suspicious Get-ADReplAccount",
      "status": "test",
      "description": "The DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory.\nThese include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1003.006"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-ADReplAccount",
                  "-All ",
                  "-Server "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003.006"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-06",
        "modified": "",
        "references": [
          "https://www.powershellgallery.com/packages/DSInternals",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.006/T1003.006.md#atomic-test-2---run-dsinternals-get-adreplaccount"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_adreplaccount.yml"
      }
    },
    {
      "id": "b26647de-4feb-4283-af6b-6117661283c5",
      "title": "Powershell Suspicious Win32_PnPEntity",
      "status": "test",
      "description": "Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1120"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Win32_PnPEntity",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1120"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-08-23",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1120/T1120.md"
        ],
        "falsepositives": [
          "Admin script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_win32_pnpentity.yml"
      }
    },
    {
      "id": "e0d6c087-2d1c-47fd-8799-3904103c5a98",
      "title": "AMSI Bypass Pattern Assembly GetType",
      "status": "test",
      "description": "Detects code fragments found in small and obfuscated AMSI bypass PowerShell scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001",
        "attack.execution"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "[Ref].Assembly.GetType",
                  "SetValue($null,$true)",
                  "NonPublic,Static"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2022-11-09",
        "modified": "",
        "references": [
          "https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/",
          "https://twitter.com/cyb3rops/status/1588574518057979905?s=20&t=A7hh93ONM7ni1Rj1jO5OaA"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_amsi_bypass_pattern_nov22.yml"
      }
    },
    {
      "id": "09658312-bc27-4a3b-91c5-e49ab9046d1b",
      "title": "WMIC Unquoted Services Path Lookup - PowerShell",
      "status": "test",
      "description": "Detects known WMI recon method to look for unquoted service paths, often used by pentest inside of powershell scripts attackers enum scripts",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1047"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-WmiObject ",
                  "gwmi "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  " Win32_Service ",
                  "Name",
                  "DisplayName",
                  "PathName",
                  "StartMode"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1047"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-06-20",
        "modified": "2022-11-25",
        "references": [
          "https://github.com/nccgroup/redsnarf/blob/35949b30106ae543dc6f2bc3f1be10c6d9a8d40e/redsnarf.py",
          "https://github.com/S3cur3Th1sSh1t/Creds/blob/eac23d67f7f90c7fc8e3130587d86158c22aa398/PowershellScripts/jaws-enum.ps1",
          "https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_wmi_unquoted_service_search.yml"
      }
    },
    {
      "id": "36bed6b2-e9a0-4fff-beeb-413a92b86138",
      "title": "Active Directory Computers Enumeration With Get-AdComputer",
      "status": "test",
      "description": "Detects usage of the \"Get-AdComputer\" to enumerate Computers or properties within Active Directory.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1018",
        "attack.t1087.002"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Get-AdComputer ",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_option": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "-Filter ",
                  "-LDAPFilter ",
                  "-Properties "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1018",
          "T1087.002"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-03-17",
        "modified": "2023-07-08",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/activedirectory/get-adcomputer",
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1018/T1018.md",
          "https://github.com/redcanaryco/atomic-red-team/blob/02cb591f75064ffe1e0df9ac3ed5972a2e491c97/atomics/T1087.002/T1087.002.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_adcomputer.yml"
      }
    },
    {
      "id": "f62176f3-8128-4faa-bf6c-83261322e5eb",
      "title": "Malicious PowerShell Keywords",
      "status": "test",
      "description": "Detects keywords from well-known PowerShell exploitation frameworks",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "AdjustTokenPrivileges",
                  "IMAGE_NT_OPTIONAL_HDR64_MAGIC",
                  "Metasploit",
                  "Microsoft.Win32.UnsafeNativeMethods",
                  "Mimikatz",
                  "MiniDumpWriteDump",
                  "PAGE_EXECUTE_READ",
                  "ReadProcessMemory.Invoke",
                  "SE_PRIVILEGE_ENABLED",
                  "SECURITY_DELEGATION",
                  "TOKEN_ADJUST_PRIVILEGES",
                  "TOKEN_ALL_ACCESS",
                  "TOKEN_ASSIGN_PRIMARY",
                  "TOKEN_DUPLICATE",
                  "TOKEN_ELEVATION",
                  "TOKEN_IMPERSONATE",
                  "TOKEN_INFORMATION_CLASS",
                  "TOKEN_PRIVILEGES",
                  "TOKEN_QUERY"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Sean Metcalf (source), Florian Roth (Nextron Systems)",
        "date": "2017-03-05",
        "modified": "2023-06-20",
        "references": [
          "https://adsecurity.org/?p=2921"
        ],
        "falsepositives": [
          "Depending on the scripts, this rule might require some initial tuning to fit the environment"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_malicious_keywords.yml"
      }
    },
    {
      "id": "1139d2e2-84b1-4226-b445-354492eba8ba",
      "title": "Usage Of Web Request Commands And Cmdlets - ScriptBlock",
      "status": "test",
      "description": "Detects the use of various web request commands with commandline tools and Windows PowerShell cmdlets (including aliases) via PowerShell scriptblock logs",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "[System.Net.WebRequest]::create",
                  "curl ",
                  "Invoke-RestMethod",
                  "Invoke-WebRequest",
                  " irm ",
                  "iwr ",
                  "Resume-BitsTransfer",
                  "Start-BitsTransfer",
                  "wget ",
                  "WinHttp.WinHttpRequest"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter": {
            "type": "field_match",
            "matchers": {
              "Path__startswith": {
                "field": "Path",
                "value": "C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\",
                "modifiers": [
                  "startswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not filter",
        "condition_parsed": {
          "op": "and_not",
          "include": "selection",
          "exclude": "filter"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "James Pemberton / @4A616D6573",
        "date": "2019-10-24",
        "modified": "2025-10-20",
        "references": [
          "https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/",
          "https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell"
        ],
        "falsepositives": [
          "Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_web_request_cmd_and_cmdlets.yml"
      }
    },
    {
      "id": "99c49d9c-34ea-45f7-84a7-4751ae6b2cbc",
      "title": "Dump Credentials from Windows Credential Manager With PowerShell",
      "status": "test",
      "description": "Adversaries may search for common password storage locations to obtain user credentials.\nPasswords are stored in several places on a system, depending on the operating system or application holding the credentials.\n",
      "level": "medium",
      "tags": [
        "attack.credential-access",
        "attack.t1555"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_kiddie": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Get-PasswordVaultCredentials",
                  "Get-CredManCreds"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_rename_Password": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "Windows.Security.Credentials.PasswordVault"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_rename_credman": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "New-Object",
                  "Microsoft.CSharp.CSharpCodeProvider",
                  "[System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())",
                  "Collections.ArrayList",
                  "System.CodeDom.Compiler.CompilerParameters"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1555"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-20",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1555/T1555.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_dump_password_windows_credential_manager.yml"
      }
    },
    {
      "id": "95afc12e-3cbb-40c3-9340-84a032e596a3",
      "title": "Service Registry Permissions Weakness Check",
      "status": "test",
      "description": "Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services.\nAdversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start.\nWindows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services\n",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1574.011",
        "stp.2a"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "get-acl",
                  "REGISTRY::HKLM\\SYSTEM\\CurrentControlSet\\Services\\"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1574.011"
        ],
        "tactics": [
          "privilege_escalation",
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-30",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1574.011/T1574.011.md#atomic-test-1---service-registry-permissions-weakness",
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-acl?view=powershell-7.4"
        ],
        "falsepositives": [
          "Legitimate administrative script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_get_acl_service.yml"
      }
    },
    {
      "id": "2f77047c-e6e9-4c11-b088-a3de399524cd",
      "title": "Potential Persistence Via Security Descriptors - ScriptBlock",
      "status": "test",
      "description": "Detects usage of certain functions and keywords that are used to manipulate security descriptors in order to potentially set a backdoor. As seen used in the DAMP project.",
      "level": "high",
      "tags": [
        "attack.persistence",
        "attack.defense-evasion",
        "attack.privilege-escalation"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains_all": {
                "field": "ScriptBlockText",
                "value": [
                  "win32_Trustee",
                  "win32_Ace",
                  ".AccessMask",
                  ".AceType",
                  ".SetSecurityDescriptor"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "\\Lsa\\JD",
                  "\\Lsa\\Skew1",
                  "\\Lsa\\Data",
                  "\\Lsa\\GBG"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "persistence",
          "defense_evasion",
          "privilege_escalation"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-05",
        "modified": "",
        "references": [
          "https://github.com/HarmJ0y/DAMP"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_susp_ace_tampering.yml"
      }
    },
    {
      "id": "bde47d4b-9987-405c-94c7-b080410e8ea7",
      "title": "Clearing Windows Console History",
      "status": "test",
      "description": "Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070",
        "attack.t1070.003"
      ],
      "logsource": {
        "category": "ps_script",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection1": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": "Clear-History",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection2a": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "Remove-Item",
                  "rm"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection2b": {
            "type": "field_match",
            "matchers": {
              "ScriptBlockText__contains": {
                "field": "ScriptBlockText",
                "value": [
                  "ConsoleHost_history.txt",
                  "(Get-PSReadlineOption).HistorySavePath"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection1 or selection2a and selection2b",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "selection1",
            "selection2a and selection2b"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1070",
          "T1070.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Austin Songer @austinsonger",
        "date": "2021-11-25",
        "modified": "2022-12-25",
        "references": [
          "https://stefanos.cloud/blog/kb/how-to-clear-the-powershell-command-history/",
          "https://www.shellhacks.com/clear-history-powershell/",
          "https://community.sophos.com/sophos-labs/b/blog/posts/powershell-command-history-forensics"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_script/posh_ps_clearing_windows_console_history.yml"
      }
    }
  ]
}