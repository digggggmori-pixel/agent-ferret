{
  "metadata": {
    "logsource": "windows_ps_classic_provider_start",
    "rule_count": 1,
    "compiled_at": "2026-02-04T12:28:36.517407",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "ec19ebab-72dc-40e1-9728-4c0b805d722c",
      "title": "Tamper Windows Defender - PSClassic",
      "status": "test",
      "description": "Attempting to disable scheduled scanning and other parts of Windows Defender ATP or set default actions to allow.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.001"
      ],
      "logsource": {
        "category": "ps_classic_provider_start",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_set_mppreference": {
            "type": "field_match",
            "matchers": {
              "Data__contains": {
                "field": "Data",
                "value": "Set-MpPreference",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_options_bool_allow": {
            "type": "field_match",
            "matchers": {
              "Data__contains": {
                "field": "Data",
                "value": [
                  "-dbaf $true",
                  "-dbaf 1",
                  "-dbm $true",
                  "-dbm 1",
                  "-dips $true",
                  "-dips 1",
                  "-DisableArchiveScanning $true",
                  "-DisableArchiveScanning 1",
                  "-DisableBehaviorMonitoring $true",
                  "-DisableBehaviorMonitoring 1",
                  "-DisableBlockAtFirstSeen $true",
                  "-DisableBlockAtFirstSeen 1",
                  "-DisableCatchupFullScan $true",
                  "-DisableCatchupFullScan 1",
                  "-DisableCatchupQuickScan $true",
                  "-DisableCatchupQuickScan 1",
                  "-DisableIntrusionPreventionSystem $true",
                  "-DisableIntrusionPreventionSystem 1",
                  "-DisableIOAVProtection $true",
                  "-DisableIOAVProtection 1",
                  "-DisableRealtimeMonitoring $true",
                  "-DisableRealtimeMonitoring 1",
                  "-DisableRemovableDriveScanning $true",
                  "-DisableRemovableDriveScanning 1",
                  "-DisableScanningMappedNetworkDrivesForFullScan $true",
                  "-DisableScanningMappedNetworkDrivesForFullScan 1",
                  "-DisableScanningNetworkFiles $true",
                  "-DisableScanningNetworkFiles 1",
                  "-DisableScriptScanning $true",
                  "-DisableScriptScanning 1",
                  "-MAPSReporting $false",
                  "-MAPSReporting 0",
                  "-drdsc $true",
                  "-drdsc 1",
                  "-drtm $true",
                  "-drtm 1",
                  "-dscrptsc $true",
                  "-dscrptsc 1",
                  "-dsmndf $true",
                  "-dsmndf 1",
                  "-dsnf $true",
                  "-dsnf 1",
                  "-dss $true",
                  "-dss 1"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_options_actions_func": {
            "type": "field_match",
            "matchers": {
              "Data__contains": {
                "field": "Data",
                "value": [
                  "HighThreatDefaultAction Allow",
                  "htdefac Allow",
                  "LowThreatDefaultAction Allow",
                  "ltdefac Allow",
                  "ModerateThreatDefaultAction Allow",
                  "mtdefac Allow",
                  "SevereThreatDefaultAction Allow",
                  "stdefac Allow"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_set_mppreference and 1 of selection_options_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection_set_mppreference"
            },
            {
              "type": "ref",
              "value": "1 of selection_options_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.001"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2021-06-07",
        "modified": "2024-01-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.001/T1562.001.md"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts that disable Windows Defender for troubleshooting purposes. Must be investigated."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_classic/posh_pc_tamper_windows_defender_set_mp.yml"
      }
    }
  ]
}