{
  "metadata": {
    "logsource": "windows_ps_module",
    "rule_count": 33,
    "compiled_at": "2026-02-04T12:28:36.518838",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "6bfb8fa7-b2e7-4f6c-8d9d-824e5d06ea9e",
      "title": "Invoke-Obfuscation VAR+ Launcher - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated use of Environment Variables to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "cmd.{0,5}(?:/c|/r)(?:\\s|)\"set\\s[a-zA-Z]{3,6}.*(?:\\{\\d\\}){1,}\\\\\"\\s+?-f(?:.*\\)){1,}.*\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-15",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_var.yml"
      }
    },
    {
      "id": "2f211361-7dce-442d-b78a-c04039677378",
      "title": "Invoke-Obfuscation Obfuscated IEX Invocation - PowerShell Module",
      "status": "test",
      "description": "Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the code block cited in the reference section below",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_payload": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\$PSHome\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$PSHome\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\$ShellId\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$ShellId\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\$env:Public\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$env:Public\\[",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\$env:ComSpec\\[(\\s*\\d{1,3}\\s*,){2}",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\*mdr\\*\\W\\s*\\)\\.Name",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\$VerbosePreference\\.ToString\\(",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "Payload__re": {
                    "field": "Payload",
                    "value": "\\[String\\]\\s*\\$VerbosePreference",
                    "modifiers": [
                      "re"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection_payload",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_payload"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Daniel Bohannon (@Mandiant/@FireEye), oscd.community",
        "date": "2019-11-08",
        "modified": "2022-12-31",
        "references": [
          "https://github.com/danielbohannon/Invoke-Obfuscation/blob/f20e7f843edd0a3a7716736e9eddfa423395dd26/Out-ObfuscatedStringCommand.ps1#L873-L888"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_obfuscated_iex.yml"
      }
    },
    {
      "id": "e3818659-5016-4811-a73c-dde4679169d2",
      "title": "Suspicious Computer Machine Password by PowerShell",
      "status": "test",
      "description": "The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain.\nYou can use it to reset the password of the local computer.\n",
      "level": "medium",
      "tags": [
        "attack.privilege-escalation",
        "attack.persistence",
        "attack.defense-evasion",
        "attack.initial-access",
        "attack.t1078"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "Reset-ComputerMachinePassword",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1078"
        ],
        "tactics": [
          "privilege_escalation",
          "persistence",
          "defense_evasion",
          "initial_access"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-21",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/reset-computermachinepassword?view=powershell-5.1",
          "https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/"
        ],
        "falsepositives": [
          "Administrator PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_reset_computermachinepassword.yml"
      }
    },
    {
      "id": "de41232e-12e8-49fa-86bc-c05c7e722df9",
      "title": "Suspicious PowerShell Download - PoshModule",
      "status": "test",
      "description": "Detects suspicious PowerShell download command",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_webclient_": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "System.Net.WebClient",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_function": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  ".DownloadFile(",
                  ".DownloadString("
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2017-03-05",
        "modified": "2023-01-20",
        "references": [
          "https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadfile?view=net-8.0",
          "https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadstring?view=net-8.0"
        ],
        "falsepositives": [
          "PowerShell scripts that download content from the Internet"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_download.yml"
      }
    },
    {
      "id": "7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c",
      "title": "Malicious PowerShell Commandlets - PoshModule",
      "status": "test",
      "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.discovery",
        "attack.t1482",
        "attack.t1087",
        "attack.t1087.001",
        "attack.t1087.002",
        "attack.t1069.001",
        "attack.t1069.002",
        "attack.t1069",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "Add-Exfiltration",
                  "Add-Persistence",
                  "Add-RegBackdoor",
                  "Add-RemoteRegBackdoor",
                  "Add-ScrnSaveBackdoor",
                  "BadSuccessor",
                  "Check-VM",
                  "ConvertTo-Rc4ByteStream",
                  "Decrypt-Hash",
                  "Disable-ADIDNSNode",
                  "Disable-MachineAccount",
                  "Do-Exfiltration",
                  "Enable-ADIDNSNode",
                  "Enable-MachineAccount",
                  "Enabled-DuplicateToken",
                  "Exploit-Jboss",
                  "Export-ADR",
                  "Export-ADRCSV",
                  "Export-ADRExcel",
                  "Export-ADRHTML",
                  "Export-ADRJSON",
                  "Export-ADRXML",
                  "Find-Fruit",
                  "Find-GPOLocation",
                  "Find-TrustedDocuments",
                  "Get-ADIDNS",
                  "Get-ApplicationHost",
                  "Get-ChromeDump",
                  "Get-ClipboardContents",
                  "Get-FoxDump",
                  "Get-GPPPassword",
                  "Get-IndexedItem",
                  "Get-KerberosAESKey",
                  "Get-Keystrokes",
                  "Get-LSASecret",
                  "Get-MachineAccountAttribute",
                  "Get-MachineAccountCreator",
                  "Get-PassHashes",
                  "Get-RegAlwaysInstallElevated",
                  "Get-RegAutoLogon",
                  "Get-RemoteBootKey",
                  "Get-RemoteCachedCredential",
                  "Get-RemoteLocalAccountHash",
                  "Get-RemoteLSAKey",
                  "Get-RemoteMachineAccountHash",
                  "Get-RemoteNLKMKey",
                  "Get-RickAstley",
                  "Get-Screenshot",
                  "Get-SecurityPackages",
                  "Get-ServiceFilePermission",
                  "Get-ServicePermission",
                  "Get-ServiceUnquoted",
                  "Get-SiteListPassword",
                  "Get-System",
                  "Get-TimedScreenshot",
                  "Get-UnattendedInstallFile",
                  "Get-Unconstrained",
                  "Get-USBKeystrokes",
                  "Get-VaultCredential",
                  "Get-VulnAutoRun",
                  "Get-VulnSchTask",
                  "Grant-ADIDNSPermission",
                  "Gupt-Backdoor",
                  "HTTP-Login",
                  "Install-ServiceBinary",
                  "Install-SSP",
                  "Invoke-ACLScanner",
                  "Invoke-ADRecon",
                  "Invoke-ADSBackdoor",
                  "Invoke-AgentSmith",
                  "Invoke-AllChecks",
                  "Invoke-ARPScan",
                  "Invoke-AzureHound",
                  "Invoke-BackdoorLNK",
                  "Invoke-BadPotato",
                  "Invoke-BetterSafetyKatz",
                  "Invoke-BypassUAC",
                  "Invoke-Carbuncle",
                  "Invoke-Certify",
                  "Invoke-ConPtyShell",
                  "Invoke-CredentialInjection",
                  "Invoke-DAFT",
                  "Invoke-DCSync",
                  "Invoke-DinvokeKatz",
                  "Invoke-DllInjection",
                  "Invoke-DNSUpdate",
                  "Invoke-DNSExfiltrator",
                  "Invoke-DomainPasswordSpray",
                  "Invoke-DowngradeAccount",
                  "Invoke-EgressCheck",
                  "Invoke-Eyewitness",
                  "Invoke-FakeLogonScreen",
                  "Invoke-Farmer",
                  "Invoke-Get-RBCD-Threaded",
                  "Invoke-Gopher",
                  "Invoke-Grouper",
                  "Invoke-HandleKatz",
                  "Invoke-ImpersonatedProcess",
                  "Invoke-ImpersonateSystem",
                  "Invoke-InteractiveSystemPowerShell",
                  "Invoke-Internalmonologue",
                  "Invoke-Inveigh",
                  "Invoke-InveighRelay",
                  "Invoke-KrbRelay",
                  "Invoke-LdapSignCheck",
                  "Invoke-Lockless",
                  "Invoke-MalSCCM",
                  "Invoke-Mimikatz",
                  "Invoke-Mimikittenz",
                  "Invoke-MITM6",
                  "Invoke-NanoDump",
                  "Invoke-NetRipper",
                  "Invoke-Nightmare",
                  "Invoke-NinjaCopy",
                  "Invoke-OfficeScrape",
                  "Invoke-OxidResolver",
                  "Invoke-P0wnedshell",
                  "Invoke-Paranoia",
                  "Invoke-PortScan",
                  "Invoke-PoshRatHttp",
                  "Invoke-PostExfil",
                  "Invoke-PowerDump",
                  "Invoke-PowerDPAPI",
                  "Invoke-PowerShellTCP",
                  "Invoke-PowerShellWMI",
                  "Invoke-PPLDump",
                  "Invoke-PsExec",
                  "Invoke-PSInject",
                  "Invoke-PsUaCme",
                  "Invoke-ReflectivePEInjection",
                  "Invoke-ReverseDNSLookup",
                  "Invoke-Rubeus",
                  "Invoke-RunAs",
                  "Invoke-SafetyKatz",
                  "Invoke-SauronEye",
                  "Invoke-SCShell",
                  "Invoke-Seatbelt",
                  "Invoke-ServiceAbuse",
                  "Invoke-ShadowSpray",
                  "Invoke-Sharp",
                  "Invoke-Shellcode",
                  "Invoke-SMBScanner",
                  "Invoke-Snaffler",
                  "Invoke-Spoolsample",
                  "Invoke-SpraySinglePassword",
                  "Invoke-SSHCommand",
                  "Invoke-StandIn",
                  "Invoke-StickyNotesExtract",
                  "Invoke-SystemCommand",
                  "Invoke-Tasksbackdoor",
                  "Invoke-Tater",
                  "Invoke-Thunderfox",
                  "Invoke-ThunderStruck",
                  "Invoke-TokenManipulation",
                  "Invoke-Tokenvator",
                  "Invoke-TotalExec",
                  "Invoke-UrbanBishop",
                  "Invoke-UserHunter",
                  "Invoke-VoiceTroll",
                  "Invoke-Whisker",
                  "Invoke-WinEnum",
                  "Invoke-winPEAS",
                  "Invoke-WireTap",
                  "Invoke-WmiCommand",
                  "Invoke-WMIExec",
                  "Invoke-WScriptBypassUAC",
                  "Invoke-Zerologon",
                  "MailRaider",
                  "New-ADIDNSNode",
                  "New-DNSRecordArray",
                  "New-HoneyHash",
                  "New-InMemoryModule",
                  "New-MachineAccount",
                  "New-SOASerialNumberArray",
                  "Out-Minidump",
                  "Port-Scan",
                  "PowerBreach",
                  "powercat ",
                  "PowerUp",
                  "PowerView",
                  "Remove-ADIDNSNode",
                  "Remove-MachineAccount",
                  "Remove-Update",
                  "Rename-ADIDNSNode",
                  "Revoke-ADIDNSPermission",
                  "Set-ADIDNSNode",
                  "Set-MacAttribute",
                  "Set-MachineAccountAttribute",
                  "Set-Wallpaper",
                  "Show-TargetScreen",
                  "Start-CaptureServer",
                  "Start-Dnscat2",
                  "Start-WebcamRecorder",
                  "Veeam-Get-Creds",
                  "VolumeShadowCopyTools"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1482",
          "T1087",
          "T1087.001",
          "T1087.002",
          "T1069.001",
          "T1069.002",
          "T1069",
          "T1059.001"
        ],
        "tactics": [
          "execution",
          "discovery"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-20",
        "modified": "2025-12-10",
        "references": [
          "https://adsecurity.org/?p=2921",
          "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
          "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
          "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
          "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
          "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
          "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
          "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
          "https://github.com/calebstewart/CVE-2021-1675",
          "https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1",
          "https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html",
          "https://github.com/HarmJ0y/DAMP",
          "https://github.com/samratashok/nishang",
          "https://github.com/DarkCoderSc/PowerRunAsSystem/",
          "https://github.com/besimorhino/powercat",
          "https://github.com/Kevin-Robertson/Powermad",
          "https://github.com/adrecon/ADRecon",
          "https://github.com/adrecon/AzureADRecon",
          "https://github.com/sadshade/veeam-creds/blob/6010eaf31ba41011b58d6af3950cffbf6f5cea32/Veeam-Get-Creds.ps1",
          "https://github.com/The-Viper-One/Invoke-PowerDPAPI/",
          "https://github.com/Arno0x/DNSExfiltrator/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_malicious_commandlets.yml"
      }
    },
    {
      "id": "8ff28fdd-e2fa-4dfa-aeda-ef3d61c62090",
      "title": "Suspicious PowerShell Invocations - Specific - PowerShell Module",
      "status": "test",
      "description": "Detects suspicious PowerShell invocation command parameters",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_convert_b64": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "-nop",
                  " -w ",
                  "hidden",
                  " -c ",
                  "[Convert]::FromBase64String"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_iex": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  " -w ",
                  "hidden",
                  "-noni",
                  "-nop",
                  " -c ",
                  "iex",
                  "New-Object"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_enc": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  " -w ",
                  "hidden",
                  "-ep",
                  "bypass",
                  "-Enc"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_reg": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "powershell",
                  "reg",
                  "add"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  "\\software\\microsoft\\windows\\currentversion\\run",
                  "\\software\\wow6432node\\microsoft\\windows\\currentversion\\run",
                  "\\software\\microsoft\\windows\\currentversion\\policies\\explorer\\run"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_webclient": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "bypass",
                  "-noprofile",
                  "-windowstyle",
                  "hidden",
                  "new-object",
                  "system.net.webclient",
                  ".download"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_iex_webclient": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "iex",
                  "New-Object",
                  "Net.WebClient",
                  ".Download"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_chocolatey": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  "(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1",
                  "Write-ChocolateyWarning"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "1 of selection_* and not 1 of filter_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "1 of selection_*"
            },
            {
              "type": "not",
              "value": "1 of filter_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems), Jonhnathan Ribeiro",
        "date": "2017-03-05",
        "modified": "2025-02-17",
        "references": [
          "Internal Research",
          "https://github.com/HackTricks-wiki/hacktricks/blob/e4c7b21b8f36c97c35b7c622732b38a189ce18f7/src/windows-hardening/windows-local-privilege-escalation/privilege-escalation-with-autorun-binaries.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_invocation_specific.yml"
      }
    },
    {
      "id": "aff815cc-e400-4bf0-a47a-5d8a2407d4e1",
      "title": "Use Get-NetTCPConnection - PowerShell Module",
      "status": "test",
      "description": "Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1049"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "Get-NetTCPConnection",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1049"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-10",
        "modified": "2022-12-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1049/T1049.md#atomic-test-2---system-network-connections-discovery-with-powershell"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_get_nettcpconnection.yml"
      }
    },
    {
      "id": "1ddc1472-8e52-4f7d-9f11-eab14fc171f5",
      "title": "PowerShell Decompress Commands",
      "status": "test",
      "description": "A General detection for specific decompress commands in PowerShell logs. This could be an adversary decompressing files.",
      "level": "informational",
      "tags": [
        "attack.defense-evasion",
        "attack.t1140"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": "Expand-Archive",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1140"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
        "date": "2020-05-02",
        "modified": "2022-12-25",
        "references": [
          "https://github.com/OTRF/detection-hackathon-apt29/issues/8",
          "https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/4.A.3_09F29912-8E93-461E-9E89-3F06F6763383.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_decompress_commands.yml"
      }
    },
    {
      "id": "38a7625e-b2cb-485d-b83d-aff137d859f4",
      "title": "Potential RemoteFXvGPUDisablement.EXE Abuse - PowerShell Module",
      "status": "test",
      "description": "Detects PowerShell module creation where the module Contents are set to \"function Get-VMRemoteFXPhysicalVideoAdapter\". This could be a sign of potential abuse of the \"RemoteFXvGPUDisablement.exe\" binary which is known to be vulnerable to module load-order hijacking.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1218"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": "ModuleContents=function Get-VMRemoteFXPhysicalVideoAdapter {",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1218"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
        "date": "2021-07-13",
        "modified": "2023-05-09",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218/T1218.md",
          "https://github.com/redcanaryco/AtomicTestHarnesses/blob/7e1e4da116801e3d6fcc6bedb207064577e40572/TestHarnesses/T1218_SignedBinaryProxyExecution/InvokeRemoteFXvGPUDisablementCommand.ps1"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_remotefxvgpudisablement_abuse.yml"
      }
    },
    {
      "id": "8d31a8ce-46b5-4dd6-bdc3-680931f1db86",
      "title": "Bad Opsec Powershell Code Artifacts",
      "status": "test",
      "description": "focuses on trivial artifacts observed in variants of prevalent offensive ps1 payloads, including\nCobalt Strike Beacon, PoshC2, Powerview, Letmein, Empire, Powersploit, and other attack payloads\nthat often undergo minimal changes by attackers due to bad opsec.\n",
      "level": "critical",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "$DoIt",
                  "harmj0y",
                  "mattifestation",
                  "_RastaMouse",
                  "tifkin_",
                  "0xdeadbeef"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "ok @securonix invrep_de, oscd.community",
        "date": "2020-10-09",
        "modified": "2022-12-25",
        "references": [
          "https://newtonpaul.com/analysing-fileless-malware-cobalt-strike-beacon/",
          "https://labs.sentinelone.com/top-tier-russian-organized-cybercrime-group-unveils-fileless-stealthy-powertrick-backdoor-for-high-value-targets/",
          "https://www.mdeditor.tw/pl/pgRt"
        ],
        "falsepositives": [
          "Moderate-to-low; Despite the shorter length/lower entropy for some of these, because of high specificity, fp appears to be fairly limited in many environments."
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_bad_opsec_artifacts.yml"
      }
    },
    {
      "id": "815bfc17-7fc6-4908-a55e-2f37b98cedb4",
      "title": "AD Groups Or Users Enumeration Using PowerShell - PoshModule",
      "status": "test",
      "description": "Adversaries may attempt to find domain-level groups and permission settings.\nThe knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as domain administrators.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_ad_principal": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains": {
                    "field": "Payload",
                    "value": "get-ADPrincipalGroupMembership",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains": {
                    "field": "ContextInfo",
                    "value": "get-ADPrincipalGroupMembership",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          },
          "selection_get_aduser": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains_all": {
                    "field": "Payload",
                    "value": [
                      "get-aduser",
                      "-f ",
                      "-pr ",
                      "DoesNotRequirePreAuth"
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains_all": {
                    "field": "ContextInfo",
                    "value": [
                      "get-aduser",
                      "-f ",
                      "-pr ",
                      "DoesNotRequirePreAuth"
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-15",
        "modified": "2023-01-20",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
        ],
        "falsepositives": [
          "Administrator script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_ad_group_reco.yml"
      }
    },
    {
      "id": "ebdf49d8-b89c-46c9-8fdf-2c308406f6bd",
      "title": "Invoke-Obfuscation Via Use Clip - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use Clip.exe in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "(?i)echo.*clip.*&&.*(Clipboard|i`?n`?v`?o`?k`?e`?)",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-09",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_use_clip.yml"
      }
    },
    {
      "id": "f99276ad-d122-4989-a09a-d00904a5f9d2",
      "title": "Clear PowerShell History - PowerShell Module",
      "status": "test",
      "description": "Detects keywords that could indicate clearing PowerShell history",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1070.003"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_1a_payload": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "del",
                  "Remove-Item",
                  "rm"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_1b_payload": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": "(Get-PSReadlineOption).HistorySavePath",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "selection_payload_2": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "Set-PSReadlineOption",
                  "â€“HistorySaveStyle",
                  "SaveNothing"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_payload_3": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "Set-PSReadlineOption",
                  "-HistorySaveStyle",
                  "SaveNothing"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_payload_* or all of selection_1*",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "1 of selection_payload_*",
            "all of selection_1*"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1070.003"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Ilyas Ochkov, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community",
        "date": "2019-10-25",
        "modified": "2022-12-02",
        "references": [
          "https://gist.github.com/hook-s3c/7363a856c3cdbadeb71085147f042c1a"
        ],
        "falsepositives": [
          "Legitimate PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_clear_powershell_history.yml"
      }
    },
    {
      "id": "88a22f69-62f9-4b8a-aa00-6b0212f2f05a",
      "title": "Invoke-Obfuscation Via Use Rundll32 - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use Rundll32 in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "&&",
                  "rundll32",
                  "shell32.dll",
                  "shellexec_rundll"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "value",
                  "invoke",
                  "comspec",
                  "iex"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2019-10-08",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_use_rundll32.yml"
      }
    },
    {
      "id": "9fe55ea2-4cd6-4491-8a54-dd6871651b51",
      "title": "HackTool - Evil-WinRm Execution - PowerShell Module",
      "status": "test",
      "description": "Detects the execution of Evil-WinRM via PowerShell Module logs by leveraging the hardcoded strings inside the utility.\n",
      "level": "high",
      "tags": [
        "attack.lateral-movement"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_wsm": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  ":\\Windows\\System32\\wsmprovhost.exe",
                  ":\\Windows\\SysWOW64\\wsmprovhost.exe"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_payload_1": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "value=\"(get-location).path",
                  "value=\"(get-item*).length",
                  "Invoke-Binary ",
                  "Donut-Loader -process_id*-donutfile",
                  "Bypass-4MSI",
                  "IEX ([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String($a))).replace('???','')"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_payload_2": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "$servicios = Get-ItemProperty \"registry::HKLM\\System\\CurrentControlSet\\Services\\\"",
                  "Where-Object {$_.imagepath -notmatch \"system\" -and $_.imagepath -ne $null } | Select-Object pschildname,imagepath"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_payload_3": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "$a +=  \\\"$($_.FullName.Replace('\\\\','/'))/\\\"}else{  $a += \\\"$($_.FullName.Replace('\\\\', '/'))\\\" }",
                  "$a=@();$"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_wsm and 1 of selection_payload_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection_wsm"
            },
            {
              "type": "ref",
              "value": "1 of selection_payload_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems)",
        "date": "2024-02-25",
        "modified": "",
        "references": [
          "https://github.com/Hackplayers/evil-winrm/blob/7514b055d67ec19836e95c05bd63e7cc47c4c2aa/evil-winrm.rb",
          "https://github.com/search?q=repo%3AHackplayers%2Fevil-winrm++shell.run%28&type=code"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_hktl_evil_winrm_execution.yml"
      }
    },
    {
      "id": "daf7eb81-35fd-410d-9d7a-657837e602bb",
      "title": "Zip A Folder With PowerShell For Staging In Temp  - PowerShell Module",
      "status": "test",
      "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1074.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "Compress-Archive -Path*-DestinationPath $env:TEMP",
                  "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                  "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1074.001"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
        "date": "2021-07-20",
        "modified": "2023-12-18",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
          "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_zip_compress.yml"
      }
    },
    {
      "id": "a23791fe-8846-485a-b16b-ca691e1b03d4",
      "title": "Invoke-Obfuscation RUNDLL LAUNCHER - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via RUNDLL LAUNCHER",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "rundll32.exe",
                  "shell32.dll",
                  "shellexec_rundll",
                  "powershell"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-18",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_rundll.yml"
      }
    },
    {
      "id": "4cbd4f12-2e22-43e3-882f-bff3247ffb78",
      "title": "PowerShell Get Clipboard",
      "status": "test",
      "description": "A General detection for the Get-Clipboard commands in PowerShell logs. This could be an adversary capturing clipboard contents.",
      "level": "medium",
      "tags": [
        "attack.collection",
        "attack.t1115"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": "Get-Clipboard",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1115"
        ],
        "tactics": [
          "collection"
        ]
      },
      "meta": {
        "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
        "date": "2020-05-02",
        "modified": "2023-01-04",
        "references": [
          "https://github.com/OTRF/detection-hackathon-apt29/issues/16",
          "https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/7.A.2_F4609F7E-C4DB-4327-91D4-59A58C962A02.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_get_clipboard.yml"
      }
    },
    {
      "id": "7034cbbb-cc55-4dc2-8dad-36c0b942e8f1",
      "title": "Invoke-Obfuscation COMPRESS OBFUSCATION - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via COMPRESS OBFUSCATION",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "new-object",
                  "text.encoding]::ascii"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              },
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "system.io.compression.deflatestream",
                  "system.io.streamreader"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              },
              "Payload__endswith": {
                "field": "Payload",
                "value": "readtoend",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-18",
        "modified": "2022-11-29",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_compress.yml"
      }
    },
    {
      "id": "74176142-4684-4d8a-8b0a-713257e7df8e",
      "title": "Potential Active Directory Enumeration Using AD Module - PsModule",
      "status": "test",
      "description": "Detects usage of the \"Import-Module\" cmdlet to load the \"Microsoft.ActiveDirectory.Management.dl\" DLL. Which is often used by attackers to perform AD enumeration.",
      "level": "medium",
      "tags": [
        "attack.reconnaissance",
        "attack.discovery",
        "attack.impact"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_cmdlet": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "Import-Module ",
                  "ipmo "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_dll": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": "Microsoft.ActiveDirectory.Management.dll",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection_*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [],
        "tactics": [
          "reconnaissance",
          "discovery",
          "impact"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
        "date": "2023-01-22",
        "modified": "",
        "references": [
          "https://github.com/samratashok/ADModule",
          "https://twitter.com/cyb3rops/status/1617108657166061568?s=20",
          "https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/active-directory-enumeration-with-ad-module-without-rsat-or-admin-privileges"
        ],
        "falsepositives": [
          "Legitimate use of the library for administrative activity"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_active_directory_module_dll_import.yml"
      }
    },
    {
      "id": "6942bd25-5970-40ab-af49-944247103358",
      "title": "Suspicious Get Information for SMB Share - PowerShell Module",
      "status": "test",
      "description": "Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and\nto identify potential systems of interest for Lateral Movement.\nNetworks often contain shared network drives and folders that enable users to access file directories on various systems across a network.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains": {
                    "field": "Payload",
                    "value": "get-smbshare",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains": {
                    "field": "ContextInfo",
                    "value": "get-smbshare",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-15",
        "modified": "2022-12-02",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
        ],
        "falsepositives": [
          "Administrator script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_smb_share_reco.yml"
      }
    },
    {
      "id": "96b9f619-aa91-478f-bacb-c3e50f8df575",
      "title": "Remote PowerShell Session (PS Module)",
      "status": "test",
      "description": "Detects remote PowerShell sessions",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001",
        "attack.lateral-movement",
        "attack.t1021.006"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  " = ServerRemoteHost ",
                  "wsmprovhost.exe"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_pwsh_archive": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules\\Microsoft.PowerShell.Archive\\Microsoft.PowerShell.Archive.psm1",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001",
          "T1021.006"
        ],
        "tactics": [
          "execution",
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "Roberto Rodriguez @Cyb3rWard0g, Tim Shelton",
        "date": "2019-08-10",
        "modified": "2023-01-20",
        "references": [
          "https://threathunterplaybook.com/hunts/windows/190511-RemotePwshExecution/notebook.html"
        ],
        "falsepositives": [
          "Legitimate use remote PowerShell sessions"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_remote_powershell_session.yml"
      }
    },
    {
      "id": "07ad2ea8-6a55-4ac6-bf3e-91b8e59676eb",
      "title": "Invoke-Obfuscation Via Use MSHTA - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via use MSHTA in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "set",
                  "&&",
                  "mshta",
                  "vbscript:createobject",
                  ".run",
                  "(window.close)"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-08",
        "modified": "2023-01-04",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_use_mhsta.yml"
      }
    },
    {
      "id": "b140afd9-474b-4072-958e-2ebb435abd68",
      "title": "Suspicious Get-ADDBAccount Usage",
      "status": "test",
      "description": "Detects suspicious invocation of the Get-ADDBAccount script that reads from a ntds.dit file and may be used to get access to credentials without using any credential dumpers",
      "level": "high",
      "tags": [
        "attack.credential-access",
        "attack.t1003.003"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "Payload__contains_all": {
                "field": "Payload",
                "value": [
                  "Get-ADDBAccount",
                  "BootKey ",
                  "DatabasePath "
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1003.003"
        ],
        "tactics": [
          "credential_access"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2022-03-16",
        "modified": "",
        "references": [
          "https://www.n00py.io/2022/03/manipulating-user-passwords-without-mimikatz/",
          "https://github.com/MichaelGrafnetter/DSInternals/blob/7ba59c12ee9a1cb430d7dc186a3366842dd612c8/Documentation/PowerShell/Get-ADDBAccount.md"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_get_addbaccount.yml"
      }
    },
    {
      "id": "64e8e417-c19a-475a-8d19-98ea705394cc",
      "title": "Alternate PowerShell Hosts - PowerShell Module",
      "status": "test",
      "description": "Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe",
      "level": "medium",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "*",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_powershell": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  "= powershell",
                  "= C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell",
                  "= C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell",
                  "= C:/Windows/System32/WindowsPowerShell/v1.0/powershell",
                  "= C:/Windows/SysWOW64/WindowsPowerShell/v1.0/powershell",
                  "= \\\\\\?\\?\\C:Windows\\System32\\WindowsPowerShell\\v1.0\\powershell",
                  "= \\\\\\?\\?\\C:Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "filter_sdiagnhost": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "= C:\\WINDOWS\\System32\\sdiagnhost.exe -Embedding",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_citrix": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "ConfigSyncRun.exe",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_adace": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "C:\\Windows\\system32\\dsac.exe",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_winrm": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "C:\\Windows\\system32\\wsmprovhost.exe -Embedding",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_help_update": {
            "type": "field_match",
            "matchers": {
              "Payload__contains": {
                "field": "Payload",
                "value": [
                  "Update-Help",
                  "Failed to update Help for the module"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Roberto Rodriguez @Cyb3rWard0g",
        "date": "2019-08-11",
        "modified": "2025-10-17",
        "references": [
          "https://threathunterplaybook.com/hunts/windows/190610-PwshAlternateHosts/notebook.html"
        ],
        "falsepositives": [
          "Programs using PowerShell directly without invocation of a dedicated interpreter",
          "MSP Detection Searcher",
          "Citrix ConfigSync.ps1"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_alternate_powershell_hosts.yml"
      }
    },
    {
      "id": "9ac8b09b-45de-4a07-9da1-0de8c09304a3",
      "title": "Invoke-Obfuscation STDIN+ Launcher - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated use of stdin to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "cmd.{0,5}(?:/c|/r).+powershell.+(?:\\$\\{?input\\}?|noexit).+\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-15",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_stdin.yml"
      }
    },
    {
      "id": "c72aca44-8d52-45ad-8f81-f96c4d3c755e",
      "title": "Invoke-Obfuscation Via Stdin - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via Stdin in Scripts",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "(?i)(set).*&&\\s?set.*(environment|invoke|\\$?\\{?input).*&&.*\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Nikita Nazarov, oscd.community",
        "date": "2020-10-12",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_stdin.yml"
      }
    },
    {
      "id": "fe5ce7eb-dad8-467c-84a9-31ec23bd644a",
      "title": "SyncAppvPublishingServer Bypass Powershell Restriction - PS Module",
      "status": "test",
      "description": "Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1218"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": "SyncAppvPublishingServer.exe",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1218"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "Ensar Åžamil, @sblmsrsn, OSCD Community",
        "date": "2020-10-05",
        "modified": "2022-12-02",
        "references": [
          "https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/"
        ],
        "falsepositives": [
          "App-V clients"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_syncappvpublishingserver_exe.yml"
      }
    },
    {
      "id": "bbb80e91-5746-4fbe-8898-122e2cafdbf4",
      "title": "Suspicious PowerShell Invocations - Generic - PowerShell Module",
      "status": "test",
      "description": "Detects suspicious PowerShell invocation command parameters",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_encoded": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  " -enc ",
                  " -EncodedCommand ",
                  " -ec "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_hidden": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  " -w hidden ",
                  " -window hidden ",
                  " -windowstyle hidden ",
                  " -w 1 "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_noninteractive": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  " -noni ",
                  " -noninteractive "
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "all of selection*",
        "condition_parsed": {
          "op": "all_of",
          "pattern": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "Florian Roth (Nextron Systems)",
        "date": "2017-03-12",
        "modified": "2023-01-03",
        "references": [
          "Internal Research"
        ],
        "falsepositives": [
          "Very special / sneaky PowerShell scripts"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_invocation_generic.yml"
      }
    },
    {
      "id": "a136cde0-61ad-4a61-9b82-8dc490e60dd2",
      "title": "Invoke-Obfuscation CLIP+ Launcher - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated use of Clip.exe to execute PowerShell",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "cmd.{0,5}(?:/c|/r).+clip(?:\\.exe)?.{0,4}&&.+clipboard]::\\(\\s\\\\\"\\{\\d\\}.+-f.+\"",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Jonathan Cheong, oscd.community",
        "date": "2020-10-13",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_clip.yml"
      }
    },
    {
      "id": "cef24b90-dddc-4ae1-a09a-8764872f69fc",
      "title": "Suspicious Get Local Groups Information",
      "status": "test",
      "description": "Detects the use of PowerShell modules and cmdlets to gather local group information.\nAdversaries may use local system permission groups to determine which groups exist and which users belong to a particular group such as the local administrators group.\n",
      "level": "low",
      "tags": [
        "attack.discovery",
        "attack.t1069.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_localgroup": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains": {
                    "field": "Payload",
                    "value": [
                      "get-localgroup ",
                      "get-localgroupmember "
                    ],
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains": {
                    "field": "ContextInfo",
                    "value": [
                      "get-localgroup ",
                      "get-localgroupmember "
                    ],
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          },
          "selection_wmi_module": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains": {
                    "field": "Payload",
                    "value": [
                      "get-wmiobject ",
                      "gwmi ",
                      "get-ciminstance ",
                      "gcim "
                    ],
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains_all": {
                    "field": "ContextInfo",
                    "value": [
                      "get-wmiobject ",
                      "gwmi ",
                      "get-ciminstance ",
                      "gcim "
                    ],
                    "modifiers": [
                      "contains",
                      "all"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          },
          "selection_wmi_class": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "Payload__contains": {
                    "field": "Payload",
                    "value": "win32_group",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ContextInfo__contains": {
                    "field": "ContextInfo",
                    "value": "win32_group",
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {},
        "condition": "selection_localgroup or all of selection_wmi_*",
        "condition_parsed": {
          "op": "or",
          "operands": [
            "selection_localgroup",
            "all of selection_wmi_*"
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1069.001"
        ],
        "tactics": [
          "discovery"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2021-12-12",
        "modified": "2025-08-22",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
        ],
        "falsepositives": [
          "Administrator script"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_susp_local_group_reco.yml"
      }
    },
    {
      "id": "41025fd7-0466-4650-a813-574aaacbe7f4",
      "title": "Malicious PowerShell Scripts - PoshModule",
      "status": "test",
      "description": "Detects the execution of known offensive powershell scripts used for exploitation or reconnaissance",
      "level": "high",
      "tags": [
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_generic": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains": {
                "field": "ContextInfo",
                "value": [
                  "Add-ConstrainedDelegationBackdoor.ps1",
                  "Add-Exfiltration.ps1",
                  "Add-Persistence.ps1",
                  "Add-RegBackdoor.ps1",
                  "Add-RemoteRegBackdoor.ps1",
                  "Add-ScrnSaveBackdoor.ps1",
                  "BadSuccessor.ps1",
                  "Check-VM.ps1",
                  "ConvertTo-ROT13.ps1",
                  "Copy-VSS.ps1",
                  "Create-MultipleSessions.ps1",
                  "DNS_TXT_Pwnage.ps1",
                  "dnscat2.ps1",
                  "Do-Exfiltration.ps1",
                  "DomainPasswordSpray.ps1",
                  "Download_Execute.ps1",
                  "Download-Execute-PS.ps1",
                  "Enabled-DuplicateToken.ps1",
                  "Enable-DuplicateToken.ps1",
                  "Execute-Command-MSSQL.ps1",
                  "Execute-DNSTXT-Code.ps1",
                  "Execute-OnTime.ps1",
                  "ExetoText.ps1",
                  "Exploit-Jboss.ps1",
                  "Find-AVSignature.ps1",
                  "Find-Fruit.ps1",
                  "Find-GPOLocation.ps1",
                  "Find-TrustedDocuments.ps1",
                  "FireBuster.ps1",
                  "FireListener.ps1",
                  "Get-ApplicationHost.ps1",
                  "Get-ChromeDump.ps1",
                  "Get-ClipboardContents.ps1",
                  "Get-ComputerDetail.ps1",
                  "Get-FoxDump.ps1",
                  "Get-GPPAutologon.ps1",
                  "Get-GPPPassword.ps1",
                  "Get-IndexedItem.ps1",
                  "Get-Keystrokes.ps1",
                  "Get-LSASecret.ps1",
                  "Get-MicrophoneAudio.ps1",
                  "Get-PassHashes.ps1",
                  "Get-PassHints.ps1",
                  "Get-RegAlwaysInstallElevated.ps1",
                  "Get-RegAutoLogon.ps1",
                  "Get-RickAstley.ps1",
                  "Get-Screenshot.ps1",
                  "Get-SecurityPackages.ps1",
                  "Get-ServiceFilePermission.ps1",
                  "Get-ServicePermission.ps1",
                  "Get-ServiceUnquoted.ps1",
                  "Get-SiteListPassword.ps1",
                  "Get-System.ps1",
                  "Get-TimedScreenshot.ps1",
                  "Get-UnattendedInstallFile.ps1",
                  "Get-Unconstrained.ps1",
                  "Get-USBKeystrokes.ps1",
                  "Get-VaultCredential.ps1",
                  "Get-VulnAutoRun.ps1",
                  "Get-VulnSchTask.ps1",
                  "Get-WebConfig.ps1",
                  "Get-WebCredentials.ps1",
                  "Get-WLAN-Keys.ps1",
                  "Gupt-Backdoor.ps1",
                  "HTTP-Backdoor.ps1",
                  "HTTP-Login.ps1",
                  "Install-ServiceBinary.ps1",
                  "Install-SSP.ps1",
                  "Invoke-ACLScanner.ps1",
                  "Invoke-ADSBackdoor.ps1",
                  "Invoke-AmsiBypass.ps1",
                  "Invoke-ARPScan.ps1",
                  "Invoke-BackdoorLNK.ps1",
                  "Invoke-BadPotato.ps1",
                  "Invoke-BetterSafetyKatz.ps1",
                  "Invoke-BruteForce.ps1",
                  "Invoke-BypassUAC.ps1",
                  "Invoke-Carbuncle.ps1",
                  "Invoke-Certify.ps1",
                  "Invoke-ConPtyShell.ps1",
                  "Invoke-CredentialInjection.ps1",
                  "Invoke-CredentialsPhish.ps1",
                  "Invoke-DAFT.ps1",
                  "Invoke-DCSync.ps1",
                  "Invoke-Decode.ps1",
                  "Invoke-DinvokeKatz.ps1",
                  "Invoke-DllInjection.ps1",
                  "Invoke-DNSExfiltrator.ps1",
                  "Invoke-DowngradeAccount.ps1",
                  "Invoke-EgressCheck.ps1",
                  "Invoke-Encode.ps1",
                  "Invoke-EventViewer.ps1",
                  "Invoke-Eyewitness.ps1",
                  "Invoke-FakeLogonScreen.ps1",
                  "Invoke-Farmer.ps1",
                  "Invoke-Get-RBCD-Threaded.ps1",
                  "Invoke-Gopher.ps1",
                  "Invoke-Grouper2.ps1",
                  "Invoke-Grouper3.ps1",
                  "Invoke-HandleKatz.ps1",
                  "Invoke-Interceptor.ps1",
                  "Invoke-Internalmonologue.ps1",
                  "Invoke-Inveigh.ps1",
                  "Invoke-InveighRelay.ps1",
                  "Invoke-JSRatRegsvr.ps1",
                  "Invoke-JSRatRundll.ps1",
                  "Invoke-KrbRelay.ps1",
                  "Invoke-KrbRelayUp.ps1",
                  "Invoke-LdapSignCheck.ps1",
                  "Invoke-Lockless.ps1",
                  "Invoke-MalSCCM.ps1",
                  "Invoke-Mimikatz.ps1",
                  "Invoke-MimikatzWDigestDowngrade.ps1",
                  "Invoke-Mimikittenz.ps1",
                  "Invoke-MITM6.ps1",
                  "Invoke-NanoDump.ps1",
                  "Invoke-NetRipper.ps1",
                  "Invoke-NetworkRelay.ps1",
                  "Invoke-NinjaCopy.ps1",
                  "Invoke-OxidResolver.ps1",
                  "Invoke-P0wnedshell.ps1",
                  "Invoke-P0wnedshellx86.ps1",
                  "Invoke-Paranoia.ps1",
                  "Invoke-PortScan.ps1",
                  "Invoke-PoshRatHttp.ps1",
                  "Invoke-PoshRatHttps.ps1",
                  "Invoke-PostExfil.ps1",
                  "Invoke-PowerDump.ps1",
                  "Invoke-PowerDPAPI.ps1",
                  "Invoke-PowerShellIcmp.ps1",
                  "Invoke-PowerShellTCP.ps1",
                  "Invoke-PowerShellTcpOneLine.ps1",
                  "Invoke-PowerShellTcpOneLineBind.ps1",
                  "Invoke-PowerShellUdp.ps1",
                  "Invoke-PowerShellUdpOneLine.ps1",
                  "Invoke-PowerShellWMI.ps1",
                  "Invoke-PowerThIEf.ps1",
                  "Invoke-PPLDump.ps1",
                  "Invoke-Prasadhak.ps1",
                  "Invoke-PsExec.ps1",
                  "Invoke-PsGcat.ps1",
                  "Invoke-PsGcatAgent.ps1",
                  "Invoke-PSInject.ps1",
                  "Invoke-PsUaCme.ps1",
                  "Invoke-ReflectivePEInjection.ps1",
                  "Invoke-ReverseDNSLookup.ps1",
                  "Invoke-Rubeus.ps1",
                  "Invoke-RunAs.ps1",
                  "Invoke-SafetyKatz.ps1",
                  "Invoke-SauronEye.ps1",
                  "Invoke-SCShell.ps1",
                  "Invoke-Seatbelt.ps1",
                  "Invoke-ServiceAbuse.ps1",
                  "Invoke-SessionGopher.ps1",
                  "Invoke-ShellCode.ps1",
                  "Invoke-SMBScanner.ps1",
                  "Invoke-Snaffler.ps1",
                  "Invoke-Spoolsample.ps1",
                  "Invoke-SSHCommand.ps1",
                  "Invoke-SSIDExfil.ps1",
                  "Invoke-StandIn.ps1",
                  "Invoke-StickyNotesExtract.ps1",
                  "Invoke-Tater.ps1",
                  "Invoke-Thunderfox.ps1",
                  "Invoke-ThunderStruck.ps1",
                  "Invoke-TokenManipulation.ps1",
                  "Invoke-Tokenvator.ps1",
                  "Invoke-TotalExec.ps1",
                  "Invoke-UrbanBishop.ps1",
                  "Invoke-UserHunter.ps1",
                  "Invoke-VoiceTroll.ps1",
                  "Invoke-Whisker.ps1",
                  "Invoke-WinEnum.ps1",
                  "Invoke-winPEAS.ps1",
                  "Invoke-WireTap.ps1",
                  "Invoke-WmiCommand.ps1",
                  "Invoke-WScriptBypassUAC.ps1",
                  "Invoke-Zerologon.ps1",
                  "Keylogger.ps1",
                  "MailRaider.ps1",
                  "New-HoneyHash.ps1",
                  "OfficeMemScraper.ps1",
                  "Offline_Winpwn.ps1",
                  "Out-CHM.ps1",
                  "Out-DnsTxt.ps1",
                  "Out-Excel.ps1",
                  "Out-HTA.ps1",
                  "Out-Java.ps1",
                  "Out-JS.ps1",
                  "Out-Minidump.ps1",
                  "Out-RundllCommand.ps1",
                  "Out-SCF.ps1",
                  "Out-SCT.ps1",
                  "Out-Shortcut.ps1",
                  "Out-WebQuery.ps1",
                  "Out-Word.ps1",
                  "Parse_Keys.ps1",
                  "Port-Scan.ps1",
                  "PowerBreach.ps1",
                  "powercat.ps1",
                  "PowerRunAsSystem.psm1",
                  "PowerSharpPack.ps1",
                  "PowerUp.ps1",
                  "PowerUpSQL.ps1",
                  "PowerView.ps1",
                  "PSAsyncShell.ps1",
                  "RemoteHashRetrieval.ps1",
                  "Remove-Persistence.ps1",
                  "Remove-PoshRat.ps1",
                  "Remove-Update.ps1",
                  "Run-EXEonRemote.ps1",
                  "Schtasks-Backdoor.ps1",
                  "Set-DCShadowPermissions.ps1",
                  "Set-MacAttribute.ps1",
                  "Set-RemotePSRemoting.ps1",
                  "Set-RemoteWMI.ps1",
                  "Set-Wallpaper.ps1",
                  "Show-TargetScreen.ps1",
                  "Speak.ps1",
                  "Start-CaptureServer.ps1",
                  "Start-WebcamRecorder.ps1",
                  "StringToBase64.ps1",
                  "TexttoExe.ps1",
                  "Veeam-Get-Creds.ps1",
                  "VolumeShadowCopyTools.ps1",
                  "WinPwn.ps1",
                  "WSUSpendu.ps1"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_invoke_sharp": {
            "type": "field_match",
            "matchers": {
              "ContextInfo__contains_all": {
                "field": "ContextInfo",
                "value": [
                  "Invoke-Sharp",
                  ".ps1"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "1 of selection_*",
        "condition_parsed": {
          "op": "n_of",
          "count": 1,
          "pattern": "selection_"
        }
      },
      "mitre": {
        "techniques": [
          "T1059.001"
        ],
        "tactics": [
          "execution"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-23",
        "modified": "2025-12-10",
        "references": [
          "https://github.com/PowerShellMafia/PowerSploit",
          "https://github.com/NetSPI/PowerUpSQL",
          "https://github.com/CsEnox/EventViewer-UACBypass",
          "https://web.archive.org/web/20210511204621/https://github.com/AlsidOfficial/WSUSpendu",
          "https://github.com/nettitude/Invoke-PowerThIEf",
          "https://github.com/S3cur3Th1sSh1t/WinPwn",
          "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
          "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
          "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
          "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
          "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
          "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
          "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
          "https://github.com/HarmJ0y/DAMP",
          "https://github.com/samratashok/nishang",
          "https://github.com/DarkCoderSc/PowerRunAsSystem/",
          "https://github.com/besimorhino/powercat",
          "https://github.com/sadshade/veeam-creds/blob/6010eaf31ba41011b58d6af3950cffbf6f5cea32/Veeam-Get-Creds.ps1",
          "https://github.com/The-Viper-One/Invoke-PowerDPAPI/",
          "https://github.com/Arno0x/DNSExfiltrator/"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_exploit_scripts.yml"
      }
    },
    {
      "id": "f3c89218-8c3d-4ba9-9974-f1d8e6a1b4a6",
      "title": "Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION - PowerShell Module",
      "status": "test",
      "description": "Detects Obfuscated Powershell via VAR++ LAUNCHER",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1027",
        "attack.execution",
        "attack.t1059.001"
      ],
      "logsource": {
        "category": "ps_module",
        "product": "windows",
        "service": null
      },
      "detection": {
        "selections": {
          "selection_4103": {
            "type": "field_match",
            "matchers": {
              "Payload__re": {
                "field": "Payload",
                "value": "(?i)&&set.*(\\{\\d\\}){2,}\\\\\"\\s+?-f.*&&.*cmd.*/c",
                "modifiers": [
                  "re"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection_4103",
        "condition_parsed": {
          "op": "single",
          "selection": "selection_4103"
        }
      },
      "mitre": {
        "techniques": [
          "T1027",
          "T1059.001"
        ],
        "tactics": [
          "defense_evasion",
          "execution"
        ]
      },
      "meta": {
        "author": "Timur Zinniatullin, oscd.community",
        "date": "2020-10-13",
        "modified": "2024-04-05",
        "references": [
          "https://github.com/SigmaHQ/sigma/issues/1009"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/powershell/powershell_module/posh_pm_invoke_obfuscation_via_var.yml"
      }
    }
  ]
}