{
  "metadata": {
    "logsource": "windows_iis_configuration",
    "rule_count": 4,
    "compiled_at": "2026-02-04T12:28:36.392423",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "dd857d3e-0c6e-457b-9b48-e82ae7f86bd7",
      "title": "New Module Module Added To IIS Server",
      "status": "test",
      "description": "Detects the addition of a new module to an IIS server.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1562.002",
        "attack.t1505.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "iis-configuration"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 29,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "Configuration__contains": {
                "field": "Configuration",
                "value": "/system.webServer/modules/add",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_builtin": {
            "type": "field_match",
            "matchers": {
              "NewValue": {
                "field": "NewValue",
                "value": [
                  "AnonymousAuthenticationModule",
                  "CustomErrorModule",
                  "DefaultDocumentModule",
                  "DirectoryListingModule",
                  "FileCacheModule",
                  "HttpCacheModule",
                  "HttpLoggingModule",
                  "ProtocolSupportModule",
                  "RequestFilteringModule",
                  "StaticCompressionModule",
                  "StaticFileModule",
                  "TokenCacheModule",
                  "UriCacheModule"
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          },
          "filter_main_remove": {
            "type": "field_match",
            "matchers": {
              "NewValue": {
                "field": "NewValue",
                "value": "",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.002",
          "T1505.004"
        ],
        "tactics": [
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2024-10-06",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis",
          "https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/",
          "https://www.microsoft.com/en-us/security/blog/2022/07/26/malicious-iis-extensions-quietly-open-persistent-backdoors-into-servers/",
          "https://learn.microsoft.com/en-us/iis/get-started/introduction-to-iis/iis-modules-overview"
        ],
        "falsepositives": [
          "Legitimate administrator activity"
        ],
        "source_file": "sigma_rules/windows/builtin/iis-configuration/win_iis_module_added.yml"
      }
    },
    {
      "id": "9e1a1fdf-ee58-40ce-8e15-b66ca5a80e1f",
      "title": "Previously Installed IIS Module Was Removed",
      "status": "test",
      "description": "Detects the removal of a previously installed IIS module.",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1562.002",
        "attack.t1505.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "iis-configuration"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 29,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "Configuration__contains": {
                "field": "Configuration",
                "value": "/system.webServer/modules/remove",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.002",
          "T1505.004"
        ],
        "tactics": [
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "Nasreddine Bencherchali",
        "date": "2024-10-06",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis",
          "https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/",
          "https://www.microsoft.com/en-us/security/blog/2022/07/26/malicious-iis-extensions-quietly-open-persistent-backdoors-into-servers/",
          "https://learn.microsoft.com/en-us/iis/get-started/introduction-to-iis/iis-modules-overview"
        ],
        "falsepositives": [
          "Legitimate administrator activity"
        ],
        "source_file": "sigma_rules/windows/builtin/iis-configuration/win_iis_module_removed.yml"
      }
    },
    {
      "id": "e8ebd53a-30c2-45bd-81bb-74befba07bdb",
      "title": "HTTP Logging Disabled On IIS Server",
      "status": "test",
      "description": "Detects changes to of the IIS server configuration in order to disable HTTP logging for successful requests.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1562.002",
        "attack.t1505.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "iis-configuration"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 29,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "Configuration": {
                "field": "Configuration",
                "value": "/system.webServer/httpLogging/@dontLog",
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "NewValue": {
                "field": "NewValue",
                "value": "true",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.002",
          "T1505.004"
        ],
        "tactics": [
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2024-10-06",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis",
          "https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/",
          "https://learn.microsoft.com/en-us/iis/configuration/system.webserver/httplogging"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/builtin/iis-configuration/win_iis_logging_http_disabled.yml"
      }
    },
    {
      "id": "a5b40a90-baf5-4bf7-a6f7-373494881d22",
      "title": "ETW Logging/Processing Option Disabled On IIS Server",
      "status": "test",
      "description": "Detects changes to of the IIS server configuration in order to disable/remove the ETW logging/processing option.",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.persistence",
        "attack.t1562.002",
        "attack.t1505.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "iis-configuration"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 29,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "Configuration__endswith": {
                "field": "Configuration",
                "value": "@logTargetW3C",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              },
              "OldValue__contains": {
                "field": "OldValue",
                "value": "ETW",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_etw_added": {
            "type": "field_match",
            "matchers": {
              "NewValue__contains": {
                "field": "NewValue",
                "value": "ETW",
                "modifiers": [
                  "contains"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.002",
          "T1505.004"
        ],
        "tactics": [
          "defense_evasion",
          "persistence"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali",
        "date": "2024-10-06",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/iis/manage/provisioning-and-managing-iis/configure-logging-in-iis",
          "https://www.microsoft.com/en-us/security/blog/2022/12/12/iis-modules-the-evolution-of-web-shells-and-how-to-detect-them/",
          "https://learn.microsoft.com/en-us/iis/configuration/system.applicationhost/sites/sitedefaults/logfile/"
        ],
        "falsepositives": [
          "Legitimate administrator activity"
        ],
        "source_file": "sigma_rules/windows/builtin/iis-configuration/win_iis_logging_etw_disabled.yml"
      }
    }
  ]
}