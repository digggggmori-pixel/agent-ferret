{
  "metadata": {
    "logsource": "windows_firewall_as",
    "rule_count": 8,
    "compiled_at": "2026-02-04T12:28:36.391133",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "00bb5bd5-1379-4fcf-a965-a5b6f7478064",
      "title": "Windows Firewall Settings Have Been Changed",
      "status": "test",
      "description": "Detects activity when the settings of the Windows firewall have been changed",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2002,
                  2083,
                  2003,
                  2082,
                  2008
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2022-02-19",
        "modified": "2023-04-21",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_setting_change.yml"
      }
    },
    {
      "id": "eca81e8d-09e1-4d04-8614-c91f44fd0519",
      "title": "New Firewall Rule Added In Windows Firewall Exception List Via WmiPrvSE.EXE",
      "status": "test",
      "description": "Detects the addition of a new \"Allow\" firewall rule by the WMI process (WmiPrvSE.EXE).\nThis can occur if an attacker leverages PowerShell cmdlets such as \"New-NetFirewallRule\", or directly uses WMI CIM classes such as \"MSFT_NetFirewallRule\".\n",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2004,
                  2071,
                  2097
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              },
              "Action": {
                "field": "Action",
                "value": 3,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "ModifyingApplication__endswith": {
                "field": "ModifyingApplication",
                "value": ":\\Windows\\System32\\wbem\\WmiPrvSE.exe",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2024-05-10",
        "modified": "",
        "references": [
          "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-24---set-a-firewall-rule-using-new-netfirewallrule",
          "https://malware.news/t/the-rhysida-ransomware-activity-analysis-and-ties-to-vice-society/72170",
          "https://cybersecuritynews.com/rhysida-ransomware-attacking-windows/"
        ],
        "falsepositives": [
          "Administrator scripts or activity."
        ],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_add_rule_wmiprvse.yml"
      }
    },
    {
      "id": "9e2575e7-2cb9-4da1-adc8-ed94221dca5e",
      "title": "New Firewall Rule Added In Windows Firewall Exception List For Potential Suspicious Application",
      "status": "test",
      "description": "Detects the addition of a new rule to the Windows Firewall exception list for an application located in a potentially suspicious location.",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2004,
                  2071,
                  2097
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              },
              "ApplicationPath__contains": {
                "field": "ApplicationPath",
                "value": [
                  ":\\PerfLogs\\",
                  ":\\Temp\\",
                  ":\\Tmp\\",
                  ":\\Users\\Public\\",
                  ":\\Windows\\Tasks\\",
                  ":\\Windows\\Temp\\",
                  "\\AppData\\Local\\Temp\\"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_block": {
            "type": "field_match",
            "matchers": {
              "Action": {
                "field": "Action",
                "value": 2,
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2023-02-26",
        "modified": "2024-05-10",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)",
          "https://app.any.run/tasks/7123e948-c91e-49e0-a813-00e8d72ab393/#"
        ],
        "falsepositives": [
          "Unknown"
        ],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_add_rule_susp_folder.yml"
      }
    },
    {
      "id": "c187c075-bb3e-4c62-b4fa-beae0ffc211f",
      "title": "A Rule Has Been Deleted From The Windows Firewall Exception List",
      "status": "test",
      "description": "Detects when a single rules or all of the rules have been deleted from the Windows Defender Firewall",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2006,
                  2052
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_generic": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication__startswith": {
                "field": "ModifyingApplication",
                "value": [
                  "C:\\Program Files (x86)\\",
                  "C:\\Program Files\\",
                  "C:\\Windows\\WinSxS\\"
                ],
                "modifiers": [
                  "startswith"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "filter_main_svchost": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication": {
                "field": "ModifyingApplication",
                "value": "C:\\Windows\\System32\\svchost.exe",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_optional_msmpeng": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication__startswith": {
                "field": "ModifyingApplication",
                "value": "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                "modifiers": [
                  "startswith"
                ],
                "is_list": false,
                "negated": false
              },
              "ModifyingApplication__endswith": {
                "field": "ModifyingApplication",
                "value": "\\MsMpEng.exe",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_main_null": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication": {
                "field": "ModifyingApplication",
                "value": null,
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_main_empty": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication": {
                "field": "ModifyingApplication",
                "value": "",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            },
            {
              "type": "not",
              "value": "1 of filter_optional_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-19",
        "modified": "2024-08-29",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_delete_rule.yml"
      }
    },
    {
      "id": "cde0a575-7d3d-4a49-9817-b8004a7bf105",
      "title": "Uncommon New Firewall Rule Added In Windows Firewall Exception List",
      "status": "test",
      "description": "Detects when a rule has been added to the Windows Firewall exception list",
      "level": "medium",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2004,
                  2071,
                  2097
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_block": {
            "type": "field_match",
            "matchers": {
              "Action": {
                "field": "Action",
                "value": 2,
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_main_generic": {
            "type": "field_match",
            "matchers": {
              "ApplicationPath__startswith": {
                "field": "ApplicationPath",
                "value": [
                  "C:\\Program Files (x86)\\",
                  "C:\\Program Files\\",
                  "C:\\Windows\\System32\\",
                  "C:\\Windows\\SysWOW64\\",
                  "C:\\Windows\\WinSxS\\"
                ],
                "modifiers": [
                  "startswith"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "filter_main_covered_paths": {
            "type": "field_match",
            "matchers": {
              "ApplicationPath__contains": {
                "field": "ApplicationPath",
                "value": [
                  "C:\\PerfLogs\\",
                  "C:\\Temp\\",
                  "C:\\Tmp\\",
                  "C:\\Users\\Public\\",
                  "C:\\Windows\\Tasks\\",
                  "C:\\Windows\\Temp\\",
                  "\\AppData\\Local\\Temp\\"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "filter_main_system_dllhost": {
            "type": "field_match",
            "matchers": {
              "ApplicationPath": {
                "field": "ApplicationPath",
                "value": "System",
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "ModifyingApplication": {
                "field": "ModifyingApplication",
                "value": "C:\\Windows\\System32\\dllhost.exe",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_main_tiworker": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication__startswith": {
                "field": "ModifyingApplication",
                "value": "C:\\Windows\\WinSxS\\",
                "modifiers": [
                  "startswith"
                ],
                "is_list": false,
                "negated": false
              },
              "ModifyingApplication__endswith": {
                "field": "ModifyingApplication",
                "value": "\\TiWorker.exe",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_main_null": {
            "type": "field_match",
            "matchers": {
              "ApplicationPath": {
                "field": "ApplicationPath",
                "value": null,
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_optional_no_path": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication": {
                "field": "ModifyingApplication",
                "value": [
                  "C:\\Windows\\System32\\svchost.exe",
                  "C:\\Windows\\System32\\dllhost.exe"
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              },
              "ApplicationPath": {
                "field": "ApplicationPath",
                "value": "",
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_optional_msmpeng": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ModifyingApplication__startswith": {
                    "field": "ModifyingApplication",
                    "value": [
                      "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                      "C:\\Program Files\\Windows Defender\\"
                    ],
                    "modifiers": [
                      "startswith"
                    ],
                    "is_list": true,
                    "negated": false
                  },
                  "ModifyingApplication__endswith": {
                    "field": "ModifyingApplication",
                    "value": "\\MsMpEng.exe",
                    "modifiers": [
                      "endswith"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ApplicationPath__startswith": {
                    "field": "ApplicationPath",
                    "value": [
                      "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                      "C:\\Program Files\\Windows Defender\\"
                    ],
                    "modifiers": [
                      "startswith"
                    ],
                    "is_list": true,
                    "negated": false
                  },
                  "ApplicationPath__endswith": {
                    "field": "ApplicationPath",
                    "value": "\\MsMpEng.exe",
                    "modifiers": [
                      "endswith"
                    ],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            },
            {
              "type": "not",
              "value": "1 of filter_optional_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-19",
        "modified": "2025-10-08",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_add_rule.yml"
      }
    },
    {
      "id": "04b60639-39c0-412a-9fbe-e82499c881a3",
      "title": "Windows Defender Firewall Has Been Reset To Its Default Configuration",
      "status": "test",
      "description": "Detects activity when Windows Defender Firewall has been reset to its default configuration",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2032,
                  2060
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-19",
        "modified": "2023-04-21",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_reset_config.yml"
      }
    },
    {
      "id": "7ec15688-fd24-4177-ba43-1a950537ee39",
      "title": "The Windows Defender Firewall Service Failed To Load Group Policy",
      "status": "test",
      "description": "Detects activity when The Windows Defender Firewall service failed to load Group Policy",
      "level": "low",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 2009,
                "modifiers": [],
                "is_list": false,
                "negated": false
              }
            }
          }
        },
        "filters": {},
        "condition": "selection",
        "condition_parsed": {
          "op": "single",
          "selection": "selection"
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113",
        "date": "2022-02-19",
        "modified": "2023-01-17",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_failed_load_gpo.yml"
      }
    },
    {
      "id": "79609c82-a488-426e-abcf-9f341a39365d",
      "title": "All Rules Have Been Deleted From The Windows Firewall Configuration",
      "status": "test",
      "description": "Detects when a all the rules have been deleted from the Windows Defender Firewall configuration",
      "level": "high",
      "tags": [
        "attack.defense-evasion",
        "attack.t1562.004"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "firewall-as"
      },
      "detection": {
        "selections": {
          "selection": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": [
                  2033,
                  2059
                ],
                "modifiers": [],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "filters": {
          "filter_main_svchost": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication__endswith": {
                "field": "ModifyingApplication",
                "value": ":\\Windows\\System32\\svchost.exe",
                "modifiers": [
                  "endswith"
                ],
                "is_list": false,
                "negated": false
              }
            }
          },
          "filter_optional_msmpeng": {
            "type": "field_match",
            "matchers": {
              "ModifyingApplication__contains_all": {
                "field": "ModifyingApplication",
                "value": [
                  ":\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                  "\\MsMpEng.exe"
                ],
                "modifiers": [
                  "contains",
                  "all"
                ],
                "is_list": true,
                "negated": false
              }
            }
          }
        },
        "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
        "condition_parsed": {
          "op": "and",
          "operands": [
            {
              "type": "ref",
              "value": "selection"
            },
            {
              "type": "not",
              "value": "1 of filter_main_*"
            },
            {
              "type": "not",
              "value": "1 of filter_optional_*"
            }
          ]
        }
      },
      "mitre": {
        "techniques": [
          "T1562.004"
        ],
        "tactics": [
          "defense_evasion"
        ]
      },
      "meta": {
        "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
        "date": "2023-01-17",
        "modified": "2024-01-22",
        "references": [
          "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
        ],
        "falsepositives": [],
        "source_file": "sigma_rules/windows/builtin/firewall_as/win_firewall_as_delete_all_rules.yml"
      }
    }
  ]
}