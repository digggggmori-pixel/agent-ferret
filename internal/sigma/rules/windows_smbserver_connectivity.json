{
  "metadata": {
    "logsource": "windows_smbserver_connectivity",
    "rule_count": 1,
    "compiled_at": "2026-02-04T12:28:36.562326",
    "version": "1.1"
  },
  "rules": [
    {
      "id": "8d91f6e4-9f3b-4c21-ae41-2c5b7d9f7a12",
      "title": "Unsigned or Unencrypted SMB Connection to Share Established",
      "status": "experimental",
      "description": "Detects SMB server connections to shares without signing or encryption enabled.\nThis could indicate potential lateral movement activity using unsecured SMB shares.\n",
      "level": "medium",
      "tags": [
        "attack.lateral-movement",
        "attack.t1021.002"
      ],
      "logsource": {
        "category": null,
        "product": "windows",
        "service": "smbserver-connectivity"
      },
      "detection": {
        "selections": {
          "selection_shares": {
            "type": "field_match",
            "matchers": {
              "EventID": {
                "field": "EventID",
                "value": 4000,
                "modifiers": [],
                "is_list": false,
                "negated": false
              },
              "ShareName__contains": {
                "field": "ShareName",
                "value": [
                  "IPC$",
                  "ADMIN$",
                  "C$"
                ],
                "modifiers": [
                  "contains"
                ],
                "is_list": true,
                "negated": false
              }
            }
          },
          "selection_status": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "SigningUsed": {
                    "field": "SigningUsed",
                    "value": "false",
                    "modifiers": [],
                    "is_list": false,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "EncyptionUsed": {
                    "field": "EncyptionUsed",
                    "value": "false",
                    "modifiers": [],
                    "is_list": false,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "filters": {
          "filter_main_local_ips": {
            "type": "or_list",
            "items": [
              {
                "type": "field_match",
                "matchers": {
                  "ClientAddress__cidr": {
                    "field": "ClientAddress",
                    "value": [
                      "127.0.0.0/8",
                      "169.254.0.0/16",
                      "::1/128",
                      "fe80::/10",
                      "fc00::/7"
                    ],
                    "modifiers": [
                      "cidr"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              },
              {
                "type": "field_match",
                "matchers": {
                  "ClientAddress__contains": {
                    "field": "ClientAddress",
                    "value": [
                      "00000000000000000000000000000001",
                      "FE80000000000000",
                      "FC00000000000000",
                      "0200????7F",
                      "0200????A9FE"
                    ],
                    "modifiers": [
                      "contains"
                    ],
                    "is_list": true,
                    "negated": false
                  }
                }
              }
            ]
          }
        },
        "condition": "all of selection_* and not 1 of filter_main_*",
        "condition_parsed": {
          "op": "all_of_and_not_1_of",
          "all_of": "selection_",
          "none_of": "filter_main_"
        }
      },
      "mitre": {
        "techniques": [
          "T1021.002"
        ],
        "tactics": [
          "lateral_movement"
        ]
      },
      "meta": {
        "author": "Mohamed Abdelghani",
        "date": "2025-10-19",
        "modified": "",
        "references": [
          "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/overview-server-message-block-signing"
        ],
        "falsepositives": [
          "Connections from local or private IP addresses to SMB shares without signing or encryption enabled for older systems or misconfigured environments. Apply additional tuning as needed."
        ],
        "source_file": "sigma_rules/windows/builtin/smbserver/connectivity/win_smbserver_connectivity_unsigned_and_unencrypted_share_connection.yml"
      }
    }
  ]
}