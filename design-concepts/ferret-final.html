<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferret Mascot — Final Design</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* ── Reset & Base ── */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #080810;
    color: #c0c8d8;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    line-height: 1.6;
    overflow-x: hidden;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px 60px;
  }

  /* ── Typography ── */
  h1, h2, h3 {
    font-family: 'Press Start 2P', cursive;
    letter-spacing: 1px;
  }

  /* ── Top Section ── */
  .hero {
    text-align: center;
    padding: 40px 0 30px;
  }
  .hero h1 {
    font-size: 22px;
    color: #00ffff;
    text-shadow: 0 0 20px rgba(0,255,255,0.5), 0 0 40px rgba(0,255,255,0.2);
    margin-bottom: 14px;
  }
  .hero .subtitle {
    font-family: 'Press Start 2P', cursive;
    font-size: 10px;
    color: #ff69b4;
    text-shadow: 0 0 12px rgba(255,105,180,0.4);
  }

  /* ── Pixel Art Engine ── */
  .pixel-art {
    display: inline-block;
    /* width/height set via JS; each "pixel" is a box-shadow on a 1x1 element */
  }
  .pixel-art .canvas {
    width: 1px;
    height: 1px;
    position: relative;
    /* box-shadow set inline via JS */
  }

  /* ── Large Character Display ── */
  .large-display {
    text-align: center;
    padding: 30px 0 20px;
    position: relative;
  }
  .large-display .platform {
    display: inline-block;
    position: relative;
  }
  .platform-glow {
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 16px;
    background: radial-gradient(ellipse, rgba(0,255,255,0.25) 0%, transparent 70%);
    border-radius: 50%;
  }
  .speech-bubble {
    position: absolute;
    top: -38px;
    right: -130px;
    background: #181828;
    border: 2px solid #00ffff;
    border-radius: 4px;
    padding: 6px 10px;
    font-family: 'Press Start 2P', cursive;
    font-size: 7px;
    color: #00ffff;
    white-space: nowrap;
    box-shadow: 0 0 8px rgba(0,255,255,0.2);
  }
  .speech-bubble::before {
    content: '';
    position: absolute;
    left: -8px;
    top: 50%;
    transform: translateY(-50%);
    border: 4px solid transparent;
    border-right-color: #00ffff;
  }

  /* ── Pose Grid ── */
  .pose-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin: 30px 0;
  }
  .pose-cell {
    background: #0c0c1a;
    border: 1px solid #1a1a30;
    border-radius: 4px;
    padding: 18px 10px 14px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .pose-cell:hover {
    border-color: #00ffff;
    box-shadow: 0 0 12px rgba(0,255,255,0.1), inset 0 0 12px rgba(0,255,255,0.03);
  }
  .pose-cell .art-wrap {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 80px;
    margin-bottom: 10px;
  }
  .pose-cell .label {
    font-family: 'Press Start 2P', cursive;
    font-size: 7px;
    color: #00ffff;
    margin-bottom: 4px;
  }
  .pose-cell .desc {
    font-size: 11px;
    color: #6a7080;
  }

  /* ── Section Headers ── */
  .section-title {
    font-size: 12px;
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0,255,255,0.3);
    margin: 40px 0 18px;
    padding-bottom: 8px;
    border-bottom: 1px solid #1a1a30;
  }

  /* ── Animation Demo ── */
  .anim-demo {
    background: #0a0a18;
    border: 1px solid #1a1a30;
    border-radius: 4px;
    position: relative;
    height: 140px;
    overflow: hidden;
    margin: 20px 0 30px;
  }
  .anim-demo .grid-bg {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,255,0.03) 1px, transparent 1px);
    background-size: 20px 20px;
  }
  .anim-demo .ground {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: #1a1a30;
  }
  .anim-sprite {
    position: absolute;
    bottom: 12px;
    transition: none;
  }
  .anim-speech {
    position: absolute;
    background: #181828;
    border: 1px solid #00ffff;
    border-radius: 3px;
    padding: 3px 7px;
    font-family: 'Press Start 2P', cursive;
    font-size: 6px;
    color: #00ffff;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  /* ── Color Palette ── */
  .palette {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin: 18px 0 30px;
    justify-content: center;
  }
  .palette .swatch {
    text-align: center;
  }
  .palette .swatch .block {
    width: 40px;
    height: 40px;
    border: 2px solid #1a1a30;
    border-radius: 2px;
    margin-bottom: 4px;
    image-rendering: pixelated;
  }
  .palette .swatch .hex {
    font-size: 9px;
    color: #6a7080;
    font-family: 'JetBrains Mono', monospace;
  }
  .palette .swatch .name {
    font-size: 8px;
    color: #444;
    font-family: 'JetBrains Mono', monospace;
  }

  /* ── Bottom ── */
  .bottom-bar {
    text-align: center;
    margin-top: 40px;
    padding: 20px;
    border: 1px solid #1a1a30;
    border-radius: 4px;
    background: #0c0c1a;
  }
  .bottom-bar .title-bar {
    font-family: 'Press Start 2P', cursive;
    font-size: 8px;
    color: #6a7080;
    background: #101020;
    padding: 6px 12px;
    border-radius: 3px 3px 0 0;
    margin: -20px -20px 16px;
    text-align: left;
    border-bottom: 1px solid #1a1a30;
  }
  .bottom-bar .title-bar .dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 4px;
  }
  .bottom-bar p {
    font-size: 13px;
    color: #8090a0;
    margin-bottom: 8px;
  }
  .bottom-bar .ready {
    font-family: 'Press Start 2P', cursive;
    font-size: 9px;
    color: #00ffff;
    text-shadow: 0 0 10px rgba(0,255,255,0.3);
  }
  .bottom-bar .status-bar {
    font-size: 10px;
    color: #3a3a50;
    background: #101020;
    padding: 5px 12px;
    border-radius: 0 0 3px 3px;
    margin: 16px -20px -20px;
    text-align: left;
    border-top: 1px solid #1a1a30;
  }

  /* ── Animations ── */
  @keyframes tailWag {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(1px); }
  }
  @keyframes headBob {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-2px); }
  }
  @keyframes alertBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
  }
  @keyframes sparkle {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.2; }
  }
  @keyframes breathe {
    0%, 100% { transform: scaleY(1); }
    50% { transform: scaleY(1.02); }
  }
  @keyframes runCycle {
    0% { transform: translateX(0); }
    50% { transform: translateX(2px); }
    100% { transform: translateX(0); }
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }
  @keyframes glowPulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  .anim-tail-wag { animation: tailWag 0.6s ease-in-out infinite; }
  .anim-head-bob { animation: headBob 1.2s ease-in-out infinite; }
  .anim-alert-bounce { animation: alertBounce 0.5s ease-in-out infinite; }
  .anim-sparkle { animation: sparkle 0.8s ease-in-out infinite; }
  .anim-breathe { animation: breathe 3s ease-in-out infinite; transform-origin: bottom center; }
  .anim-run { animation: runCycle 0.3s steps(1) infinite; }
  .anim-float { animation: float 2s ease-in-out infinite; }
</style>
</head>
<body>
<div class="container">

  <!-- ═══ HERO ═══ -->
  <div class="hero">
    <h1>YOUR FERRET MASCOT</h1>
    <div class="subtitle">Classic + Detective Hybrid</div>
  </div>

  <!-- ═══ LARGE DISPLAY ═══ -->
  <div class="large-display">
    <div class="platform">
      <div id="large-idle" class="anim-tail-wag"></div>
      <div class="platform-glow"></div>
      <div class="speech-bubble">Let me investigate!</div>
    </div>
  </div>

  <!-- ═══ POSE GRID ═══ -->
  <h2 class="section-title">CHARACTER POSES</h2>
  <div class="pose-grid">
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-idle" class="anim-tail-wag"></div></div>
      <div class="label">Idle</div>
      <div class="desc">Ready to investigate</div>
    </div>
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-sniff" class="anim-head-bob"></div></div>
      <div class="label">Investigate</div>
      <div class="desc">Scanning your system</div>
    </div>
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-run" class="anim-run"></div></div>
      <div class="label">Run</div>
      <div class="desc">Heading to next area</div>
    </div>
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-found" class="anim-alert-bounce"></div></div>
      <div class="label">Alert!</div>
      <div class="desc">Threat detected</div>
    </div>
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-happy" class="anim-float"></div></div>
      <div class="label">Happy</div>
      <div class="desc">Scan complete!</div>
    </div>
    <div class="pose-cell">
      <div class="art-wrap"><div id="pose-sleep" class="anim-breathe"></div></div>
      <div class="label">Sleep</div>
      <div class="desc">Waiting for scan</div>
    </div>
  </div>

  <!-- ═══ ANIMATION DEMO ═══ -->
  <h2 class="section-title">SCANNING SEQUENCE</h2>
  <div class="anim-demo" id="anim-stage">
    <div class="grid-bg"></div>
    <div class="ground"></div>
    <div class="anim-sprite" id="scene-sprite"></div>
    <div class="anim-speech" id="scene-speech"></div>
  </div>

  <!-- ═══ COLOR PALETTE ═══ -->
  <h2 class="section-title">COLOR PALETTE</h2>
  <div class="palette" id="palette"></div>

  <!-- ═══ BOTTOM ═══ -->
  <div class="bottom-bar">
    <div class="title-bar">
      <span class="dot" style="background:#ff5f57"></span>
      <span class="dot" style="background:#febc2e"></span>
      <span class="dot" style="background:#28c840"></span>
      &nbsp; ferret-mascot-v1.0
    </div>
    <p>This is your Ferret mascot — a classic NES-style detective ferret with magnifying glass.</p>
    <div class="ready">Ready to implement?</div>
    <div class="status-bar">BRIQA Ferret Agent &middot; v1.0 &middot; 8-bit Detective</div>
  </div>

</div><!-- /container -->

<script>
// ───────────────────────────────────────────────
// PIXEL ART ENGINE — box-shadow based rendering
// ───────────────────────────────────────────────
//
// Each sprite is an array of [x, y, color] entries.
// renderSprite(containerId, pixels, scale) builds a
// 1x1 <div> whose box-shadow draws every pixel.

const C = {
  body:   '#b8834e',
  bodyDk: '#9a6b38',
  belly:  '#e8d0a8',
  mask:   '#3a2010',
  eye:    '#00ffff',
  nose:   '#ff69b4',
  handle: '#8B7355',
  rim:    '#c0c0c0',
  lens:   '#aaddff',
  glint:  '#ffffff',
  alert:  '#00ffff',
  spark1: '#00ffff',
  spark2: '#ff69b4',
  zzz:    '#6a7080',
};

// ──────── POSE PIXEL DATA ────────
// Coordinate system: (col, row) from top-left, 0-indexed
// Each sprite is ~12-16 wide, ~10-14 tall

function idlePixels() {
  // Ferret standing slightly upright, magnifying glass at side (front paw)
  return [
    // Ears
    [5,0,C.body],[6,0,C.body],  [8,0,C.body],[9,0,C.body],
    // Head
    [4,1,C.body],[5,1,C.body],[6,1,C.body],[7,1,C.body],[8,1,C.body],[9,1,C.body],[10,1,C.body],
    // Face row — mask + eyes
    [4,2,C.body],[5,2,C.mask],[6,2,C.eye],[7,2,C.mask],[8,2,C.mask],[9,2,C.eye],[10,2,C.mask],
    // Nose / mouth area
    [4,3,C.body],[5,3,C.body],[6,3,C.body],[7,3,C.nose],[8,3,C.body],[9,3,C.body],[10,3,C.body],
    // Neck
    [5,4,C.body],[6,4,C.belly],[7,4,C.belly],[8,4,C.belly],[9,4,C.body],
    // Torso upper
    [4,5,C.body],[5,5,C.body],[6,5,C.belly],[7,5,C.belly],[8,5,C.belly],[9,5,C.body],[10,5,C.body],
    // Torso lower
    [4,6,C.body],[5,6,C.body],[6,6,C.belly],[7,6,C.belly],[8,6,C.belly],[9,6,C.body],[10,6,C.body],
    // Torso bottom
    [5,7,C.body],[6,7,C.body],[7,7,C.belly],[8,7,C.body],[9,7,C.body],
    // Legs
    [5,8,C.bodyDk],[6,8,C.bodyDk],  [8,8,C.bodyDk],[9,8,C.bodyDk],
    [5,9,C.bodyDk],[6,9,C.bodyDk],  [8,9,C.bodyDk],[9,9,C.bodyDk],
    // Tail (right side curving up)
    [10,7,C.body],[11,6,C.body],[12,5,C.body],[12,4,C.bodyDk],
    // Magnifying glass — held in front paw (left side, down)
    // Handle
    [3,7,C.handle],[3,8,C.handle],
    // Rim (circle ~3px)
    [1,5,C.rim],[2,5,C.rim],[3,5,C.rim],
    [1,6,C.rim],[3,6,C.rim],
    [1,7,C.rim],[2,7,C.rim],[3,7,C.rim],
    // Lens
    [2,6,C.lens],
    // Glint
    [1,5,C.glint],
  ];
}

function sniffPixels() {
  // Ferret leaning forward, magnifying glass held up in front of face
  return [
    // Ears
    [6,0,C.body],[7,0,C.body],  [9,0,C.body],[10,0,C.body],
    // Head (shifted forward slightly)
    [5,1,C.body],[6,1,C.body],[7,1,C.body],[8,1,C.body],[9,1,C.body],[10,1,C.body],[11,1,C.body],
    // Face — mask + eyes
    [5,2,C.body],[6,2,C.mask],[7,2,C.eye],[8,2,C.mask],[9,2,C.mask],[10,2,C.eye],[11,2,C.mask],
    // Nose pointing toward glass
    [5,3,C.body],[6,3,C.body],[7,3,C.body],[8,3,C.nose],[9,3,C.body],[10,3,C.body],[11,3,C.body],
    // Magnifying glass — in front of face
    // Rim
    [2,0,C.rim],[3,0,C.rim],[4,0,C.rim],
    [1,1,C.rim],[5,1,C.rim],
    [1,2,C.rim],[5,2,C.rim],
    [2,3,C.rim],[3,3,C.rim],[4,3,C.rim],
    // Lens
    [2,1,C.lens],[3,1,C.lens],[4,1,C.lens],
    [2,2,C.lens],[3,2,C.lens],[4,2,C.lens],
    // Glint
    [2,1,C.glint],
    // Handle
    [5,3,C.handle],[5,4,C.handle],
    // Neck
    [6,4,C.body],[7,4,C.belly],[8,4,C.belly],[9,4,C.belly],[10,4,C.body],
    // Torso (leaning forward)
    [5,5,C.body],[6,5,C.body],[7,5,C.belly],[8,5,C.belly],[9,5,C.body],[10,5,C.body],
    [5,6,C.body],[6,6,C.body],[7,6,C.belly],[8,6,C.body],[9,6,C.body],
    // Front paw
    [5,7,C.bodyDk],
    // Hind legs
    [8,7,C.bodyDk],[9,7,C.bodyDk],
    [8,8,C.bodyDk],[9,8,C.bodyDk],
    // Tail
    [10,5,C.body],[11,4,C.body],[12,3,C.body],[12,2,C.bodyDk],
  ];
}

function runFrame1() {
  // Ferret running right, front legs extended, back legs tucked
  return [
    // Ears
    [4,0,C.body],[5,0,C.body],
    // Head
    [3,1,C.body],[4,1,C.body],[5,1,C.body],[6,1,C.body],
    // Face
    [3,2,C.mask],[4,2,C.eye],[5,2,C.mask],[6,2,C.body],
    [4,3,C.nose],[5,3,C.body],[6,3,C.body],
    // Body (elongated for run)
    [5,3,C.body],[6,3,C.body],[7,3,C.body],[8,3,C.body],
    [4,4,C.body],[5,4,C.belly],[6,4,C.belly],[7,4,C.belly],[8,4,C.body],[9,4,C.body],
    [4,5,C.body],[5,5,C.belly],[6,5,C.belly],[7,5,C.belly],[8,5,C.body],[9,5,C.body],[10,5,C.body],
    // Legs — frame 1: front extended, back tucked
    [3,6,C.bodyDk],[4,6,C.bodyDk],  // front legs stretched
    [8,6,C.bodyDk],  // back leg down
    [3,7,C.bodyDk],
    // Tail
    [10,4,C.body],[11,3,C.body],[12,3,C.bodyDk],
    // Magnifying glass tucked on back
    [7,2,C.handle],
    [7,1,C.rim],[8,1,C.rim],
    [7,0,C.rim],[8,0,C.rim],
    [8,1,C.lens],
    [7,0,C.glint],
  ];
}

function runFrame2() {
  // Legs alternate
  return [
    // Ears
    [4,0,C.body],[5,0,C.body],
    // Head
    [3,1,C.body],[4,1,C.body],[5,1,C.body],[6,1,C.body],
    // Face
    [3,2,C.mask],[4,2,C.eye],[5,2,C.mask],[6,2,C.body],
    [4,3,C.nose],[5,3,C.body],[6,3,C.body],
    // Body
    [5,3,C.body],[6,3,C.body],[7,3,C.body],[8,3,C.body],
    [4,4,C.body],[5,4,C.belly],[6,4,C.belly],[7,4,C.belly],[8,4,C.body],[9,4,C.body],
    [4,5,C.body],[5,5,C.belly],[6,5,C.belly],[7,5,C.belly],[8,5,C.body],[9,5,C.body],[10,5,C.body],
    // Legs — frame 2: front tucked, back extended
    [4,6,C.bodyDk],  // front
    [8,6,C.bodyDk],[9,6,C.bodyDk],  // back extended
    [9,7,C.bodyDk],
    // Tail (slightly different)
    [10,4,C.body],[11,4,C.body],[12,3,C.bodyDk],
    // Magnifying glass tucked
    [7,2,C.handle],
    [7,1,C.rim],[8,1,C.rim],
    [7,0,C.rim],[8,0,C.rim],
    [8,1,C.lens],
    [7,0,C.glint],
  ];
}

function foundPixels() {
  // Ferret standing upright, alert, magnifying glass raised high
  return [
    // Exclamation mark above head
    [7,0,C.alert],[7,1,C.alert],[7,2,C.alert],
    [7,4,C.alert],
    // Ears
    [5,5,C.body],[6,5,C.body],  [8,5,C.body],[9,5,C.body],
    // Head
    [4,6,C.body],[5,6,C.body],[6,6,C.body],[7,6,C.body],[8,6,C.body],[9,6,C.body],[10,6,C.body],
    // Face — alert, wide eyes
    [4,7,C.body],[5,7,C.mask],[6,7,C.eye],[7,7,C.mask],[8,7,C.mask],[9,7,C.eye],[10,7,C.mask],
    // Nose
    [5,8,C.body],[6,8,C.body],[7,8,C.nose],[8,8,C.body],[9,8,C.body],
    // Neck + body
    [5,9,C.body],[6,9,C.belly],[7,9,C.belly],[8,9,C.belly],[9,9,C.body],
    [5,10,C.body],[6,10,C.belly],[7,10,C.belly],[8,10,C.belly],[9,10,C.body],
    // Legs
    [5,11,C.bodyDk],[6,11,C.bodyDk],  [8,11,C.bodyDk],[9,11,C.bodyDk],
    [5,12,C.bodyDk],[6,12,C.bodyDk],  [8,12,C.bodyDk],[9,12,C.bodyDk],
    // Tail
    [10,9,C.body],[11,8,C.body],[11,7,C.bodyDk],
    // Magnifying glass raised high (left paw up)
    [2,5,C.handle],[3,5,C.handle],
    [0,2,C.rim],[1,2,C.rim],[2,2,C.rim],
    [0,3,C.rim],[2,3,C.rim],
    [0,4,C.rim],[1,4,C.rim],[2,4,C.rim],
    [1,3,C.lens],
    [0,2,C.glint],
  ];
}

function happyPixels() {
  // Sitting ferret, happy squint eyes, sparkles around
  return [
    // Sparkles
    [1,0,C.spark1],
    [12,1,C.spark2],
    [0,4,C.spark1],
    [13,3,C.spark2],
    [2,8,C.spark1],
    // Ears
    [5,1,C.body],[6,1,C.body],  [8,1,C.body],[9,1,C.body],
    // Head
    [4,2,C.body],[5,2,C.body],[6,2,C.body],[7,2,C.body],[8,2,C.body],[9,2,C.body],[10,2,C.body],
    // Face — happy squint (horizontal lines for eyes)
    [4,3,C.body],[5,3,C.mask],[6,3,C.body],[7,3,C.mask],[8,3,C.mask],[9,3,C.body],[10,3,C.mask],
    // Nose + smile
    [5,4,C.body],[6,4,C.body],[7,4,C.nose],[8,4,C.body],[9,4,C.body],
    // Neck
    [5,5,C.body],[6,5,C.belly],[7,5,C.belly],[8,5,C.belly],[9,5,C.body],
    // Torso (sitting round)
    [4,6,C.body],[5,6,C.body],[6,6,C.belly],[7,6,C.belly],[8,6,C.belly],[9,6,C.body],[10,6,C.body],
    [5,7,C.body],[6,7,C.belly],[7,7,C.belly],[8,7,C.body],[9,7,C.body],
    // Paws tucked in front
    [5,8,C.bodyDk],[6,8,C.bodyDk],[8,8,C.bodyDk],[9,8,C.bodyDk],
    // Tail curled
    [10,6,C.body],[11,5,C.body],[11,4,C.bodyDk],
    // Magnifying glass resting at side
    [3,7,C.handle],[3,8,C.handle],
    [1,5,C.rim],[2,5,C.rim],[3,5,C.rim],
    [1,6,C.rim],[3,6,C.rim],
    [1,7,C.rim],[2,7,C.rim],
    [2,6,C.lens],
    [1,5,C.glint],
  ];
}

function sleepPixels() {
  // Ferret curled up, magnifying glass on ground
  return [
    // ZZZ above
    [8,0,C.zzz],[9,0,C.zzz],[10,0,C.zzz],
    [10,1,C.zzz],
    [9,2,C.zzz],
    [8,3,C.zzz],[9,3,C.zzz],[10,3,C.zzz],
    // Smaller z
    [11,1,C.zzz],[12,1,C.zzz],
    [12,2,C.zzz],
    [11,3,C.zzz],[12,3,C.zzz],
    // Curled body — round shape
    [4,5,C.body],[5,5,C.body],[6,5,C.body],[7,5,C.body],[8,5,C.body],[9,5,C.body],
    [3,6,C.body],[4,6,C.body],[5,6,C.belly],[6,6,C.belly],[7,6,C.belly],[8,6,C.body],[9,6,C.body],[10,6,C.body],
    [3,7,C.body],[4,7,C.body],[5,7,C.belly],[6,7,C.belly],[7,7,C.belly],[8,7,C.body],[9,7,C.body],[10,7,C.body],
    [4,8,C.body],[5,8,C.body],[6,8,C.body],[7,8,C.body],[8,8,C.body],[9,8,C.body],
    // Head tucked (left side)
    [3,5,C.body],[2,5,C.body],
    [2,6,C.mask],[3,6,C.mask],
    // Closed eye (just dark, sleeping)
    [2,6,C.mask],
    // Nose
    [2,7,C.nose],
    // Tail wrapped around
    [10,6,C.body],[11,6,C.bodyDk],[11,5,C.bodyDk],
    // Magnifying glass on ground next to ferret
    [12,7,C.handle],[12,8,C.handle],
    [13,6,C.rim],[14,6,C.rim],
    [13,7,C.rim],[14,7,C.rim],
    [14,6,C.lens],
    [13,6,C.glint],
  ];
}

// ──────── RENDERING ────────

function pixelsToBoxShadow(pixels, scale) {
  return pixels.map(([x, y, c]) => {
    const px = x * scale;
    const py = y * scale;
    return `${px}px ${py}px 0 ${scale - 1}px ${c}`;
  }).join(',');
}

function renderSprite(containerId, pixels, scale) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const shadow = pixelsToBoxShadow(pixels, scale);
  // find bounding box for sizing
  let maxX = 0, maxY = 0;
  pixels.forEach(([x,y]) => { if(x>maxX) maxX=x; if(y>maxY) maxY=y; });
  const w = (maxX + 1) * scale;
  const h = (maxY + 1) * scale;
  el.style.width = w + 'px';
  el.style.height = h + 'px';
  el.style.position = 'relative';
  // Create canvas element
  let canvas = el.querySelector('.canvas');
  if (!canvas) {
    canvas = document.createElement('div');
    canvas.className = 'canvas';
    el.appendChild(canvas);
  }
  canvas.style.position = 'absolute';
  canvas.style.top = '0';
  canvas.style.left = '0';
  canvas.style.width = '1px';
  canvas.style.height = '1px';
  canvas.style.boxShadow = shadow;
}

function renderSpriteToElement(el, pixels, scale) {
  const shadow = pixelsToBoxShadow(pixels, scale);
  let maxX = 0, maxY = 0;
  pixels.forEach(([x,y]) => { if(x>maxX) maxX=x; if(y>maxY) maxY=y; });
  const w = (maxX + 1) * scale;
  const h = (maxY + 1) * scale;
  el.style.width = w + 'px';
  el.style.height = h + 'px';
  el.style.position = 'relative';
  let canvas = el.querySelector('.canvas');
  if (!canvas) {
    canvas = document.createElement('div');
    canvas.className = 'canvas';
    el.appendChild(canvas);
  }
  canvas.style.position = 'absolute';
  canvas.style.top = '0';
  canvas.style.left = '0';
  canvas.style.width = '1px';
  canvas.style.height = '1px';
  canvas.style.boxShadow = shadow;
}

// ──────── INIT STATIC SPRITES ────────

function init() {
  // Large display — idle at 7x
  renderSprite('large-idle', idlePixels(), 7);

  // Pose grid at 5x
  renderSprite('pose-idle',  idlePixels(),  5);
  renderSprite('pose-sniff', sniffPixels(), 5);
  renderSprite('pose-found', foundPixels(), 5);
  renderSprite('pose-happy', happyPixels(), 5);
  renderSprite('pose-sleep', sleepPixels(), 5);

  // Run — alternate frames
  let runFrame = false;
  const runEl = document.getElementById('pose-run');
  function animateRun() {
    const px = runFrame ? runFrame2() : runFrame1();
    renderSpriteToElement(runEl, px, 5);
    runFrame = !runFrame;
  }
  animateRun();
  setInterval(animateRun, 300);

  // Build palette
  buildPalette();

  // Start scanning scene
  startScene();
}

// ──────── COLOR PALETTE ────────

function buildPalette() {
  const pal = document.getElementById('palette');
  const colors = [
    { hex: '#b8834e', name: 'Body' },
    { hex: '#9a6b38', name: 'Body Dark' },
    { hex: '#e8d0a8', name: 'Belly' },
    { hex: '#3a2010', name: 'Eye Mask' },
    { hex: '#00ffff', name: 'Eyes' },
    { hex: '#ff69b4', name: 'Nose' },
    { hex: '#8B7355', name: 'Handle' },
    { hex: '#c0c0c0', name: 'Rim' },
    { hex: '#aaddff', name: 'Lens' },
    { hex: '#ffffff', name: 'Glint' },
  ];
  colors.forEach(c => {
    const s = document.createElement('div');
    s.className = 'swatch';
    s.innerHTML = `<div class="block" style="background:${c.hex}"></div><div class="hex">${c.hex}</div><div class="name">${c.name}</div>`;
    pal.appendChild(s);
  });
}

// ──────── SCANNING SCENE ANIMATION ────────

function startScene() {
  const stage = document.getElementById('anim-stage');
  const sprite = document.getElementById('scene-sprite');
  const speech = document.getElementById('scene-speech');
  const stageW = stage.offsetWidth;

  const sc = 3; // 3x scale for scene sprites

  // State machine: sleep -> wake -> run -> investigate -> found -> run -> happy -> pause -> reset
  const states = [
    { pose: 'sleep',  x: 40,  dur: 2500, text: '' },
    { pose: 'idle',   x: 40,  dur: 800,  text: '' },
    { pose: 'run',    x: null, dur: 3000, text: '', toX: stageW * 0.42 },
    { pose: 'sniff',  x: null, dur: 3000, text: 'Hmm...' },
    { pose: 'found',  x: null, dur: 2000, text: '!' },
    { pose: 'run',    x: null, dur: 2500, text: '', toX: stageW * 0.78 },
    { pose: 'happy',  x: null, dur: 3000, text: 'All clear!' },
    { pose: 'sleep',  x: null, dur: 2000, text: '', resetAfter: true },
  ];

  let stateIdx = 0;
  let curX = 40;
  let runToggle = false;
  let runInterval = null;

  function poseFn(name) {
    switch(name) {
      case 'sleep': return sleepPixels();
      case 'idle':  return idlePixels();
      case 'run':   return runToggle ? runFrame1() : runFrame2();
      case 'sniff': return sniffPixels();
      case 'found': return foundPixels();
      case 'happy': return happyPixels();
      default:      return idlePixels();
    }
  }

  function showSpeech(txt) {
    if (!txt) {
      speech.style.opacity = '0';
      return;
    }
    speech.textContent = txt;
    speech.style.opacity = '1';
  }

  function positionSpeech() {
    speech.style.left = (curX + 50) + 'px';
    speech.style.bottom = '65px';
  }

  function runStep() {
    const st = states[stateIdx];
    if (runInterval) { clearInterval(runInterval); runInterval = null; }

    // Position
    if (st.x !== null && st.x !== undefined) curX = st.x;

    sprite.style.left = curX + 'px';

    // Show speech
    showSpeech(st.text);
    positionSpeech();

    if (st.pose === 'run' && st.toX !== undefined) {
      // Animate running
      const targetX = st.toX;
      const startX = curX;
      const startTime = Date.now();
      const duration = st.dur;

      runInterval = setInterval(() => {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        curX = startX + (targetX - startX) * progress;
        sprite.style.left = curX + 'px';
        positionSpeech();

        runToggle = !runToggle;
        renderSpriteToElement(sprite, poseFn('run'), sc);
        if (progress >= 1) {
          clearInterval(runInterval);
          runInterval = null;
        }
      }, 200);

      setTimeout(nextState, st.dur);
    } else {
      // Static pose
      renderSpriteToElement(sprite, poseFn(st.pose), sc);
      setTimeout(nextState, st.dur);
    }
  }

  function nextState() {
    const st = states[stateIdx];
    if (st.resetAfter) {
      stateIdx = 0;
      curX = 40;
      showSpeech('');
      setTimeout(runStep, 500);
      return;
    }
    stateIdx++;
    if (stateIdx >= states.length) stateIdx = 0;
    runStep();
  }

  runStep();
}

// ──────── GO ────────
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
